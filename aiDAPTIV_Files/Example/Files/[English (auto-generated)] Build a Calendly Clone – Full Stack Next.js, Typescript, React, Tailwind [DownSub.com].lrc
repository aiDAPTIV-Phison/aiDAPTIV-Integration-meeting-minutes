[00:00.08]Learn how to build a modern fullstack
[00:02.24]Calendarly clone with Google Calendar
[00:04.64]integration. The course uses Nex.js,
[00:07.27]React, TypeScript, Neon, and more. Norah
[00:10.55]Faulry created this course.
[00:15.44]Have you ever tried to schedule a
[00:17.52]meeting and ended up in a time zone you
[00:20.08]didn't know existed? You think you've
[00:22.40]booked a call for Tuesday, but your
[00:25.03]calendar actually saves it for next
[00:27.43]Thursday at 3:00 a.m. during your beach
[00:30.16]vacation? Yeah, we've all been there. Or
[00:33.52]maybe you've played the neverending game
[00:35.76]of email pingpong. Does Tuesday at 2
[00:38.55]work for you? How about Wednesday at 4?
[00:41.84]Actually, how is 2037 looking? Well, the
[00:45.76]chaos stops here because today you're
[00:49.36]going to build and deploy your own
[00:51.92]scheduling app. One that helps people
[00:54.71]book meetings in just one click and no
[00:57.36]psyching powers required. Just like
[01:00.23]Calendarly, the scheduling tool loved by
[01:03.52]millions around the world. Now imagine
[01:06.64]building something like Calendarly, but
[01:09.52]you made it. That's right. Say hello to
[01:14.08]Calendarra if full stack scheduling app
[01:17.36]built to help people manage their time,
[01:20.24]create events, and let others book
[01:22.72]meetings with ease. And yes, nobody will
[01:26.24]get meeting reminders while they are in
[01:28.56]RAM sleep mode. Hello and welcome to our
[01:32.15]brand new course. I'm newer, a software
[01:35.20]engineer and the lead instructor at
[01:37.36]Programming Fluency and I'm super
[01:39.68]excited to guide you through this
[01:41.60]journey. In this course, you're going to
[01:43.92]build and deploy a Calendarly clone
[01:46.56]using NexJS5.
[01:48.72]And here is a quick look on what we are
[01:50.72]going to do. Start off strong with a
[01:53.20]sleek landing page that doesn't scream
[01:55.75]template from 2010. Set up
[01:58.15]authentication using Clerk so users can
[02:01.43]register, login, and feel like they own
[02:04.64]the place. Build beautiful nav bars
[02:08.08]because let's be honest, lost users
[02:10.95]don't book meetings. Create an events
[02:13.59]page where users can set up their own
[02:16.16]events. Build a schedule page so users
[02:19.84]can define their availability and look
[02:22.23]very professional. launch public profile
[02:25.20]pages so users can share links and let
[02:28.80]anyone in the world book meetings with
[02:31.12]them. And finally, we're going to add
[02:33.76]Google calendar integration using Google
[02:36.64]APIs so meetings actually show up where
[02:39.92]they should. And we're going to build
[02:42.08]all of this using TypeScript for clean
[02:45.44]and type safe code. React 19 for
[02:48.72]interactivity and seamless user
[02:50.64]experience. Tailwind CSS version 4 for
[02:53.76]styling because let's be honest, writing
[02:56.80]vanilla CSS is like writing code on a
[02:59.76]typewriter. Chaten UI components for
[03:02.95]that polished modern feel. Neon as our
[03:06.56]postgress database
[03:08.87]and Drizzle OM for type safe queries. By
[03:12.48]the end of this course, you won't just
[03:15.04]have another portfolio project. You're
[03:17.76]going to have real application that
[03:20.48]solves real problems and showcases your
[03:23.68]full stack skills. So, if you're ready
[03:26.80]to level up and build something
[03:29.04]impressive, come join me and let's build
[03:32.40]something amazing together.
[03:36.95]Hey everyone, before we jump into
[03:39.92]building our calendar app, let's take a
[03:42.95]quick peek at what we're going to make.
[03:45.68]This app is all about making it super
[03:48.31]easy to schedule meetings, keep track of
[03:51.28]availability, and stay on top of things.
[03:54.87]No more endless back and forth messages.
[03:58.31]So, let's check out how it all comes
[04:00.79]together. If a user is opening our
[04:03.51]application for the first time ever,
[04:06.40]they are going to see this landing page.
[04:09.92]And here they are going to get the
[04:11.92]option to sign in with Google. Of
[04:14.64]course, if you're using the calendar
[04:16.56]app, you have to have a Google account,
[04:19.35]okay? Because this app will be
[04:22.16]synchronized with the Google calendar.
[04:25.91]So, the only option any user will have
[04:28.88]to sign in or register a new account is
[04:31.84]using their Google account. Okay. So
[04:35.60]here I can choose to continue with
[04:37.44]Google. Sign in with Google or I can
[04:40.47]choose to sign up whatever.
[04:43.44]This will take me to the register page
[04:45.84]or I can sign in
[04:48.47]also. It's going to take me to the login
[04:50.63]page. See here this is the login routes
[04:54.24]and if I click on sign up it's going to
[04:56.63]take me to the register route. And of
[05:00.80]course as you can see our application is
[05:03.04]deployed to the internet.
[05:05.68]So, I'm going to continue with Google.
[05:08.47]Verify your human. Then after I sign in,
[05:12.63]I'm going to be redirected to the events
[05:16.16]page. Let me go to full screen. Okay,
[05:21.03]right now I'm viewing the events page.
[05:24.32]And as you can see, this is the navbar,
[05:28.00]the logo,
[05:29.91]those are the nav links. We have my
[05:32.63]events, my schedule, and public profile.
[05:37.36]And here we have the user button.
[05:40.88]If you click on it, you're going to get
[05:42.88]a user panel like that where you can
[05:45.68]manage your own account or you can even
[05:49.28]sign out. Let's sign out
[05:52.08]and let's log in one more time.
[05:56.08]All right, then. Now we are in the
[05:57.91]events page. Of course, we don't have
[06:00.63]any events yet. So, we have to create
[06:04.16]our first event to get started. But
[06:07.52]before we do that, let's take a look at
[06:09.75]the public profile page. Of course,
[06:12.72]since we don't have any events yet, it's
[06:15.03]going to tell me no events available at
[06:17.52]the moment. So, let's go ahead and
[06:20.00]create our first event.
[06:22.72]I'm going to click here on new event.
[06:25.60]Let's name that event
[06:28.88]hood
[06:30.56]and coffee chat.
[06:35.36]And here we can set the duration of the
[06:38.00]event for that event. I'm going to set
[06:40.47]it for 30 minutes. And here we can type
[06:43.60]any description we want. Let's say a
[06:47.19]casual
[06:48.96]hangout or
[06:51.84]developers.
[06:54.96]Let's correct that. Okay. Okay. Let's
[06:59.03]say a casual hangout for developers to
[07:02.24]talk about
[07:06.08]code,
[07:07.84]share ideas and get feedback
[07:12.80]on projects
[07:15.52]of course over coffee.
[07:19.36]So yeah, this is our first event. And
[07:22.96]the description is going to be optional,
[07:24.56]by the way. And you can set your event
[07:26.88]to active or not active.
[07:30.80]Let's set that event to active
[07:34.08]and then click save. Of course, you can
[07:36.63]cancel creating your event from here.
[07:39.28]And also you can click save to save your
[07:42.00]event. And there you go. We have our
[07:45.28]event here on the events page.
[07:49.12]I can edit the event in any way I want.
[07:54.24]I can make it not active. I can delete
[07:57.28]it if I want. Let's delete it.
[08:00.87]And we are back to not having any
[08:03.44]events. So right now let's recreate that
[08:05.91]event
[08:08.16]and let's click save again. All right.
[08:11.19]Then let's create some other events
[08:14.56]here. For example, I want to set that
[08:16.96]event to 1 hour 1 hour pair programming
[08:20.47]session.
[08:22.08]So if here I say 60 minutes
[08:26.56]and then click save, it's going to be
[08:29.03]translated to 1 hour here on the events
[08:32.00]page. And also here as you can see we
[08:34.71]have that event intro to JavaScript
[08:37.20]workshop. It's translated to 1 hour 24
[08:40.64]minutes and so on. Now I want to create
[08:43.68]a 15minute intro call for 15 minutes.
[08:48.16]But let's say that um I want to make
[08:50.48]that event inactive for a while. Okay,
[08:54.39]let's say I'm not ready for a 15minute
[08:57.83]intro call these days, but I'm going to
[09:01.20]be ready for it in a few days. Okay,
[09:05.27]so let's click save. And as you can see
[09:08.48]when we go to the events page we get
[09:11.60]that event here without the copy link
[09:15.44]button because this event is not active.
[09:19.83]Let's add our last one
[09:22.95]here. This is a podcast guest interview.
[09:26.16]Going to make it 95
[09:28.56]minutes. And this is the description.
[09:31.83]Click save. And there we go. Those are
[09:36.16]our events. Of course, we are having an
[09:38.64]event card for each event. So, right
[09:42.56]now, if let's say I copy that link,
[09:47.12]it's going to tell me link copied
[09:48.80]successfully.
[09:50.64]And right now, I want to send that link
[09:53.51]to anyone in order to be able to book
[09:56.64]that event with me. Okay? I like
[09:59.76]football, by the way. Let's say that I
[10:01.76]have some friends who like football as
[10:04.80]well and they want to book a 45 minutes
[10:08.72]with me to watch big games together.
[10:13.04]As I told you, I'm going to copy that
[10:15.04]link and let's say that I have a friend
[10:18.39]here. We're going to paste that link in
[10:21.76]their browser.
[10:24.16]Click enter.
[10:26.24]And of course, that friend doesn't have
[10:29.12]to be a user of our app. As you can see,
[10:32.24]they are directed to the event page
[10:34.95]without signing in. And this is, by the
[10:37.20]way, the navbar for the public view.
[10:40.39]We're going to have a public navbar
[10:42.88]which has login and register and a
[10:45.27]private navbar which we already saw. So
[10:48.72]right now, as you can see, let's say
[10:51.51]that my friend want to book that event
[10:55.36]with me. It's going to take him to the
[10:58.56]event page. And here it's telling him,
[11:01.27]"Book that event with Nakri."
[11:05.20]But at the moment, he's currently booked
[11:08.32]up. Please check back later or choose a
[11:11.20]shorter event. Okay. Why is that? Why
[11:14.80]he's seeing this message? because I
[11:17.83]didn't set my schedule yet. For now, I
[11:20.95]don't have any schedule. So, I'm going
[11:23.76]to go ahead to the my schedule page and
[11:26.88]let's say that I am available on
[11:31.04]Tuesdays from 12 p.m. to let's say 1600,
[11:38.56]which means 400 p.m.
[11:42.32]And let's say that I'm also available on
[11:45.51]Fridays. Okay,
[11:47.68]let's say from 9 to 5. Okay, I'm going
[11:49.92]to click save
[11:52.80]and right now I get a schedule saved
[11:55.20]successfully.
[11:57.12]So if I go back here to that page and my
[12:00.95]friend reloads his page, as you can see,
[12:04.32]my friend here gets a form where he can
[12:07.83]books that event with me. Here the time
[12:11.12]zone is going to be the time zone where
[12:14.80]the user actually in. Of course, I live
[12:17.51]in Cairo in Egypt. So this is why I'm
[12:19.83]getting the time zone. If someone lives
[12:23.20]in the United States, for example, they
[12:25.44]are going to get the United States time
[12:27.83]zone and so on. We're going to apply all
[12:30.56]of that logic ourselves. Okay, I hope
[12:34.00]you're excited. So here I'm going to
[12:36.80]pick a date. As you can see, only
[12:39.36]Tuesdays and Fridays are available. And
[12:43.76]we have that availability up to one
[12:45.92]year, by the way. Okay, we're going to
[12:47.92]make that availability schedule up to
[12:50.39]one year. So, right now we are
[12:54.16]in May 2025. We're going to get
[12:56.95]availabilities until May 2026.
[13:00.72]Okay. So, let's choose that day,
[13:03.68]Tuesday, 20th of May. And then here I'm
[13:07.76]going to select a meeting time.
[13:10.80]Of course, those are the available time
[13:13.12]slots that I have set in my schedule.
[13:15.92]I'm going to choose that time. Whatever.
[13:18.80]And here, let's say that my friend's
[13:20.80]name is
[13:22.63]Leo Messi. Okay. Of course, Messi is my
[13:25.27]friend. And here I'm going to create a
[13:27.92]temporary email. And then I'm going to
[13:30.72]copy that email and paste it here. And
[13:33.51]here, let's type anything.
[13:36.39]Let's say that Leo Messi is telling me,
[13:38.88]"Let's
[13:40.56]watch
[13:42.63]the FC Barcelona
[13:47.51]game together."
[13:50.72]And then Leo Messi is going to click on
[13:53.27]book event.
[13:55.51]He's going to get that interface and
[13:58.72]then he's going to be redirected to a
[14:00.63]success page saying successfully booked
[14:03.76]football match event whatever with me.
[14:08.24]And then we're going to tell him that he
[14:10.72]should receive a confirmation email. So
[14:14.48]let's go back here to our temp mail
[14:17.12]page. We should receive a confirmation
[14:20.00]email here.
[14:22.00]Okay, we're not getting the confirmation
[14:24.39]email because I'm using a production
[14:27.44]application and the application is not
[14:29.36]published yet in the Google API. So, I'm
[14:32.56]going to use the local project. I'm
[14:35.27]going to open my old project. By the
[14:37.60]way, this is the source code for the old
[14:39.83]project. I'm going to start the
[14:42.24]development server. I'm going to type
[14:44.00]mpm rundev.
[14:46.80]And I opened localhost 3000 here. This
[14:50.32]is the local development server. I'm
[14:52.80]going to sign in and I get my events
[14:56.07]here. So, I'm going to copy the link one
[14:58.00]more time and then I'm going to go back
[15:00.16]here, paste the link, but here I'm using
[15:03.36]the local development server, localhost
[15:06.00]3000.
[15:08.72]There you go. We're getting the event
[15:11.92]page. Let's book the event one more
[15:15.27]time. Choose 20.
[15:19.60]Meeting time anything. Okay. 1:15 again.
[15:24.00]Name Leo Messi.
[15:28.88]Copy that email.
[15:32.63]Paste it here.
[15:35.19]Notes.
[15:37.36]Let's watch
[15:39.60]the FC
[15:43.44]Barcelona game or match
[15:47.36]together
[15:49.36]book event.
[15:52.88]Okay, hopefully we receive a
[15:54.48]confirmation email now. All right, then
[15:57.83]we get the confirmation email and in
[16:00.80]that confirmation email the event
[16:03.04]details. Right now, Leo Messi can choose
[16:05.51]to say yes. He's attending that email
[16:10.16]and then he's going to get that page
[16:12.00]from the Google calendar APIs from the
[16:15.36]from Google itself. And right now, let
[16:18.32]me go to my calendar. Choose May 20th.
[16:22.39]As you can see, the event is booked here
[16:25.75]on May 20th between Leo Messi and me.
[16:30.63]And this is the event details, football
[16:33.83]match, blah blah blah blah, whatever.
[16:36.48]And those are the notes that uh he has
[16:39.12]written to me. So yeah, it didn't work
[16:41.83]from the production app before because
[16:44.07]as I told you, we need to publish that
[16:46.72]production app in the Google APIs. I'm
[16:49.68]going to show you how to do it while
[16:51.19]we're developing the application.
[16:53.60]But right now, let's continue exploring
[16:56.39]our application. Here we've already seen
[16:59.36]the my schedule page. Let's check public
[17:03.51]profile page. Okay, right now I'm
[17:06.64]viewing my public profile. I'm going to
[17:08.72]get that message. This is how people
[17:10.64]will see your public profile. This is a
[17:13.67]button to copy the public profile URL.
[17:17.12]If I click on it, I get that toast
[17:19.83]message. Those are my public events. If
[17:24.31]I give that uh public profile link to
[17:27.36]anyone and they use that link, they're
[17:30.96]also going to view my public profile and
[17:33.91]then they can select whatever event they
[17:37.28]want
[17:38.88]and then book that event the same way we
[17:41.91]did before. So yeah, that's it. This is
[17:45.84]a pretty complex project, I know, but I
[17:49.84]promise you I'll teach you everything
[17:51.60]step by step so you don't feel any of
[17:54.32]these complexities and hopefully
[17:57.03]everything will be very simple to you.
[18:00.40]So, enough of me talking and let's get
[18:03.28]started.
[18:06.32]And now, let's bring the Calendra app to
[18:09.52]life. And we're going to kick things off
[18:12.32]by setting up our project. And since
[18:15.12]we're using NextJS15 as a full stack
[18:18.24]framework for Calendarra, the first step
[18:21.28]is to get Nex.js installed and ready to
[18:24.88]go. So let's create a new project from
[18:27.52]scratch.
[18:29.20]Create a new folder here in your desktop
[18:32.72]and let's name it Calendra
[18:36.08]app
[18:38.24]and then let's open a Visual Studio Code
[18:41.20]new window.
[18:45.28]and then open that folder using VS Code
[18:50.40]and then inside of VS code let's open
[18:53.12]our terminal
[18:55.03]and if we go to NexJS official
[18:57.36]documentation click on get started then
[19:00.79]choose installation
[19:03.20]you can see that in order to install a
[19:05.60]new NexJS project
[19:08.16]we're going to need to type that command
[19:11.67]mpx create next app at latest
[19:15.52]which is going to make sure that you
[19:17.36]have the latest version of NextJS.
[19:20.72]Right now the latest version is Nex.js
[19:23.36]15 but let's say that you are viewing
[19:26.24]this video while NexJS 17 or 18 is out
[19:31.28]there. That command is going to make
[19:34.48]sure that you get that latest version.
[19:37.67]Okay. So let's copy that command and
[19:40.96]let's go back to our terminal and paste
[19:43.67]that command.
[19:46.24]But I'm going to add dot forward slash
[19:48.72]in order to install that project inside
[19:51.36]this directory. Okay, the calendarra app
[19:54.24]directory.
[19:56.32]Then press enter. Then you're going to
[19:58.96]get that error. There is a conflict here
[20:01.76]because the project want to create
[20:03.52]theist directory and we already have a
[20:06.64]do this directory here that was created
[20:09.03]automatically. So just delete that
[20:11.52]folder
[20:14.08]and then type the command again. Press
[20:16.24]enter.
[20:18.16]It's going to ask you several questions.
[20:21.76]Would you like to use TypeScript? Of
[20:24.00]course. Say yes. ESLint no. Tailwind
[20:29.12]CSS, of course.
[20:31.84]Source directory, no. App router, yes.
[20:36.64]Turbo pack, yes.
[20:39.36]Customize the import alias, no. Leave it
[20:43.28]as it is. And now it's installing the
[20:46.55]NexJS project. Installing dependencies
[20:50.15]like TypeScript,
[20:52.08]React, and so on.
[20:54.79]And there we go. We have our NextJS
[20:57.44]project.
[20:59.36]Now let's start the development server
[21:01.67]by typing mpm run
[21:05.28]dev. Press enter.
[21:08.24]It's telling me that port 3000 is in
[21:11.28]use. And this is because
[21:14.48]we have the development server running
[21:16.24]here in the old project. Let me close
[21:18.40]it. And then let's go back here.
[21:23.12]close the server and run it again.
[21:28.15]And right now it's running on localhost
[21:31.20]3000.
[21:33.84]So let's open the browser, go to
[21:35.84]localhost 30,000
[21:38.96]and this is the Nex.js official starter
[21:42.55]template. Of course, we're going to
[21:44.64]change all of that.
[21:47.03]So let's go here. First of all, let's
[21:50.32]delete all of these files inside of the
[21:52.55]public directory.
[21:55.76]And right now, we have an app directory.
[21:59.12]This is the homepage, the page.tsx file.
[22:02.88]This is the page that we're seeing right
[22:05.12]now. Let's remove everything from here.
[22:09.76]And for now, let's type
[22:13.36]Calendra app. Click save. We get
[22:18.08]Calendra app here. Let's test if
[22:21.12]Tailwind CSS is working. I'm going to
[22:23.52]add a class name.
[22:25.76]Let's say font
[22:28.40]bold
[22:31.36]text.
[22:32.96]Let's say
[22:34.96]5x large
[22:38.64]text
[22:40.64]center. Click save.
[22:43.52]There you go. Tailwind CSS is working
[22:46.24]just fine. This is the layout file.
[22:51.03]It's going to contain the layout of our
[22:53.60]application, the global layout of our
[22:55.76]application. And this is the globals.css
[22:59.20]file which is going to include all the
[23:02.00]global styles for our application.
[23:05.12]And of course, this is the favicon file.
[23:08.15]We're going to delete it and we're going
[23:09.84]to create our own favicon later. Okay.
[23:14.32]So now let's go back quickly to our
[23:17.28]layout file and let's work on our meta
[23:21.12]data here which by the way is super
[23:24.55]important. Okay, if you want your
[23:27.03]application to be properly recognized
[23:29.36]and indexed by search engines like
[23:32.32]Google, Bing and so on. So here in the
[23:35.67]title I'm going to type Calendra.
[23:39.76]Click save. I should get it here.
[23:43.36]Okay, while it's reloading, let's remove
[23:46.64]that description.
[23:48.55]And I'm going to add a new description
[23:50.40]here.
[23:52.64]Description for search engines like
[23:55.52]calendarra is a simple and efficient
[23:57.36]calendar app and so on. And right now
[24:00.32]the title is reflected here calendarra.
[24:05.20]And if I inspect the page,
[24:08.96]go to head element
[24:12.08]here in the meta, the title is
[24:14.08]calendarra. And this is the description,
[24:17.20]the description that we wrote here. This
[24:20.55]one.
[24:22.08]And now our project is ready. And we can
[24:25.12]start working on our logic right away.
[24:31.03]Since we are developing a sensitive app
[24:33.76]like calendarra that will handle users
[24:37.52]meetings and schedule and it will
[24:40.15]integrate with their Google calendar
[24:42.55]which means we're going to need access
[24:44.72]to their Google account. Right? In that
[24:47.76]case we're going to need to develop a
[24:49.84]strong authentication logic that will
[24:52.15]handle all of this. And actually we're
[24:55.12]going to depend on a very strong service
[24:58.00]old clerk.
[25:00.24]So, let's go to the clerk documentation.
[25:03.12]Go to clerk.com and then sign in with
[25:06.32]your account or create a new account if
[25:09.03]you don't have one. I'm going to sign in
[25:11.12]with Google and there we go. This is the
[25:13.76]old project.
[25:15.60]And here I'm going to create a new
[25:17.67]application. Let's name it Calendarra
[25:21.44]and choose only to sign in with Google.
[25:25.76]Okay, that's good. Then click on create
[25:28.32]application.
[25:31.03]And then let's go to configure. And then
[25:34.08]here in the email phone username, we
[25:37.12]just want to add the ability to add a
[25:40.40]name here. Yeah, this will allow users
[25:43.36]to set their first and last name.
[25:46.96]So click save
[25:49.36]and let's go back here to overview.
[25:52.40]Then choose next.js.
[25:54.72]It's going to give you a guide on how to
[25:57.20]use Clerk and install it locally. First
[26:00.32]of all, we need to install Clerk. So,
[26:02.96]copy that command and let's go back to
[26:06.40]our terminal. Open a new terminal.
[26:09.67]And let's paste that command here. Press
[26:12.55]enter.
[26:14.79]And now clerk is installed. And now
[26:17.52]let's go back to the documentation. The
[26:20.15]second step that we need to do is to set
[26:22.55]up your clerk API keys. So
[26:27.36]copy also these environment variables
[26:30.55]and put it in your file. So let's go
[26:34.15]here to our project, create a new file
[26:37.84]and name it im
[26:42.00]and paste these variables inside of it.
[26:45.12]Click save. And then step number three
[26:48.79]is to update or create a middleware.ts
[26:52.08]file. So copy the name of the file from
[26:56.88]here and let's go back here, create a
[26:59.60]new file
[27:01.44]and name it middleware.ts.
[27:04.96]Then copy all of that code and paste it
[27:09.67]here. Click save. But here we're going
[27:12.79]to need to add some code because we want
[27:16.00]to protect the private routes and only
[27:19.12]allow access to public routes. So how
[27:22.96]are we going to do that? First of all,
[27:26.72]we're going to create
[27:28.88]a conest named is public route which is
[27:32.32]going to include all of our public
[27:34.88]routes. And we're going to use a method
[27:37.44]named create route matcher of course
[27:39.91]coming from clerk.
[27:42.48]And by the way, if you want to autoimp
[27:44.55]import anything in Visual Studio Code,
[27:47.52]just highlight the element or the
[27:50.15]function that you want to import and
[27:52.64]then click on your keyboard on control
[27:55.67]and space together. Then it's going to
[27:58.32]open a menu for you like that telling
[28:01.03]you that this method is nested inside
[28:04.24]that package at clerk slashnext.js
[28:08.48]forward slash server. Choose it and it's
[28:12.00]going to autoimp import it for you. And
[28:14.88]here instead of just saying export
[28:17.03]default clerk middleware, we're going to
[28:19.84]add this code to the clerk middleware
[28:22.32]function. We're going to give it a call
[28:24.48]back function that takes an oath and
[28:27.44]request. And inside of that callback
[28:29.60]function, we're going to say if the
[28:32.15]request the user is trying to make is
[28:35.44]not a public route, call oath.protect.
[28:39.20]Meaning that if this is not a public
[28:41.67]route, I need you to protect that route.
[28:45.36]Okay. But what's going to happen when
[28:47.27]clerk protects your private routes? It's
[28:50.79]simply going to redirect the user to the
[28:53.20]login or the register route. Okay. Now
[28:57.12]click save and close the middleware
[29:00.00]file. And then here in the M file, let's
[29:03.76]add these environment variables. The
[29:06.48]next public clerk signin URL. This is
[29:10.32]the sign-in URL forward/ login. And this
[29:13.76]is the signup URL forward slashregister.
[29:17.76]And here in the signin force redirect
[29:20.39]URL, we are redirecting the user after
[29:24.08]sign in to the events page. And we're
[29:27.27]going to do the same after the user
[29:29.36]signs up. Okay. Now, click save. And
[29:34.24]finally, our last step is to wrap our
[29:37.20]whole application in a clerk provider
[29:39.60]like that. So copy that and let's go to
[29:43.76]our global layout and let's wrap
[29:47.36]everything inside a clerk provider
[29:50.79]coming from clerk nextjs.
[29:55.12]There we go.
[29:57.52]Now click save. And now let's create the
[30:01.44]oath route. We're going to create it
[30:03.44]inside of the app directory in a route
[30:06.39]group like that.
[30:08.64]We're going to create parenthesis and
[30:10.72]say O.
[30:13.20]And if you're not familiar with the
[30:14.79]route groups, it simply prevents the
[30:18.00]folder name from being included in the
[30:20.32]routes URL path. Meaning that when I
[30:24.24]create a new folder under oath under
[30:27.44]that oath route group named login,
[30:32.72]I can go to login right away. I don't
[30:37.12]need to type O here. Okay, Nex.js is
[30:41.91]going to ignore the word O and use the
[30:45.67]route forward/ login right away. So here
[30:49.67]inside of the login folder, we're going
[30:51.67]to create another folder
[30:54.72]and we're going to catch all routes like
[30:56.96]that by typing square brackets wrapped
[31:00.48]inside another square brackets like
[31:02.55]that. and then type three dots like
[31:06.08]that. And then type login again. And
[31:10.48]then we're going to create another route
[31:13.03]for register.
[31:16.64]And we're also going to create a catch
[31:19.44]all route inside of it. Two square
[31:22.55]brackets like that. Then three dots or
[31:25.27]three periods. And type register.
[31:29.44]And inside of the login folder, we're
[31:31.44]going to create a page.tsx
[31:35.20]file.
[31:37.12]And also inside of register, we're going
[31:39.44]to create a page.tsx
[31:42.96]file.
[31:44.48]There we go.
[31:48.64]Now, let's create that login page. We're
[31:52.08]going to say export
[31:54.39]default
[31:56.32]function login page.
[31:58.88]And this function is going to return a
[32:01.91]next image like that coming from next
[32:05.12]image which is going to render our logo.
[32:08.15]So from where are we getting that logo?
[32:10.88]I'm going to go here to my old project.
[32:14.24]Go to public assets. I'm going to copy
[32:17.03]the assets
[32:18.96]folder
[32:20.55]and just paste it here in the public
[32:23.67]directory.
[32:26.48]And of course for you, you can find
[32:28.88]these assets, the logo, and the other
[32:31.91]icons. You can find them in the source
[32:34.48]code of this course. And you're going to
[32:37.51]find the link for the source code in the
[32:40.08]description of this course. Okay. So
[32:42.64]again, here in the login page, we are
[32:44.96]rendering the logo in a next image like
[32:47.60]that. And here we are rendering a
[32:49.91]signing component coming from clerk.
[32:52.88]It's a user interface component that
[32:55.60]will allow users to sign in to their
[32:57.76]accounts. And this is the styling for
[33:00.32]the page. Flex flex call items center
[33:04.15]padding five gap 10. And we're going to
[33:07.12]give it animate fade in. Let's create
[33:09.44]that animation.
[33:11.44]So we're going to go to our globals.css
[33:14.24]file. And let's go here and add this
[33:17.67]animation
[33:19.76]which is the animate fade in. Now click
[33:23.12]save. Let's go back to the login page.
[33:26.88]Click save as well. And now let's open
[33:29.91]our application. Go to forward slash
[33:33.03]login.
[33:34.88]And look at that. We have our login
[33:37.91]page. This is the logo. And this is the
[33:42.88]signin component. This is coming from
[33:45.44]clerk. And as you can see, there is a
[33:48.39]fade in animation. When I reload the
[33:50.32]page, this is coming from the animation
[33:53.44]that we just created.
[33:55.91]And let's also add that animation to all
[33:59.27]of our application,
[34:02.39]which means that we're going to go to
[34:04.00]the global layout file and add that
[34:06.48]animation animate fade in. Click save.
[34:10.63]And now let's go ahead and create the
[34:12.87]register page.
[34:16.15]Right now if I go to register, it's
[34:18.32]going to tell me not found
[34:21.20]or that error. It's simply because we
[34:23.83]didn't create that page yet.
[34:27.35]So let's go to the register page. And by
[34:30.63]the way, if you want to go to any file
[34:33.20]in your u in your application in Visual
[34:35.91]Studio Code, there is a shortcut. You
[34:38.80]can click control plus the letter P
[34:42.87]and then type the name of the file like
[34:45.20]in that case I did type register and
[34:49.11]then choose that file
[34:52.80]and then here let's create the register
[34:55.20]page. We're going to say export default
[35:01.76]function register page
[35:05.04]which is going to look exactly like the
[35:08.24]login page. It's going to render a next
[35:11.76]image to display the logo but here we're
[35:14.88]going to render a sign up component not
[35:17.28]sign in also coming from clerk and
[35:20.56]everything else is the same. Now click
[35:23.83]save and reload the register page.
[35:27.52]And there we go. We have the register
[35:30.00]page here. If I click here on sign in,
[35:33.52]it's going to take me to the login page.
[35:36.00]If I click here on sign up, it's going
[35:38.40]to take me back to the register page.
[35:44.16]All right. Now that we've got the
[35:46.64]foundation set up and authentication
[35:49.83]ready to go, it's time for the fun part,
[35:53.59]which is designing our landing page.
[35:56.56]This is the first thing users will see.
[35:59.92]So, let's make it clean, welcoming, and
[36:03.52]visually engaging. Let's bring some
[36:06.80]personality to Calendarra and make a
[36:09.68]great first impression. First of all,
[36:12.64]we're going to go to the homepage.
[36:15.44]Let's remove that and call this home
[36:18.56]page. And let's remove that.
[36:23.20]And also
[36:24.96]that and here we're going to say if
[36:28.96]there is no loggedin user return a
[36:31.68]landing page component. Okay. But from
[36:35.20]where are we getting that user? How are
[36:38.64]we going to know if there is a loggedin
[36:40.72]user or not? Simply here we're going to
[36:43.44]say connest user equals to await
[36:47.28]current user coming from clerk nextjs
[36:52.00]server and this is a function we have to
[36:54.24]call it and since we are using a wait
[36:57.04]here we have to make this an
[37:00.48]asynchronous function
[37:03.68]and of course we're going to define that
[37:05.83]landing page in a minute.
[37:08.72]So again here we're saying if no user
[37:11.59]render the landing page otherwise we're
[37:15.44]going to redirect the user to the events
[37:18.00]page and we're going to use a method
[37:20.72]from nextjs called redirect and that
[37:24.48]redirect is going to come from next
[37:26.64]navigation like that.
[37:29.28]Now let's create that landing page
[37:31.59]component. Copy that and let's go here
[37:35.20]to the root directory. create a new
[37:37.11]folder and name it components.
[37:42.16]And inside of it, let's create a new
[37:44.32]file and name it landing page.tsx.
[37:50.16]And now let's create our landing page.
[37:52.96]First of all, we're going to make this
[37:54.48]file as a client component by typing use
[37:57.52]client at the top of the file. And then
[38:00.56]here we're going to say export
[38:03.04]default
[38:05.20]function landing page.
[38:10.16]And here I want to return
[38:12.96]a main element like that that has these
[38:17.52]styles flex item center padding of 10
[38:21.83]gap 24 animate.
[38:24.96]And in the small screens, medium
[38:27.83]screens, and below, we're going to have
[38:29.92]a flex call. Okay. And then here I'm
[38:34.00]going to render a section that will have
[38:37.20]heading, subheading, and an illustration
[38:40.24]image. Also, it's going to have these
[38:42.48]styles. And then here we want to render
[38:45.44]the logo.
[38:47.44]So we're going to render a next image
[38:49.44]coming from next image. Its source is
[38:52.64]going to be the logo file.
[38:55.92]Now, let's save all of that. Import the
[38:58.32]landing page in order to see our
[39:00.96]progress.
[39:02.80]Save and go to the homepage.
[39:09.44]There we go. This is our logo. Of
[39:11.44]course, we are not logged in. This is
[39:13.28]why we are seeing the landing page
[39:15.04]component. Then under the image here, we
[39:18.40]want to render a main heading. Saying
[39:20.88]your time perfectly planned.
[39:23.92]Let's save.
[39:26.24]Okay. Nice. Of course, that heading is
[39:29.28]going to have these styles.
[39:32.64]And below it here, we're going to have a
[39:34.48]subheading
[39:37.35]displaying the text.
[39:40.16]Save. Okay. Nice.
[39:43.83]And here we're going to have our
[39:45.68]illustration
[39:47.20]image.
[39:49.20]This is also coming from our assets.
[39:51.92]Again, I'm reminding you, you can find
[39:54.48]these assets in the source code and you
[39:57.20]can find the link for the source code in
[40:00.00]the description of this course. Okay,
[40:03.52]click save. There we go. I'm getting the
[40:06.64]illustration.
[40:08.40]And then we're going to go below that
[40:10.48]section and we want to render the clerk
[40:13.92]signin component.
[40:16.40]Of course, that component is coming from
[40:18.80]clerk next.js.
[40:21.83]And here we are using a theme from
[40:24.64]clerk. But we have to install clerk
[40:27.76]themes first. If you go here to clerk
[40:30.64]documentation,
[40:32.72]go to docs and search for themes.
[40:40.64]You can see that clerk has many themes
[40:43.28]like dark themes, shades of purple, neo
[40:46.96]brutalism,
[40:48.56]and so on. So, in order to be able to
[40:52.16]use those themes, we're going to need to
[40:55.44]type that command.
[40:57.76]So, copy it and let's go here, open the
[41:01.68]terminal, and paste that command. Press
[41:04.48]enter.
[41:06.24]And there we go. Now I can import that
[41:08.72]theme from clerk themes. Now if I click
[41:12.80]save, we can see the sign-in component
[41:16.00]here. And as you can see, it looks
[41:17.83]different from the components that we
[41:20.80]render in the sign in and register pages
[41:23.35]because we're using a clerk theme here.
[41:27.35]And here we are saying routing hash
[41:30.48]because we're using the sign-in
[41:32.48]component in a route that's not a catch
[41:35.35]all route. Let me show you what I mean.
[41:38.40]Let's comment that for now. Click save.
[41:41.52]And we're going to get an error here.
[41:44.07]See, we have one issue here. It's
[41:46.31]telling you that the signin component is
[41:49.35]not configured correctly. And this is
[41:51.92]because the home route is not a catch
[41:54.80]all route. Before when we used signing
[41:59.04]and register components here remember we
[42:02.56]defined those routes as catch all routes
[42:05.59]and that's why we were able to use that
[42:07.92]component without the routing hash
[42:11.04]property. But here since the home route
[42:14.16]is not a catch all route we have to say
[42:17.04]routing equals to hash. And there we go.
[42:20.40]This is our landing page. Of course,
[42:24.48]it's displayed as flex call here because
[42:27.28]this is a small screen. Let's make it
[42:29.59]large. And we get our landing page here.
[42:35.28]And now that we've laid the foundation
[42:37.28]of our app, it's time to set up the
[42:40.16]database for this project. And we're
[42:43.35]going to be using Neon as our Postgress
[42:46.48]provider. and we're going to use Drizzle
[42:49.44]OM for type safe developer friendly way
[42:52.72]to work with our database.
[42:55.68]So first of all let's go to Neon. Log
[42:58.31]into your account or create a new
[42:59.92]account and then let's create a new
[43:02.16]project from here. Let's call it
[43:05.11]Calendra.
[43:06.72]Then click create
[43:09.59]and then click on connect.
[43:13.04]And then we're going to need that
[43:14.72]connection string. So copy it and then
[43:18.88]let's go to our project to the file.
[43:24.72]Then paste that connection string here
[43:27.76]and we're going to save it in an
[43:29.28]environment variable named database
[43:32.48]URL. Now click save and you're good to
[43:36.80]go. You've created in your own project
[43:39.52]very easily. Now let's set up Drizzle.
[43:44.96]Go to their website, search on Google
[43:47.52]for driorm or go to orm.driel.team
[43:52.16]and then click on get started, then
[43:54.56]choose neon,
[43:57.28]and then scroll down here until you find
[44:00.16]the installation commands. And then
[44:02.72]we're going to need to install these
[44:04.80]packages.
[44:06.64]Okay, so first of all, copy
[44:11.11]that command. Leave out the M. We don't
[44:14.56]need it. Copy that. And then let's go
[44:17.59]back to our app and paste that command.
[44:20.88]Press enter.
[44:23.68]Now it's installed.
[44:26.00]And then also let's go here and copy
[44:28.64]that command and leave out that tsx
[44:31.76]also. We don't need it. And paste it
[44:34.96]here as well. Then press enter. And now
[44:38.72]we are all set up. Let's close all files
[44:43.83]and let's go here to the home directory
[44:45.92]and create a new folder and let's name
[44:48.56]it Drizzle
[44:51.04]and then inside of that Drizzle folder.
[44:53.44]We're going to add a new file. Let's
[44:55.20]name it DB which is short for
[44:58.07]database.ts
[45:00.80]and this file is going to be responsible
[45:03.04]for establishing the connection with our
[45:05.68]database. Okay, press enter.
[45:10.48]And then first of all,
[45:13.35]we're going to need to initialize the
[45:15.52]neon client using the database URL from
[45:19.28]our environment variables or from our in
[45:24.00]file.
[45:25.92]This is why we're going to say connestql
[45:29.04]equals to neon. And that neon is going
[45:32.64]to come from that package at neon
[45:35.35]database forward slashs serverless.
[45:39.35]And then after that we're going to need
[45:41.59]to create and export the drizzlem
[45:44.31]instance with the neon client and schema
[45:48.88]for type safe queries. How are we going
[45:52.24]to do that? We're going to export a
[45:54.00]conest named db which stands for our
[45:56.80]database
[45:58.56]equals to drizzle and we're going to get
[46:01.35]that drizzle from that package drizzle o
[46:04.64]neon http.
[46:06.80]So here we're going to initialize that
[46:08.72]drizzle instance using the SQL conest
[46:12.24]that we defined earlier
[46:14.88]and its second argument is going to be
[46:16.96]an object taking our schema.
[46:20.56]Okay. But from where are we getting that
[46:24.07]schema? This is why we're going to need
[46:26.64]to create a new file here under drizzle
[46:31.35]named
[46:32.88]schema.ts.
[46:37.35]And before creating our schema, let's
[46:39.52]import it here in the db.ts file. We're
[46:42.80]going to say import all as schema from
[46:47.83]schema forward slash schema. Click save.
[46:51.28]And now let's create our schema. Inside
[46:54.72]of this schema, we're going to need to
[46:56.96]create our tables, our database tables.
[47:00.64]And obviously, we're going to have
[47:02.31]several tables, right? So the first
[47:05.35]table is going to be the events table.
[47:08.80]It's going to have fields like name,
[47:11.92]description, and duration. So in order
[47:15.44]to create an event table, we're going to
[47:17.28]say export const event table equals to
[47:22.31]something called PG table. And this is a
[47:25.92]function. And that PG table stands for
[47:29.59]postgress table
[47:32.24]and it's going to come from
[47:35.11]Drizzle OM Postgress core. And this
[47:39.68]function is going to take two arguments.
[47:42.64]The first one is going to be the name of
[47:46.31]the table, the name of the table in the
[47:49.11]database which is events.
[47:52.48]And the second one is going to be an
[47:54.72]object which is going to contain all of
[47:58.00]our fields. And the first field is going
[48:01.28]to be ID. Of course, each item in any
[48:04.80]table in any database in the world
[48:07.28]should have a unique ID. And this is why
[48:10.48]we're using a package called UIU ID or a
[48:13.52]function actually called YU ID. Also,
[48:16.72]it's going to come from
[48:19.68]Drizzle or MPG core. So this function YU
[48:24.96]ID is going to give a unique ID to each
[48:28.07]item in the events table.
[48:31.04]So as you can see here, unique ID with
[48:33.11]default YU ID. And then we're going to
[48:36.07]call that function primary key which is
[48:38.55]going to make that ID the primary key of
[48:41.59]that table.
[48:43.92]And then we're going to say default
[48:46.55]random and that function is going to
[48:49.59]automatically fills this column with a
[48:52.80]randomly ID if no value is provided. So
[48:57.52]again this is our first field. The next
[49:01.44]field is going to be name which is going
[49:03.83]to be a text also coming from
[49:08.00]Drizzle OM
[49:10.16]Postgress core. Okay, this is the event
[49:14.48]name and not null means that this field
[49:17.76]is required. It can't be null and that
[49:21.20]name means that the field is going to
[49:23.92]have the name name. Okay. And here we're
[49:27.92]going to provide a description field
[49:30.31]which is also going to be a text with
[49:32.40]the name description and it's going to
[49:35.20]be an optional description since we
[49:37.20]didn't say not null. And then we're
[49:39.83]going to need to define the duration of
[49:41.68]the meeting in minutes. So it's going to
[49:44.07]be an integer coming from also drizzle
[49:46.80]or mpg core. This is going to be its
[49:50.00]name and also it's going to be required.
[49:53.04]It can't be null. And then we're going
[49:56.40]to need the clerk user ID which is the
[49:59.11]ID of the user who created it from
[50:01.44]clerk.
[50:02.96]We're going to take his clerk user ID.
[50:05.52]It's going to be a text. Its name is
[50:07.68]clerk user ID not null. So you know the
[50:11.04]drill. And then we're going to need to
[50:12.96]know if that event is active or not. So
[50:16.64]we're going to say is active is a
[50:18.31]boolean and that boolean also coming
[50:20.88]from PG core and its default value is
[50:25.04]true.
[50:26.55]And then finally we're going to need to
[50:28.24]know when that event was created or
[50:31.35]updated. And since we're going to use
[50:34.07]those two variables a lot, we're going
[50:36.72]to define them here
[50:39.59]in the top.
[50:41.68]We're going to say cost created at
[50:43.68]equals to a time stamp. It's a time
[50:46.00]stamp coming from Drizzle or MPG core.
[50:50.72]It's required and we're gonna default it
[50:53.28]to now. The default value is going to be
[50:56.00]set to now. Okay. And then we're going
[50:59.35]to say conest updated at equals to a
[51:02.07]timestamp also. Its name is updated at
[51:06.24]it's required. It's going to be default
[51:08.80]to now. And on update meaning that
[51:12.31]whenever it's updated,
[51:14.88]we're going to return a new date. So
[51:17.35]it's going to automatically updates to
[51:20.16]current time whenever an update happens.
[51:23.76]Okay. Now click save. And then we're
[51:27.44]going to need to create an index for
[51:29.92]faster wearing. We're going to need to
[51:32.07]create an index on that table for faster
[51:35.28]quering. So we're going to add a third
[51:37.35]argument here saying take the table and
[51:41.83]then index it using the table.clerk user
[51:45.52]ID by using that on function and we're
[51:49.59]going to give it that name clerk user ID
[51:52.31]index and then we're going to import
[51:55.76]this function also from drizzlepg
[52:00.16]core.
[52:01.76]And now I think we're done with this
[52:04.24]event table.
[52:05.92]And the second table that we're going to
[52:07.76]need to create is schedules table. We're
[52:11.04]going to need to define schedules table
[52:14.00]one per user with a time zone and time
[52:17.20]stamps. So you know the drill. We're
[52:20.16]going to say export con schedule table
[52:22.88]equals to a pg table named scheduled
[52:26.55]which is going to have ID, time zone,
[52:28.88]clerk user ID created at and updated at.
[52:34.48]And then our next table that we're going
[52:36.88]to need to define is schedule
[52:39.35]availabilities which is going to store
[52:42.16]available time slots per day. So also
[52:45.92]we're going to say export connest
[52:48.16]schedule availability table equals to a
[52:50.64]pg table that has ID schedule ID. But
[52:56.72]that schedule ID is going to be a
[52:58.72]foreign key from the schedule table. And
[53:01.76]this is why we're going to need to say
[53:03.28]dot references the schedule table dot id
[53:08.00]and then we're going to say ondee
[53:10.88]cascade meaning that we're going to need
[53:13.11]to cascade delete when schedule is
[53:15.92]deleted. So if a schedule is deleted
[53:19.59]from the schedule table the related
[53:22.96]schedule availability table item is
[53:25.35]going to be deleted with it. Okay. And
[53:28.80]each availability is going to have a
[53:30.80]start time and an end time which is
[53:34.00]going to be text and they are going to
[53:37.04]be required. And then of course we're
[53:40.31]going to need the day of the week. Okay,
[53:44.07]it's going to be equals to a schedule
[53:46.24]day of week in.
[53:48.80]So let's define that. We're going to go
[53:51.52]up here and define a postgress in for
[53:55.76]the days of the week. Of course, this is
[53:59.76]short for enumeration.
[54:02.24]And we're going to use a function named
[54:04.07]PG enum
[54:06.80]coming from PG core. Drizzle MPG core
[54:11.11]which is going to have the name day. And
[54:14.16]here inside of the table, we're going to
[54:16.64]name it that day of the week. We're
[54:18.55]going to name it day of week, but the
[54:21.11]enum itself is going to have the name
[54:23.44]day.
[54:25.04]And we're going to get that these values
[54:27.68]for that enum from a conest or a
[54:31.44]variable named days of week. But from
[54:34.40]where are we getting that conest?
[54:37.35]Actually we're going to create
[54:40.24]a folder here named constants.
[54:45.83]And inside of it we're going to create a
[54:47.92]new file named index.ts.
[54:52.07]And here we're going to say export const
[54:54.64]days of week in order. And then we're
[54:57.68]going to provide an array that contains
[55:01.11]each day of the week. And we're going to
[55:03.44]export it as const
[55:07.68]meaning that each value of these values
[55:10.00]is going to be a constant itself.
[55:13.68]Save it. Close that file. And now let's
[55:18.24]import it. So again here we're creating
[55:22.80]an enum in our Postgress database that
[55:26.48]has the name day which only accepts
[55:30.80]values from that days of week in order.
[55:35.68]Okay.
[55:37.35]So it can only take values from this
[55:41.11]array. It's like telling my database
[55:44.07]create an enome type called day
[55:47.83]that only have one of those values. And
[55:51.44]now if we go back to the schedule table
[55:53.59]and take a look at it, you can imagine
[55:56.40]that each schedule table can have many
[55:59.52]availabilities, right? And this is
[56:02.48]called a relation. In the world of
[56:05.35]databases, this is called a relation.
[56:08.16]And this is why we're going to need to
[56:09.83]create a relation between these two
[56:12.88]tables.
[56:14.79]So let's go here below the schedule
[56:17.83]table and create that relation.
[56:21.35]We're going to define a relationship for
[56:23.11]the schedule table in which a schedule
[56:26.24]has many availabilities.
[56:28.55]So we're going to say export conest
[56:32.16]schedule relations equals to relations.
[56:36.31]This is a function coming from Drizzle
[56:38.72]RM which is going to create a relation
[56:42.24]between the schedule table and the
[56:44.72]schedule availability table and that
[56:47.92]relation is going to have the name
[56:49.59]availabilities and of course it's a one
[56:52.00]to many relationship and this is why
[56:54.24]we're saying here many and here also
[56:56.96]we're going to call the many function.
[57:00.40]So in short, this creates a one to many
[57:03.20]relationship between the schedule table
[57:06.07]and the availabilities table. But is
[57:09.68]this the only relation that we're going
[57:11.92]to need to create? Actually, no. We're
[57:15.11]going to go down here and create the
[57:18.88]reverse relationship in which each
[57:21.83]availability belongs to one schedule.
[57:25.59]And here the fields are going to be
[57:27.35]schedule availability table dot schedule
[57:29.92]id which is going to reference the
[57:32.24]schedule table do id which is the
[57:35.52]foreign key. So to sum up this schedule
[57:38.72]relations will create a relation between
[57:41.68]a schedule and the schedule availability
[57:44.64]table in which each schedule can have
[57:48.48]many availabilities. And this schedule
[57:52.00]availability relations sets up a reverse
[57:55.52]relation where we can go from a time
[57:58.07]slot back to the full schedule it
[58:00.55]belongs to. I hope it's clear by now.
[58:04.07]Now we're done with our schema. Click
[58:06.31]save. And finally, we're going to need
[58:08.88]to go to the package.json file and then
[58:12.48]go to the scripts
[58:16.48]and add those three scripts DB generate
[58:21.83]which is going to generate our schema
[58:24.96]and then DB migrate which is going to
[58:27.11]migrate our schema and then that DB
[58:30.96]studio is going to open an interface to
[58:33.20]view our database. But before we run
[58:36.79]these commands, we have final thing to
[58:39.83]do, one final thing to do, which is to
[58:42.96]create a Drizzle config file. So let's
[58:46.48]go to the home directory, create a new
[58:48.64]file, and name it drizzle.config.ts.
[58:53.83]And then let's add this code to it.
[58:56.72]We're going to define our database URL
[58:59.35]variable from our M file. And then we're
[59:03.28]going to say if the database URL doesn't
[59:05.52]exist through a new error. And then this
[59:08.55]is just a configuration code. We're
[59:11.35]defining the path to our schema, the
[59:14.48]directory where Drizzle will output
[59:16.48]migration files. We're specifying that
[59:19.68]we're using Postgress SQL. We're
[59:22.72]enabling strict mode for stricter
[59:25.83]validation and type safety. Here we are
[59:28.79]enabling logging. And here we are
[59:31.76]passing in the database credentials
[59:34.96]which is the database URL the connection
[59:39.20]string. Now click save
[59:42.79]and let's run this command. Copy it.
[59:47.20]Open the terminal and type mpm run
[59:52.40]and then type db
[59:55.44]colon generate. Press enter.
[60:00.88]And it was generated successfully.
[60:04.96]As you can see, a new folder inside
[60:07.44]Drizzle named migrations was created.
[60:11.20]And now let's copy the migrate command.
[60:16.31]And type mpm run db migrate
[60:23.52]which is going to migrate our schema. If
[60:26.64]you open this file here, you can see
[60:29.04]that the drizzle code that we wrote has
[60:31.35]been translated into Postgress SQL here.
[60:36.40]And finally, we're going to run this
[60:39.52]command. MPM
[60:41.83]run db studio
[60:46.31]mpm
[60:47.92]run db studio. Press enter.
[60:52.40]And it's telling you that you can view
[60:54.16]your database from this URL. Let's click
[60:56.88]on it. And this is our database. We have
[61:00.88]three tables. Events which has ID, name,
[61:04.31]description, and so on. Schedule,
[61:06.79]availabilities table, and schedule
[61:10.16]table.
[61:12.64]And by the way, we can view it also from
[61:16.00]here in our Neon dashboard.
[61:20.24]Go to your project and go to tables. And
[61:24.24]also you can see your tables here. And
[61:27.20]now our database is ready. Let's move on
[61:30.55]to the next step.
[61:34.00]And now that our database is all set up,
[61:38.00]let's head back to the front end and
[61:40.40]start by creating two navigation bars.
[61:44.64]one for the public view for people who
[61:47.59]are not signed in and another one for
[61:50.79]authenticated users. First of all, we're
[61:54.48]going to need to create
[61:58.00]a route group here named main.
[62:02.16]Okay, created under the app directory.
[62:05.83]And that main directory will contain all
[62:08.55]of our main logic of the app. So first
[62:12.07]of all let's create a layout file for
[62:14.40]it.
[62:16.40]Inside of it let's create a layout dsx.
[62:21.11]So here let's create that layout export
[62:23.76]default asynchronous function main
[62:26.07]layout.
[62:27.68]And of course since this is a layout
[62:30.24]it's going to take children as its
[62:32.16]props. We're going to dstructure the
[62:35.11]children from the props object. And that
[62:38.40]children is going to be of type react
[62:42.96]note. And here let's return a main
[62:46.96]element
[62:49.52]which is going to have a class name of
[62:52.07]relative.
[62:53.83]And here simply we're going to render
[62:56.31]the children meaning that that layout is
[62:59.76]going to render all the pages inside of
[63:02.48]it. Okay. Okay. But where are we going
[63:06.72]to render our nav bars? Actually, we're
[63:10.16]going to render them here on the top of
[63:12.96]the page. Right. So, here we're going to
[63:15.92]need to render a private navbar if user
[63:18.88]exists. Otherwise, render a public nav
[63:22.64]bar. And this means that we're going to
[63:25.28]need to get the user instance. So we're
[63:29.28]going to say connest user equals to
[63:32.00]current user coming from clerk nex.js
[63:36.40]server
[63:38.07]and then here simply we're going to say
[63:40.07]if the user exists render the private
[63:43.11]nav bar otherwise render the public nav
[63:47.92]bar. And here of course Typescript is
[63:51.11]complaining because we're going to need
[63:53.35]to say await here.
[63:56.24]And of course here we're going to need
[63:57.83]to create those two components, the
[64:00.72]private and the public nav bars. And let
[64:04.55]me start by creating the public navbar.
[64:07.20]Okay, since right now we are signed out,
[64:10.55]we didn't sign in yet. So let's create
[64:13.20]the public navbar in order to see it. So
[64:16.55]copy that and then go to components,
[64:20.55]create a new file,
[64:23.03]name it public navbar.tsx. tsx
[64:27.20]and then here we're going to say export
[64:29.76]default
[64:33.11]function
[64:34.72]public navbar
[64:37.20]that's going to return a nav element of
[64:40.24]course since this is a navbar and that
[64:44.00]nav element is going to have those
[64:46.24]styles and now since we want to see our
[64:50.00]public nav bar updated live we're going
[64:53.20]to create the book crowd But for now,
[64:55.92]the page is not found. So, let's go here
[64:58.96]to the main route.
[65:03.68]And under it, we're going to have a
[65:07.03]route group named public inside
[65:09.76]parenthesis like that. And inside of
[65:12.48]public, let's create another folder
[65:15.44]named book.
[65:17.76]And inside of it, let's just create a
[65:21.11]new file for now named page.tsx. tsx
[65:25.28]and here let's create anything for now
[65:28.40]let's say export default
[65:31.52]page function page
[65:36.16]that's going to return
[65:38.64]h1 saying
[65:41.44]book page
[65:44.96]and here let's comment that in the
[65:48.96]layout file and just render the public
[65:51.68]navbar
[65:57.83]import it.
[66:00.55]And now let's save here. So there we go.
[66:04.64]We have our navbar here. This is the nav
[66:08.07]element styled like that. As you can
[66:11.20]see, it has a shadow shadow to x large.
[66:13.68]It has a gray background, dark gr dark
[66:16.07]dark gray background, which is gray 300
[66:19.44]and so on. So let's put elements inside
[66:22.48]of it like the logo and the login and
[66:24.96]register buttons. Here we're going to
[66:28.00]put the logo
[66:30.64]which is going to render a next link
[66:32.64]coming from next link. And here it's
[66:36.64]going to render a next image coming also
[66:39.20]from next image. And that image of
[66:42.16]course is going to render the logo. Now
[66:44.40]click save. As you can see, this is our
[66:48.40]logo. And of course, that logo is going
[66:51.59]to point to the login page here.
[66:58.00]See?
[67:00.48]And here we want to render the nav links
[67:03.03]which will contain the login and
[67:04.55]register buttons. Here we're going to
[67:06.79]render a component from clerk named sign
[67:09.92]in button. This component will point
[67:13.83]directly to the login page. When the
[67:16.31]user clicks on that button, it's going
[67:18.64]to point automatically to the login
[67:21.03]page. Okay. So, let's import it from
[67:23.28]clerk.
[67:25.44]And here we are rendering a button from
[67:27.20]shad cen. We're going to install chat
[67:28.96]cnen in a minute. But let's also import
[67:32.55]the sign up button which will point to
[67:35.35]the register page. Okay.
[67:39.52]Now let's install that chat cm button.
[67:43.52]Let's go to chat UI and let's go to
[67:47.11]getting started installation next.js
[67:51.11]and then copy that command.
[67:55.52]No, sorry, the mpm command. Yeah, copy
[67:58.72]that command
[68:00.72]and let's go back to our terminal
[68:05.35]and paste that command.
[68:08.64]Press enter. Choose the neutral color or
[68:12.48]whatever color you want. Then choose use
[68:15.20]force because here as you can see there
[68:17.67]is an issue that has been going for a
[68:19.52]while now because of React 19. We are
[68:22.71]using React 19 and this will cause a
[68:25.75]peer dependency issue stuff like that.
[68:29.27]So in order to fix it just choose to use
[68:32.79]dash force. Press enter here.
[68:36.79]And now shad cenne is installed. After
[68:39.75]you install shad cen, you're going to
[68:41.44]see that a file named components. I
[68:45.27]think components um json. Yeah, that
[68:49.52]file.
[68:51.35]This file has been added to you by
[68:53.60]shaden.
[68:55.83]Okay, leave it as it is. And also you
[68:59.92]can see that ellip folder is added.
[69:02.79]Yeah, here
[69:04.79]that has a utility file and that
[69:08.64]utilities file will contain this
[69:11.35]function named CN. This function is
[69:14.48]created by shad CN that will allow us to
[69:17.19]add dynamic class names to HTML
[69:20.71]elements. Okay, we're going to use it a
[69:22.96]lot in our project.
[69:25.27]So, let's close that file for now and
[69:28.00]let's add the shad cm button. Okay, how
[69:31.83]are we going to do that? Search in the
[69:33.60]documentation for button.
[69:38.15]Yeah, this one.
[69:41.04]This is the button that we want. All
[69:43.52]we're going to need to do is to type MPX
[69:46.00]chat at latest add button. So, copy that
[69:49.67]command
[69:51.60]and just paste it here
[69:55.84]and press enter.
[69:58.88]also use d-force
[70:02.71]and now the button component has been
[70:05.19]added under components UI button.tsx.
[70:10.64]So if we go here to the components
[70:12.80]folder you can see that a UI folder has
[70:15.92]been added and inside of it this is our
[70:18.88]button component. Okay, this is created
[70:22.40]by chat. So, all we're going to need to
[70:25.67]do here is to import that button
[70:27.92]component
[70:30.48]from UI button.
[70:33.36]And there you go. This is our public
[70:36.80]navbar. Oh, it looks like chaten has um
[70:40.96]messed up some of our styles. Let's see
[70:43.92]what's going on. Let's see the globals.
[70:46.96]CSS file. So yeah, I think that Shatn
[70:50.56]added that Tailwind animate CSS, but we
[70:53.92]don't have it yet. So let's install it.
[70:55.92]Copy that. Open the terminal and type
[70:59.04]mpm install
[71:02.40]that package. Tailwind animate CSS.
[71:05.60]And now let's reload the page. And there
[71:08.48]you go. This is our public navbar.
[71:12.96]If I click here on the login button,
[71:14.96]it's going to redirect me to the login
[71:16.88]page.
[71:18.23]And if I click on the register button,
[71:20.64]it's going to redirect me to the
[71:22.48]register page. Yeah, this one.
[71:26.08]So yeah, this is our public navbar.
[71:30.08]And now let's go ahead and create the
[71:32.23]private navbar.
[71:35.12]Close that.
[71:38.32]Also close that. And here we're going to
[71:41.12]need to create that private nav bar.
[71:46.56]Let's go to components. Create a new
[71:49.28]file private navbar.tsx.
[71:54.08]And here export
[71:56.96]default
[72:00.15]function
[72:02.88]private navbar.
[72:05.92]And here before we do anything, let's
[72:08.00]sign in in order to see the private
[72:10.23]navbar. It's signing in.
[72:16.08]verify your human.
[72:20.40]Okay, nice. Now we are signed in and
[72:23.04]redirected to the events page. Remember
[72:25.84]here in the f file we said that after
[72:30.32]sign in force redirect to the events
[72:33.60]page. So also let's create um a
[72:37.44]temporary events page for now. Inside of
[72:40.71]main, we're going to create a new route
[72:43.19]group
[72:44.80]named private.
[72:47.44]And inside of private, we're going to
[72:49.60]create another folder named events.
[72:54.88]And inside of events, let's create a
[72:57.76]page.tsx
[72:59.60]file.
[73:01.67]And here, let's say export default
[73:05.12]function page.
[73:09.36]That's going to return
[73:12.23]H1 saying
[73:14.64]events.
[73:16.32]Now click save.
[73:19.12]And there we go. We have the events page
[73:21.28]here. And now let's continue creating
[73:24.40]the private navbar. Also this component
[73:27.67]is going to return
[73:29.92]a nav element of course
[73:33.76]which is going to have these class
[73:35.60]names.
[73:37.28]And here also we're going to render
[73:41.12]the logo. Nothing different.
[73:44.48]Import the next link. Also the image.
[73:49.76]Click save. And of course here we are we
[73:52.15]are still seeing the private navbar
[73:54.32]because here we're going to have to
[73:57.60]revert back to this logic.
[74:01.28]So uncomment that. Right now we have a
[74:04.08]user.
[74:06.40]So if we import the private navbar, we
[74:09.84]should see it here.
[74:12.32]There you go. This is the private
[74:13.92]navbar. So here below the logo, we're
[74:16.71]going to need to render the nav links.
[74:18.56]Remember the events, my schedule, public
[74:22.71]profile, and so on. So we're going to
[74:25.52]render them here.
[74:27.76]It's going to render a section that has
[74:30.08]all of these class names and a div. And
[74:33.12]inside of that div, we're going to map
[74:34.80]on something called private nav links.
[74:38.00]Let's create these private nav links.
[74:41.44]So let's go to the constants file
[74:45.76]and say export con private nav links.
[74:49.12]And those are our links. Each one has an
[74:52.80]image URL displaying the icon of the of
[74:55.92]the nav link. This is the route and this
[74:59.04]is the label that we're going to see
[75:00.96]here.
[75:02.56]So save that
[75:06.32]and let's import that here from
[75:09.19]constants.
[75:11.52]And here we are checking if the nav link
[75:13.60]item is active or not. Meaning that if
[75:16.64]the user is displaying my events page
[75:19.28]for example, we want to display the my
[75:22.23]events nav link differently. If they are
[75:25.52]displaying my schedule, we want to also
[75:28.64]style the my schedule link differently
[75:31.12]and so on. So here we're saying connest
[75:33.76]is active and we're going to set it to
[75:36.56]true if the path name equals to the
[75:39.19]item.oute
[75:41.19]or if it starts with the item.oute
[75:44.64]forward slash. So in that case the
[75:48.23]item.oute here is events and the pass
[75:51.19]name is events. And also if I'm viewing
[75:54.80]events forward slash anything else also
[75:57.67]I want to check if it starts with events
[76:00.71]then forward slash. Okay, I hope it's
[76:03.67]clear. Now we're going to need to get
[76:06.48]that path name from where are we going
[76:09.04]to get it? Simply we're going to go up
[76:11.92]here and say conest path name equals to
[76:14.80]use path name coming from next
[76:18.00]navigation. And here as I told you
[76:21.92]before this is the CM function coming
[76:25.60]from shad CN. As you can see it allows
[76:28.40]us to add dynamic class names like that.
[76:31.76]If any link item is active style it
[76:35.52]differently like that. Give it like a
[76:37.92]slightly blue background a rounded 3x
[76:41.44]large and so on. So let's import that
[76:44.71]from lib utils. Click save. And now
[76:48.96]let's reload the page. So yeah, here
[76:51.92]it's complaining because use path name
[76:55.67]is a hook that requires that to be a
[76:58.88]client component. So we're going to say
[77:01.28]here at the top of the file, it has to
[77:03.60]be on the top of the file. Okay, we're
[77:05.84]going to say use client. Now click save.
[77:10.00]And there we go. This is our nav bar.
[77:15.04]Now we're going to need to add the user
[77:16.80]button here on the right hand side.
[77:19.92]So below the section here, add the user
[77:23.04]button which is going to render a signed
[77:26.15]in component. This signed in component
[77:28.80]also coming from clerk will
[77:31.67]conditionally render the user button if
[77:34.71]the user is signed in. Actually anything
[77:37.44]you put inside that signed in component
[77:40.40]will be rendered only if the user is
[77:43.44]signed in. Okay, if the user is not
[77:46.56]signed in, it's not going to be
[77:48.23]rendered. Anything inside that signed in
[77:50.80]component is not going to be rendered if
[77:53.92]the user is not signed in. So let's
[77:56.96]import it from clerk. And here also
[77:59.60]import the user button from clerk. And
[78:02.08]now click save.
[78:04.15]And yeah, there you go. This is our
[78:06.71]private nav bar. On small screens, it's
[78:10.08]going to show only the icons.
[78:12.88]And on large screens, it's going to show
[78:15.12]also the label. This is the user button.
[78:20.15]And as you can see here, since I'm
[78:21.84]viewing the events page, that nav link,
[78:24.48]my events link is styled differently
[78:27.04]with a blue background because it's the
[78:29.67]active link. So yeah, those are our nav
[78:32.80]bars. This is the private nav bar and
[78:35.44]this is of course the public nav bar.
[78:39.12]Now let's move on to the next step in
[78:41.60]our application.
[78:44.96]All right. Now let's set up the events
[78:47.52]page. This is where users will see all
[78:51.04]their events if they made any.
[78:54.00]And if they haven't yet or just want to
[78:56.32]add a new one, we're going to make it
[78:58.32]super easy for them to jump over to the
[79:00.88]event creation page. Okay. So let's
[79:04.71]close all file and jump to the events
[79:07.76]page. Then remove that.
[79:11.36]And here let's return a section, a
[79:14.48]section element
[79:16.56]which is going to have all of these
[79:18.56]class names. We want it flex flex call
[79:22.23]items center gap 16 and we're adding the
[79:27.36]fade in animation.
[79:29.76]And then here we want to render a page
[79:31.84]title and a new event button. And this
[79:35.36]is why we're going to add a div here
[79:38.56]that's going to render an H1 element
[79:40.96]displaying the word events. And here
[79:43.60]we're rendering a button from chaten
[79:47.60]that has
[79:50.08]a link from next link
[79:53.67]displaying the word create event. And
[79:56.80]when the user clicks on that link, it's
[79:58.88]going to redirect them to the events
[80:01.52]forward slashnew page in order to be
[80:04.56]able to create a new event.
[80:07.52]And here we're rendering an icon from
[80:10.56]Louiside React. It's a calendar plus
[80:14.56]icon. Very simple. Now let's reload the
[80:17.36]page. And there we go. We have events
[80:21.04]and a create event button. If I click on
[80:23.36]it, it's going to redirect me to the new
[80:25.67]event page. Now, let's go back here. And
[80:29.19]of course, the styling of that button is
[80:32.15]coming from here from all of these
[80:34.56]styles. And if you're wondering what is
[80:37.44]this as child, it's simply going to
[80:40.32]render all of this as a link right away.
[80:43.44]Meaning that it's not going to render a
[80:46.00]button
[80:47.92]then
[80:49.84]a link like that inside of it.
[80:52.40]No, when you say as child, it's going to
[80:55.28]neglect that button and it's going to
[80:58.96]render a link or an a element which is a
[81:02.08]link right away. Okay. And if you want I
[81:06.00]can leave comments for you here
[81:08.56]explaining this.
[81:10.71]Okay. Then here I left a comment for you
[81:13.60]saying that without the as child the
[81:16.40]button would render like this button and
[81:19.44]an alink inside of it. With the as child
[81:23.60]it's going to render as an alink right
[81:26.71]away. It's not going to render a button
[81:28.88]like that. And we typically use this if
[81:31.92]we want another element like a link to
[81:34.23]look and behave like a button without
[81:36.40]breaking the HTML semantics. Okay,
[81:41.60]now let's save and move on to the next
[81:44.40]step. So right now let's create the new
[81:47.84]event page. Let's go to private events.
[81:52.40]Then inside events, let's create a new
[81:54.96]folder named new.
[81:58.80]And inside of new, let's create a
[82:01.19]page.tsx
[82:03.04]file.
[82:04.80]And here first of all let's add a
[82:06.63]comment explaining what does this page
[82:10.15]do. Then let's create the page.
[82:14.23]Then inside of this page I want to
[82:16.71]render a card from chaten. Let's go to
[82:20.00]chatsen and let's search for card.
[82:25.12]And this is the card that I'm talking
[82:27.28]about. I want to render a card. And
[82:29.67]inside of this card, I want to render a
[82:32.15]form or to be precise, I want to render
[82:34.96]an event form in order to allow users to
[82:37.76]create a new event. So, in order to
[82:41.04]install cards, we're going to copy that
[82:43.28]command. Let's go back here, open the
[82:46.00]terminal, and paste that command.
[82:51.60]Also, it's added inside of the UI
[82:54.15]folder. And now, let's take a look at
[82:56.80]the code. This is the card code. Any
[83:00.88]Shhatsen card will have, of course, a
[83:03.44]card component, then a card header
[83:05.60]displaying the header description, then
[83:08.88]the card content, and then the card
[83:11.67]footer.
[83:13.19]So, let's here create our own card.
[83:16.08]We're going to return a card element
[83:18.71]that has these styles. Let's import the
[83:22.23]card
[83:24.00]from UI card. And then we're going to
[83:26.88]display the card header and the card
[83:29.44]title. Let's import them.
[83:32.56]And then here we're going to display the
[83:34.40]card content, which is the event form
[83:37.76]component. Of course, we didn't create
[83:40.56]that event form just yet. We're going to
[83:42.71]create it later. But import the card
[83:46.48]content for now.
[83:48.80]If I comment this and save, I should see
[83:52.56]the card here. Yeah, exactly. This is
[83:56.00]the shaden cord displaying new events
[83:59.60]which will allow users to create a new
[84:01.52]event. And that styling came from these
[84:04.80]Tailwind CSS styles.
[84:09.60]And now let's create that event form
[84:11.92]component. But before we create it,
[84:15.52]since we're going to use form also from
[84:17.67]Shad CN, let's take a look at it.
[84:23.36]Okay, here forms by the way uses React
[84:26.40]hook form. Okay, as you can see here,
[84:30.40]they're saying that the form component
[84:32.71]is a wrapper around the React hook form
[84:36.23]library. It uses all of these stuff, but
[84:41.04]all we care about here is that it uses
[84:43.36]Zod for input validation.
[84:46.88]So also we're going to need to install
[84:49.28]ZOD in order to be able to create our
[84:52.00]own schema. And this is how forms look
[84:55.52]in chaten a parent form component that
[84:59.19]has form field. For example, let's take
[85:02.00]a look here. If you want to create a
[85:04.63]form, you're going to use use form from
[85:06.96]react hook form. And then you're going
[85:10.08]to render the form field control equal
[85:12.80]to form.
[85:14.88]name for example equal to username
[85:18.00]and the render method takes the field.
[85:20.80]You have also form label you can put
[85:23.12]username inside of it and so on form
[85:26.08]description.
[85:27.76]So it gives you a lot of options and
[85:30.63]also here they're explaining how to
[85:33.19]create a schema as we were saying we're
[85:35.44]going to use Zot then we're going to
[85:37.60]create a form schema for example which
[85:39.84]is equal to Z or Z do object Z
[85:43.60]represents the zod package
[85:47.28]and here you want to validate the
[85:49.52]username for example you want to specify
[85:51.67]some rules for the username so that when
[85:54.80]the user inputs a username it has to a
[85:57.60]string. It can't be less than two
[86:00.56]characters and it can't be more than 50
[86:04.40]characters. So let's say a user entered
[86:07.76]a username of just one character. Let's
[86:10.23]say they add the letter or. In that
[86:13.60]case, Zod is going to give them an error
[86:16.71]saying something like username has to be
[86:22.56]more than
[86:25.12]two characters.
[86:27.36]And by the way, we can add a second
[86:29.44]argument here to specify the type of
[86:32.15]message you want to provide for the
[86:33.76]user. We're going to see all of that.
[86:36.08]And let's say that the the username
[86:38.71]exceeded 50 characters. Also, Zod is
[86:42.56]going to provide a message or a custom
[86:44.40]message that we created and so on. It's
[86:47.28]it also has to be a string. So, let's
[86:50.08]say the the input the username of a
[86:53.92]number. let's say they input the number
[86:56.56]10 also they are going to get an error
[86:59.52]and of course this is very very
[87:02.08]important you don't want users to enter
[87:04.23]a nonvalidated input or or a malicious
[87:07.19]text or anything like that so here this
[87:10.63]is an example usage this is a form
[87:13.04]schema we're going to say zobject and
[87:16.15]the username as we said has to be a
[87:18.23]string minimum of two characters and
[87:21.44]this is the custom message I told you
[87:23.52]out. You can type whatever you want
[87:26.08]here. And here when you're creating your
[87:28.63]form, you're going to say use form of
[87:31.36]type Z.infer type of the form schema
[87:35.12]that you just created. And its resolver
[87:38.00]is going to be Zod resolver taking the
[87:41.04]form schema. So ZOD is going to resolve
[87:44.63]all of that using your form schema. And
[87:47.67]then here of course you can provide
[87:49.52]default values like username is an empty
[87:52.56]string and so on. This is the initial
[87:55.12]values. And then you define a submit
[87:57.52]handler like an onsubmit function which
[88:00.71]is going to take values of type z.infer
[88:05.36]type of also your form schema. So
[88:09.12]everything is coming from the schema
[88:11.67]that you create. And then here you can
[88:14.32]do anything with the form values. And of
[88:17.12]course it will be type save and
[88:19.04]validate.
[88:20.63]And that's it. Now all we need to do is
[88:22.88]to install the form. So let's go here
[88:26.32]and copy that command. And let's go back
[88:29.28]here and paste it in our terminal.
[88:32.48]Use force. And then let's quickly
[88:35.28]install Zot. Go to Google and search for
[88:38.63]Zot.
[88:40.63]Then go to their website.
[88:44.32]Go to installation.
[88:47.12]And then from mpm type that command mpm
[88:51.60]install zod. Let's copy that. And also
[88:55.04]let's paste it here. And now we are good
[88:58.23]to go. Let's copy
[89:01.60]that event form
[89:04.00]and go to components.
[89:06.88]And inside of it, let's create another
[89:08.80]folder named forms
[89:11.19]as we're going to have many forms in
[89:13.28]this project. inside of it. Let's create
[89:15.84]a new file named event form.tsx.
[89:20.32]And there we go.
[89:22.88]It's going to be a client component
[89:25.28]file. So at the top type use client. Add
[89:28.71]a comment here.
[89:30.88]And let's here create the component.
[89:33.44]It's a component to handle creating,
[89:35.52]editing, and deleting an event. Of
[89:38.71]course, we're going to say export
[89:41.04]default
[89:43.36]function
[89:44.96]event form.
[89:46.96]And since this component is going to be
[89:49.12]used for either creating, editing, or
[89:52.15]deleting an event, it can take an event,
[89:56.71]right? If we are creating a new event,
[89:59.76]it's not going to take an event. But if
[90:02.00]we are updating or editing an event or
[90:04.48]even deleting an event, in that case
[90:07.04]it's going to need the event that it's
[90:09.52]going to edit, right? So this means that
[90:13.44]that event has to be optional. And this
[90:17.36]is why we're going to say that that
[90:19.28]event is going to be of type event, but
[90:23.76]it's going to be optional. That question
[90:25.92]mark indicates that that event is going
[90:28.15]to be optional.
[90:30.32]And it's going to take an ID of type
[90:32.15]string, name of type string, description
[90:35.44]which is optional also of type string,
[90:38.40]duration in minutes of type number, and
[90:41.67]is active of type boolean.
[90:45.60]And then our next step is to create a
[90:48.08]form
[90:49.60]like we saw exactly in the shaden
[90:52.96]documentation.
[90:54.71]So here we're going to say const form
[90:56.96]equals to
[90:59.19]and then we're going to say use form
[91:02.15]coming from react hook form
[91:05.19]Z
[91:08.40]from Z. Here it's going to import Z from
[91:11.84]Zot
[91:13.84]and then infer the type from the type of
[91:16.56]event form schema.
[91:19.76]So we're going to have to create that.
[91:22.32]But now let's call the use form
[91:25.19]function. And right now let's go here
[91:28.63]and create a new folder in the home
[91:30.56]directory named schema.
[91:34.23]And inside of it let's create a file
[91:36.48]named event.ts
[91:41.36]or let's say events.
[91:45.04]This is where we're going to create our
[91:47.12]event schema.
[91:50.32]So we're going to say export conest
[91:53.36]event form schema equals to Z do object
[91:58.23]and that Z also coming from Zot
[92:02.08]and that object is going to take an
[92:04.88]object as its argument and inside of
[92:07.92]here we're going to define all of our
[92:09.92]schema values.
[92:13.52]Like for example, the name must be a
[92:15.76]string minimum of one character. And
[92:19.76]here we're just providing this message
[92:21.52]saying required. And this is the
[92:23.84]description which is optional. And here
[92:26.15]is active which is a boolean. And here
[92:29.28]the duration in minutes has to be a
[92:31.60]number. And we're going to convert that
[92:33.67]number. Co means convert. So the
[92:37.60]duration in minutes will be converted to
[92:40.71]a number. And it has to be an integer
[92:44.08]positive. And we're providing that
[92:46.48]message that it has to be greater than
[92:49.76]zero. And it has to be equal to 720
[92:56.08]minutes, which is equal to 12 hours.
[93:00.08]Okay, this is our event schema. Let's go
[93:03.28]back here and import it.
[93:06.80]There we go. And here the use form also
[93:09.92]takes an object. And remember it has to
[93:12.96]take a resolver which is equal to zod
[93:16.00]resolver. And that zod resolver is going
[93:19.36]to come from hook form zod resolvers
[93:23.76]here. And of course it's going to
[93:25.84]validate with our event form schema. And
[93:29.67]here we're going to need to provide
[93:31.52]default values. And we're going to have
[93:33.60]to say that in case we have an event get
[93:36.56]those default values from that event.
[93:40.96]And if we don't have an event, we have
[93:43.04]to provide default values. So how are we
[93:46.32]going to do that? We're going to say if
[93:49.19]we have an event here by by providing
[93:52.08]that question mark, if we have an event,
[93:55.44]take everything from the event. This is
[93:57.76]a spread operator, meaning that we are
[94:00.48]copying everything from the event.
[94:03.60]Otherwise, we're going to provide our
[94:05.92]own default values. This is why we wrote
[94:08.71]a colon here. So this is eternary
[94:11.36]operator. We're saying if the event
[94:14.00]exists take the default values from that
[94:17.12]event. Otherwise take it from that
[94:20.00]object which is our own default values.
[94:24.56]Is active is true. Duration in minutes
[94:27.04]it's going to be 30 by default.
[94:29.67]Description empty string. And the name
[94:32.40]also is an empty string.
[94:36.15]And now we're going to need to render
[94:37.84]the actual form. Right? So we're going
[94:39.84]to say return
[94:42.23]and here we're going to render the form
[94:44.88]from shaden
[94:49.36]and that form is going to take
[94:50.96]everything from the form instance that
[94:53.76]we just created. And in here we're going
[94:56.32]to render our actual form displaying a
[94:59.04]normal HTML form.
[95:02.32]Don't worry, we're going to explain all
[95:03.84]of that
[95:05.76]here. onsubmit. We're going to execute
[95:08.56]the onsubmit function that we're going
[95:10.40]to create later. And here we are showing
[95:13.60]a root error if there are any errors.
[95:16.00]Meaning that if there are any errors at
[95:18.23]the form, just show them here. And here
[95:20.96]we are rendering the form field that we
[95:23.12]saw before in the Shatsen documentation.
[95:25.52]Let's import it. Its control is going to
[95:28.56]come from the form.
[95:30.96]And here the name name rendering the
[95:34.32]field. Let's import all of that.
[95:38.00]Here we are typing in the label event
[95:40.08]name and here a form control. And here
[95:43.12]we're going to display an input also
[95:45.92]coming from shad cen
[95:48.63]that's going to take everything from the
[95:51.12]field in order to input the event name
[95:54.00]from the user. So let's install that.
[95:56.63]Gonna open the terminal
[95:58.88]and type MPX chaten at latest add input.
[96:06.48]There you go. Now we can import it
[96:09.76]from UI input.
[96:12.88]This is the form description
[96:16.63]and this is the form message and this is
[96:20.15]going to be the duration field. Also the
[96:23.60]same concept. And here we're going to
[96:26.40]need to install a text area for the
[96:29.60]optional description field. So open the
[96:32.40]terminal and add
[96:36.15]text area
[96:39.60]then import it.
[96:42.48]And here we want to render the the two
[96:45.52]for active status. Remember active is
[96:48.23]active.
[96:49.76]And here we're going to need a switch
[96:51.36]for that. Let's take a look at that
[96:52.96]switch. Let's go here to chaten and
[96:56.00]search for switch.
[97:00.00]And this is the switch that I'm talking
[97:02.48]about. We're going to copy that command,
[97:06.56]open the terminal, and paste it here.
[97:10.48]Use force.
[97:12.48]Then let's import it.
[97:16.23]Of course, its checked value is going to
[97:18.40]come from the field do value and
[97:21.04]unchecked change is going to be equal to
[97:23.52]field do onchange.
[97:26.15]And here are the buttons section. The
[97:29.44]delete, cancel, and save buttons. Here
[97:32.56]we're going to use alert dialogue from
[97:34.56]chatzen. Let's take a look at it. Okay,
[97:38.96]alert dialogue.
[97:42.08]See when I click here, it's going to
[97:44.88]give me that alert dialogue with two
[97:47.92]buttons like that. So let's install the
[97:51.44]alert dialogue. Copy and paste that in
[97:54.00]your terminal. Then choose use force.
[97:58.23]And here we're going to show the delete
[97:59.84]button only if the event exists. And
[98:03.60]then here we're going to show the cancel
[98:05.60]button. And here the save button. So
[98:09.44]here let's import all of that.
[98:15.19]And here we want to disable the delete
[98:18.32]button in two cases. If the form is
[98:22.80]submitting by using form of do form
[98:27.04]state issubmitting or if the delete is
[98:31.52]pending. So we're going to need to
[98:33.60]create a state for that. Right? So let's
[98:37.19]go up here.
[98:40.23]And let me ask you a question. Are we
[98:43.76]going to use a normal use state?
[98:47.11]Actually not. We're going to use
[98:49.36]something called use transition, which
[98:52.40]is a React hook that helps manage the
[98:55.84]state of transitions in asynchronous
[98:58.32]operations. In our case, it's going to
[99:00.63]return two values. is delete pending,
[99:03.67]which is a state that tells us if the
[99:06.08]deletion is still in progress. And also,
[99:09.60]it's going to give us this function
[99:11.84]start delete transition, which is a
[99:14.40]function that we can use to start the
[99:16.56]asynchronous operation when we are
[99:19.52]deleting the event. We're going to use
[99:21.60]that later, but right now, let's import
[99:24.71]that from React.
[99:27.60]And here when the user deletes an event
[99:30.63]or try to delete an event, we're going
[99:32.48]to ask him, are you sure this action
[99:35.44]can't be undone? This will permanently
[99:38.48]delete this event.
[99:41.44]So let's import also all of these
[99:45.67]alert dialogue components.
[99:49.44]And this is the option to cancel.
[99:53.84]And this is the alert dialogue actual
[99:57.28]action.
[99:58.88]And remember when I told you that we're
[100:01.04]going to use the start delete transition
[100:03.60]at some point. This is the point that
[100:06.15]I'm talking about on click here. When we
[100:08.80]click or when the user clicks on the
[100:10.56]delete button, we're going to start the
[100:12.96]delete transition which is going to take
[100:15.67]an asynchronous call back function and
[100:17.76]inside of that function, we're going to
[100:19.52]call a delete event function. Of course,
[100:22.56]we're going to define this function
[100:24.08]later, but for now, let's continue. And
[100:27.92]here, if the user cancel creating an
[100:30.88]event, we're going to redirect them to
[100:34.00]the events page. And here also, the save
[100:37.84]button is going to be disabled if the
[100:40.15]form is submitting or is delete pending
[100:44.23]because we don't want uh a user
[100:46.23]submitting and deleting an event at the
[100:49.04]same time. Okay.
[100:52.23]And now let's go ahead and create that
[100:54.80]onsubmit function. So let's go up here
[100:58.15]and type
[101:00.23]async function
[101:04.56]on
[101:06.08]submit.
[101:08.63]And of course this function is going to
[101:10.80]handle form submission.
[101:13.60]And this function is going to take
[101:15.67]values of type Z do.infer infer the type
[101:19.11]of event form schema. And then here we
[101:22.80]want to create an action depending on
[101:25.28]whether we have an event or not. Meaning
[101:27.67]that if we have an event, then we're
[101:30.48]going to update that event. If we don't
[101:33.04]have an event, then we're going to
[101:34.56]create a new event. Right? So here we're
[101:38.40]going to say if the event is null, make
[101:41.67]the action equal to a create event
[101:44.23]function. Of course, we're going to
[101:46.15]create it later. And if the event is not
[101:48.63]null, make the action equal to update
[101:51.19]event and bind to this function the
[101:53.52]event do ID. Here we're making the
[101:56.15]update event always take the event do ID
[101:58.80]by binding it by using that bind method.
[102:02.23]This is built in in JavaScript. Okay.
[102:04.80]And then here we're going to create a
[102:06.40]try catch block. And here we're going to
[102:08.80]say in case of any error form set error
[102:12.23]as a root error. And then the message of
[102:15.28]the error is going to be there was an
[102:17.84]error saving your event. And then we're
[102:19.52]going to display the error dossage. So
[102:21.36]here we're going to have to take an
[102:23.52]error and let's say of type any. And
[102:26.56]here simply we're going to say await
[102:29.92]action.
[102:31.67]Of course since the action is always
[102:34.23]going to be a function either it's going
[102:35.92]to be a create event or update event. So
[102:38.71]we're going to have to call it here
[102:40.80]using the values. All right. Then I
[102:45.67]think now we have bunch of functions
[102:47.76]that we have to create. So first let's
[102:49.84]create that create event function.
[102:53.19]And those are going to be server
[102:56.23]actions. Okay. And if you're not
[102:58.48]familiar with the server actions in
[103:00.63]Nex.js, they're like tasks your server
[103:03.76]does when you ask it to. kind of like
[103:06.32]sending a request to a restaurant for a
[103:08.56]specific dish. Imagine you're ordering
[103:10.96]food. You tell the waiter what you want.
[103:14.40]In that case, it's going to be create,
[103:16.23]update, or delete something. And then
[103:19.11]they are going to take your order to the
[103:21.67]kitchen, which is the server, where the
[103:24.48]action actually happens. This is the
[103:28.23]cooking phase, you know. And once the
[103:31.52]dish is ready, the waiter brings it back
[103:34.71]to you. For example, if you want to
[103:37.44]delete an event from your calendar app,
[103:39.92]the server action tells the server to
[103:42.63]remove that event from the database. And
[103:45.52]once done, it sends back a confirmation
[103:48.00]that the event was deleted. And this
[103:51.36]way, Nex.js JS made creating uh a server
[103:55.28]functions or server actions really easy
[103:57.92]because you don't have to create a
[103:59.44]server or u or install a server or
[104:02.40]anything like that. As you can see, we
[104:04.88]are not using express server or anything
[104:07.04]like that. All we're going to need to do
[104:09.04]is to go here and let's create
[104:14.40]a folder here named server.
[104:19.28]And then inside of it, we're going to
[104:21.19]create another folder named actions.
[104:26.23]And then inside of actions, we're going
[104:28.15]to create a new file which is the events
[104:32.48]action or actions. We're going to call
[104:35.11]it events.ts.
[104:37.52]And this file will hold all of our
[104:40.23]events actions. And the first thing that
[104:43.67]you need to do here is to say use
[104:47.92]server. This is very important by the
[104:50.63]way. Okay, you have to write this at the
[104:53.19]top of the file to indicate to Nex.js
[104:56.00]that this is a server file. I'm going to
[104:59.92]add a comment here for you. As you can
[105:03.19]see, this is required for Nex.js app
[105:06.08]router. Okay. And then let's create the
[105:09.52]function which is going to create a new
[105:11.11]event which is actually the create event
[105:13.84]action. So we're going to say export
[105:16.40]asynchronous function create event.
[105:19.67]And this function is going to take
[105:21.36]something called unsafe data and we're
[105:24.15]going to infer that data that unsaved
[105:27.67]data. As you can see this is row event
[105:30.48]data. Okay. We're going to infer
[105:33.84]that data using the event form schema.
[105:37.60]So we're going to import that Z from Zot
[105:41.04]and also we're going to import our event
[105:43.44]for schema. And this function is going
[105:46.63]to return a promise just a promise. It's
[105:50.15]going to resolve to void. Void means
[105:52.88]nothing. But since this is an
[105:55.19]asynchronous function, it's going to
[105:57.11]return a promise.
[105:59.44]And then inside of this function we have
[106:02.48]to kind of filter that unsafe data. This
[106:05.60]is why we called it unsafe data. So
[106:08.88]first of all we're going to open a try
[106:11.52]catch block here catch
[106:15.60]error of type any.
[106:18.63]And here in case of any error we're just
[106:20.80]going to throw a new error. And here as
[106:24.48]we said we want to validate these data.
[106:27.11]Remember we were taking values to that
[106:30.08]create event function here. We are
[106:32.80]calling the create event function here
[106:34.88]in the action with the values. So we
[106:37.60]want to validate them. So we're going to
[106:40.23]say event form schema safe parse the
[106:43.60]unsafe data. So basically here we're
[106:46.40]considering these as unsafe data and
[106:49.19]here we are safe parsing them to make
[106:52.71]sure that we are we are kind of
[106:55.44]filtering these data. Okay. And we are
[106:58.15]using our form schema event form schema
[107:00.71]to do that. And of course in case of
[107:03.67]success we're going to dstructure the
[107:06.15]success and the actual data from the
[107:08.71]returned data. And here we're going to
[107:11.28]say in case there is no success just
[107:14.56]through an error also if I don't have
[107:17.67]user ID through an error. So here we
[107:21.04]have to take the user ID and this is why
[107:23.92]here we're going to dstructure the user
[107:25.92]ID from a function called oath coming
[107:28.32]from clerk in order to authenticate the
[107:31.36]user.
[107:33.11]So in case we don't have a user ID or we
[107:35.84]don't have a success from here just
[107:37.92]through an error otherwise
[107:40.80]continue with the function. Okay. But
[107:43.60]what do we want to do here? Actually we
[107:46.15]want to insert the validated event data
[107:48.80]into our database right and we want to
[107:51.44]link them to the authenticated user. So
[107:55.04]basically want to tell our database, hey
[107:57.28]just take that event data related to
[108:00.56]that user and put them in your data base
[108:04.00]or in your events table. So we're going
[108:07.52]to say db which is the database. Let's
[108:11.11]import it from drizzle. We're going to
[108:13.44]say db dotinsert the to the event table
[108:17.44]do values. Let's also import the event
[108:20.48]table. We are we are telling our
[108:22.88]database to insert to the event table
[108:25.11]dot values that data and tie to the user
[108:29.84]ID to the clerk user ID. Here we are
[108:32.56]taking all the data putting them in the
[108:35.60]event table and we are linking these
[108:38.40]data to the authenticated user. We have
[108:40.63]a clerk user ID inside of our event
[108:43.04]table. So we are linking that user ID
[108:46.00]this one with our data. Okay. Okay,
[108:50.96]nice. But are we finished yet? Actually,
[108:54.23]we have one more step to do here. We're
[108:57.84]going to say finally after you finish
[109:00.80]everything, I want you to revalidate the
[109:03.84]events path and then redirect the user
[109:07.28]to that path which is forward/events.
[109:11.60]Here we are revalidating that path to
[109:14.56]ensure that the page fetches fresh data
[109:17.52]after the database operation. So when
[109:20.40]the user inserts new data to his uh
[109:23.84]events table and then get redirected to
[109:26.23]the events page, we want to show them
[109:28.48]fresh data. Okay. From where this
[109:31.52]function is coming from, it's coming
[109:33.19]from
[109:34.71]next forward slashcache and this
[109:37.92]redirect is coming from next navigation.
[109:41.92]And that is it. Now we have created the
[109:46.48]create event action. Let's now create
[109:50.23]this action update event. So let's go
[109:53.92]back here to the events actions file
[109:58.32]and we're going to create the update
[110:00.56]event function. It's also going to take
[110:03.28]unsaved data and returns a promise that
[110:06.32]resolves to void. But here we're going
[110:08.71]to have to take an ID which is a string
[110:12.56]because we're updating an event, an
[110:14.56]existing event. So this function needs
[110:16.80]to know the ID of the event it's going
[110:19.44]to update, right? And then inside of
[110:22.15]this function also we're going to create
[110:24.80]a try catch block. Here we're going to
[110:27.11]say try and let's here add the catch and
[110:30.32]finally blocks. They are the same as
[110:33.44]before as in the create event function.
[110:36.48]And here also we're going to do
[110:38.23]everything as before. We're going to
[110:41.28]take the user ID from both and then
[110:44.00]we're going to save parse the unsafe
[110:46.32]data and in case there is no success or
[110:49.52]no user ID we're going to throw a new
[110:52.23]error. Okay, but what is different here
[110:55.84]from before? Here as we said we are
[110:58.08]updating an existing event here. We're
[111:01.11]going to say await db.update Update the
[111:03.84]event table. Set it to the data that
[111:08.08]data that safe data for. Right now they
[111:11.11]are safe data. As you can see update
[111:13.36]with the validated data where and we're
[111:16.96]going to say and because we're going to
[111:19.92]give that and function two conditions
[111:22.80]and we want them both to be true. Okay.
[111:26.32]What are these two conditions? We want
[111:29.28]these to be equal and this is why we are
[111:32.32]using the equal function here. We want
[111:34.80]the event table dot id that event table
[111:38.80]to be equal to that ID which is the ID
[111:42.63]we gave to the function here and at the
[111:46.40]same time we want the event table dot
[111:49.36]clerk user ID to be equal to our user ID
[111:54.08]coming from here.
[111:56.80]Okay, great. But where are these
[111:59.76]functions coming from? Where do you
[112:01.84]think?
[112:03.44]Of course, they are coming from Drizzle
[112:06.15]OM here.
[112:10.23]And also the equal function is going to
[112:12.71]come from Drizzle OM.
[112:16.00]Okay, great. And then we are
[112:18.08]destructuring something called row count
[112:21.36]from the returned data. If it's equal to
[112:24.88]zero, that means that the event wasn't
[112:27.11]updated. It's either not found or not
[112:30.23]owned by the user.
[112:32.80]Any of these conditions will return
[112:35.19]false at this at this point if row count
[112:37.84]equal to zero. In that case, we're going
[112:40.23]to throw an error. Otherwise, we're not
[112:42.80]going to do anything actually because
[112:44.40]that means that the event was updated
[112:46.71]successfully. So, we're going to go here
[112:49.11]to the finally block, revalidate the
[112:51.84]path, and also redirect the user to the
[112:55.11]events page. Now, let's go back here and
[113:00.08]import the update event function. I
[113:03.44]think we have one more function to
[113:06.48]define, which is the delete event
[113:09.52]function.
[113:11.36]Yeah, this function. We're going to call
[113:14.15]this function when a user wants to
[113:16.32]delete an event here on click. Of
[113:18.80]course, this is the delete button. So,
[113:21.92]let's also go here to the events actions
[113:24.96]file. And you know the drill. There is
[113:28.48]nothing different here. We're going to
[113:30.63]create this function delete event which
[113:33.44]is going to delete an existing event
[113:35.11]from our database. It's going to take
[113:37.59]the ID of the event. It's going to
[113:39.19]delete return a promise that resolves to
[113:42.88]void. It's going to take the user ID to
[113:46.56]authenticate the user. If there is no
[113:49.67]user, we're going to throw an error. Of
[113:52.96]course, here there is no data to
[113:55.04]validate. There is no unsafe data
[113:56.88]because we're just deleting the event.
[113:58.80]We're not validating any data. So here
[114:01.59]we're going to actually delete the event
[114:04.00]by writing that code await db.delete
[114:06.80]delete from the event table where we're
[114:11.36]using the end also to make sure that
[114:13.67]these two conditions return true where
[114:16.40]the event table do ID equal to that ID
[114:20.40]we gave to the function here and also
[114:23.44]the event table.clerk clerk user ID is
[114:25.67]equal to our user ID from here
[114:29.52]and also if no event was deleted through
[114:32.32]an error that means that the row count
[114:34.96]equal to zero. If it's not equal to zero
[114:38.80]then that means that the event was
[114:40.96]deleted. So, we're going to execute the
[114:43.28]code here inside the finally block,
[114:45.52]which is going to revalidate the path,
[114:48.40]the events path, and then redirect the
[114:51.52]user to the events page. Now, let's go
[114:55.28]here
[114:57.11]and import this function.
[115:01.04]And I think we're good to go. Now, let's
[115:04.08]click save and check our application.
[115:07.36]Let's go to the events new page. Reload
[115:10.32]the page. Oh, I think we forgot to
[115:12.71]import the event form here. So, let's go
[115:15.84]back to our page. Yeah. And remove the
[115:19.84]comments from here and import the event
[115:22.15]form component. And let's go back here.
[115:25.52]Reload.
[115:27.44]And there we go. We have our event form
[115:31.19]here. Let's try to create a new event.
[115:34.15]Actually, let's name it test event.
[115:37.19]Duration 30 minutes. Let's say here test
[115:41.04]description. Make it active and click
[115:43.76]save.
[115:46.80]All right, that's great. So, we are
[115:48.40]redirected to the events page which
[115:50.96]means that the event was created. Now,
[115:53.67]let's check our database.
[115:56.15]Let's go here and reload and check the
[116:00.32]events table. No, the event is not
[116:04.15]created here. Let's see here if we have
[116:07.76]something wrong. Oh yeah, here we forgot
[116:10.80]to say await. This is an asynchronous
[116:14.40]operation. So we have to say await here
[116:18.88]in the create event function.
[116:22.00]Let's see if we forgot to do it also in
[116:24.15]the update
[116:25.92]event. No, actually we did it. Let's
[116:29.92]double check the delete event
[116:33.52]also. we put a weight. Okay, now let's
[116:37.59]try again. I'm going to go to create
[116:40.56]event page. The event name is test here.
[116:44.96]Test description
[116:47.92]and then click save.
[116:52.56]Now let's go back here and refresh our
[116:55.59]database.
[116:57.67]All right. Then we have our event here.
[117:00.32]Name test description test description
[117:03.92]and so on. Is active true created at and
[117:08.40]updated at days. And this is my clerk
[117:12.15]user ID. And by the way guys, I forgot
[117:15.36]to tell you about a very important
[117:17.52]thing. I know you probably know all
[117:19.84]about this, but just to make sure here
[117:24.32]when you're using secrets like that,
[117:27.28]always make sure that they are stay
[117:30.08]secret. Okay, don't expose your API
[117:33.28]secrets ever. Okay, here I'm exposing my
[117:36.56]keys for the sake of this video and
[117:39.04]actually I'm going to delete all of them
[117:41.19]after I finish recording that video. But
[117:44.00]this is shouldn't be the case for you,
[117:46.32]okay? Always keep your secrets safe.
[117:49.84]Okay. Now, let's try to create another
[117:53.11]event. I'm going to call it not active.
[117:55.84]Let's make the duration
[117:58.40]25 minutes. Not active.
[118:02.71]And here I'm going to set active to
[118:05.44]false. Click save.
[118:09.84]Now, let's go back here and refresh.
[118:14.15]We have two events. Okay. I don't know
[118:16.96]why there is this delay. Okay, this is
[118:20.71]the not active event here. Is active is
[118:24.56]false. So nice. Everything's working. So
[118:28.08]yeah, perfect. We're not going to be
[118:29.92]able to test the edit event and delete
[118:33.36]event functions because we don't have
[118:35.44]access to the created events just yet.
[118:38.88]But later when we retrieve the events
[118:40.96]here in that page, we're going to be
[118:42.63]able to edit and delete them. But here I
[118:46.80]noticed something. Let me double check.
[118:49.44]I'm going to try to create any event.
[118:52.32]Yeah, here we got an error before the
[118:54.88]redirection to the events page. So I'm
[118:57.19]going to try to do something here. Here
[119:00.08]I'm going to go to the events actions.
[119:03.19]Going to go to the create event
[119:05.28]function. And here actually instead of
[119:08.08]throwing an error in case of no success
[119:10.56]or no user ID I'm just going to return
[119:13.92]an object saying error equals to true
[119:16.96]and then I'm going to get rid of the try
[119:19.44]catch blocks. So here I'm just going to
[119:23.59]type all of that in the body of the
[119:26.56]function.
[119:28.08]Yeah, actually this is what I want.
[119:33.19]Let's put this here. And we're going to
[119:37.19]also revalidate
[119:39.76]the path and redirect the user here
[119:43.04]after that line of code. And here, let's
[119:46.96]just remove all of that.
[119:49.84]And here, TypeScript is complaining
[119:52.48]because we we are returning a promise of
[119:56.00]type void only. So instead, we're going
[119:59.52]to return a promise that's eventually
[120:02.23]going to resolve to to an object
[120:05.11]containing an error of type boolean
[120:08.23]which is true or false or it's going to
[120:11.76]return undefined. Now click save.
[120:16.08]And here let's go to the event form and
[120:19.76]also remove the try catch here from the
[120:22.63]onsubmit function.
[120:25.04]And here instead of saying try catch and
[120:28.32]so on we're going to save the return
[120:32.88]data here
[120:35.67]in a conest named data actually
[120:39.28]and here we simply can say if data dot
[120:42.56]error and here we are writing a question
[120:44.88]mark to indicate that this is optional.
[120:48.23]As you can see here, this function could
[120:51.11]be returning an error or it could be
[120:54.71]returning undefined. So if it does
[120:57.84]return an error through that error
[121:02.40]otherwise just do nothing, just continue
[121:06.23]with your logic. So let me try all of
[121:09.28]this one more time. I'm going to try to
[121:11.59]create a new event. Hey, anything. Click
[121:14.96]on save.
[121:19.04]Okay, we got another error which is in
[121:20.88]next redirect error. So here, let's see
[121:24.48]what's going on. Okay, let's try to
[121:26.80]comment the revalidate path here. Just
[121:30.15]redirect the user right away. Let's see
[121:32.71]what's going to happen. Create a new
[121:34.32]event. Click save.
[121:37.59]Okay, also I got the next redirect
[121:40.40]error. So, okay, let's try something
[121:43.52]else. Let's try to return the redirect
[121:47.11]from here and let's try again. Click
[121:50.32]save
[121:52.63]also the same error. Okay, let's go here
[121:55.28]to NexJS documentation. Let's search for
[121:59.19]redirect. Maybe we are using it wrong.
[122:03.19]Okay, here they are importing it from
[122:05.28]next navigation.
[122:08.23]And here they are saying redirect to the
[122:10.48]login page. here also they are using it
[122:14.63]normally. So I don't think we are doing
[122:17.28]anything wrong here. Maybe it's a bug
[122:19.19]with the redirect function. So I'm going
[122:21.84]to revert back to what we did before in
[122:24.71]the beginning. Here also I'm going to
[122:27.52]revert back. Maybe try one final thing
[122:31.67]here in the finally block. I'm going to
[122:34.32]comment the revalidate path. Then try
[122:37.67]again. Click save.
[122:41.36]No, actually I got the same error. So
[122:44.23]yeah, I think we did everything we could
[122:46.88]here. There is um maybe some bug with
[122:49.84]this redirect function. Maybe we can do
[122:52.71]something different. Maybe here we can
[122:54.80]say conest
[122:57.36]router equals to use
[123:01.76]router coming from next navigation.
[123:05.92]And since we made this component a
[123:09.84]client component by typing use client,
[123:12.32]we're safe to use the use router. And
[123:15.59]then here we can say router
[123:19.36]dot push
[123:22.00]to the events
[123:25.04]page.
[123:26.96]And here maybe in the create event we're
[123:29.36]going to remove the redirect.
[123:32.56]Just revalidate and then use the router
[123:36.08]to push. Now let's try it out. Create
[123:39.92]event. Click save. Yeah. Okay. We got a
[123:42.71]hooks error. Yeah. I think we should
[123:45.36]define this here on the top here. Let's
[123:49.44]try again. I hope you're not bored.
[123:52.56]This is a weird error. Click save.
[123:56.00]Okay, finally it's fixed. Even though I
[123:58.80]got you a little bored here. I know. But
[124:01.92]the most important thing is that we
[124:04.48]fixed the error. We fixed that issue.
[124:08.48]And actually, I think that was good. You
[124:10.71]saw me debug an issue live, right? I
[124:14.23]hope you've learned something useful
[124:15.67]here. So yeah, here let's go to this
[124:20.08]function and remove this. Remove that
[124:23.11]comment. And here in the update event,
[124:26.80]let's also get rid of the redirects.
[124:31.67]I hope the if if there is a bug with the
[124:35.11]redirect function, I hope the NexJS team
[124:37.92]fix it really soon. And here also remove
[124:42.08]the redirect from the delete event
[124:44.80]action. And now we're good to go. Let's
[124:48.23]move on to the next step. And now let's
[124:51.92]go back to the events page. Yeah, this
[124:55.11]one. And by the way, let's rename that
[124:58.88]to
[125:00.56]events page.
[125:03.52]And here, first of all, we want to check
[125:05.59]if there is an authenticated user or
[125:07.67]not. So we're going to dstructure the
[125:10.08]user ID and a function called redirect
[125:13.52]to sign in from the O function. And that
[125:18.00]o function of course coming from clerk.
[125:21.84]And as its name suggests here this
[125:24.88]redirect to sign in function is going to
[125:27.67]redirect the user to the login page if
[125:31.36]there is no ID found or no user ID
[125:34.71]found. So if the user is not
[125:36.80]authenticated he's going to be
[125:38.32]redirected to the login page. And here
[125:41.59]we have to make this an asynchronous
[125:44.23]function.
[125:46.63]There we go.
[125:48.88]And here in the template, we said that
[125:50.80]we want to render the events from the
[125:53.11]database, right? But how are we going to
[125:55.84]get those events? Simply, we're going to
[125:58.32]say const events equals to await get
[126:02.32]events using the user ID. And of course,
[126:07.52]that get events is a server action that
[126:10.63]we have to create right now. So let's go
[126:14.40]to events action
[126:17.76]and let's create the get events action
[126:20.80]which is going to be an asynchronous
[126:22.56]function to fetch all events active and
[126:25.28]inactive. By the way we're going to have
[126:27.84]another one to fetch only the active
[126:29.92]events but more on that later. And of
[126:32.48]course we're going to fetch all the
[126:33.84]events for a specific user. And this is
[126:36.15]why it's taking a clerk user ID of type
[126:39.36]string. And here we are providing the
[126:42.23]user ID as we said. And after this
[126:45.84]function fetches all of the events, it's
[126:48.48]going to return a promise that's
[126:50.56]eventually going to resolve to a type
[126:53.44]called event row. Actually, an array of
[126:56.15]event row. So we're going to need to
[126:59.04]create that type. So we'll go up here
[127:02.00]and say
[127:03.92]type event row equals to a type of event
[127:07.04]table dot dollar sign infer select which
[127:12.07]is going to infer the type of a row from
[127:14.63]the event table schema. So that
[127:17.92]basically means that this is an event
[127:20.15]row. And here of course we said that
[127:22.71]we're going to return an array of them
[127:25.11]because we're going to return all the
[127:26.71]events not just one event. And now let's
[127:30.32]write the code and that's going to
[127:32.48]actually fetch the events from the
[127:34.63]database. We're going to say conest
[127:36.96]events equals to await db.query
[127:40.63]dotvent table dotfind many. So we are
[127:43.52]querying from our database from the
[127:46.00]event table and we're using the find
[127:47.92]many function which is going to find all
[127:50.63]the events which matches these
[127:54.32]conditions. Okay. What are these
[127:56.63]conditions? Here we are using a wear
[127:59.19]function which is kind of a filter
[128:01.84]that's going to take the clerk user ID
[128:04.80]from here and then that user ID column
[128:09.44]which is also a reference to our clerk
[128:12.07]user ID in our database but we are just
[128:15.36]renaming it for clarity.
[128:18.56]So basically it's going to compare that
[128:20.88]clerk user ID with the one we have in
[128:23.19]our database
[128:24.96]and return the events where the user ID
[128:28.80]call equals to the clerk user ID. And
[128:32.48]here we are ordering the events
[128:34.63]alphabetically by name. Here we are
[128:37.28]saying order by name ascending SQL and
[128:40.88]then we're going to return the result as
[128:43.44]a case sensitive. This is why we are
[128:45.67]using that lower function. Okay. And
[128:49.59]then finally, we're going to return the
[128:52.15]events.
[128:54.00]So now let's go back here and import
[128:57.04]that action. And then here in the events
[129:00.07]page, let's go below that div. And then
[129:03.84]we want to show events cards if any
[129:06.80]exist. If we have events here, we are
[129:09.59]saying if events.length plan is bigger
[129:11.92]than zero. Map on the events and display
[129:16.40]event card for each event. Otherwise,
[129:20.56]we're going to show an empty state here
[129:24.07]saying you don't have any events yet and
[129:26.23]so on. And here we're going to display
[129:28.15]an icon or a calendar range range
[129:31.44]component from side react.
[129:34.63]And that's it. And here by the way we
[129:36.80]are displaying those events card in a
[129:39.44]grid display like that. But in order to
[129:42.40]be able to see them we have to create
[129:44.63]the event card component.
[129:49.44]So now let's go ahead and create that
[129:51.28]event card. Copy that and let's go to
[129:54.23]components.
[129:56.00]And inside of components we're going to
[129:58.00]create a new folder named cards. And
[130:01.28]inside of it we're going to create a new
[130:03.04]file event card.tsx. tsx
[130:06.07]and let's here say export default
[130:08.23]function event card which is going to
[130:11.11]take all of these props
[130:14.23]the event props ID is active name
[130:17.19]description duration and clerk user ID
[130:20.48]and all of them are going to be of type
[130:22.71]event card props now let's define that
[130:27.19]type here we're going to say type event
[130:29.92]card props equals to and then we're
[130:33.36]going to specify ify all of these types.
[130:35.36]ID is active. ID of type string is
[130:38.71]active pool. Name string. Description
[130:41.59]can be a string or null. Duration in
[130:44.32]minutes is going to be a number. And the
[130:46.32]ID clerk user ID is going to be a
[130:49.59]string. And then here we're going to
[130:52.40]return
[130:54.48]a card, a card from Shad CN. Of course,
[130:57.84]you know the drill. You've seen it
[130:59.36]before. Here, let's import that card
[131:02.96]from UI card. And here we are using the
[131:06.80]CN function to style the non-active
[131:10.80]events dynamically. If an event is not
[131:14.00]active, we're going to give it the
[131:15.59]background in order to differentiate it
[131:17.92]from other active events. And here this
[131:22.15]is the card header. Also we are styling
[131:26.48]it in the case of not active
[131:29.76]giving it that opacity.
[131:32.71]Here the card title which is going to
[131:35.52]display the name of the event here. The
[131:38.00]description is going to format the
[131:40.71]duration in minutes. That duration in
[131:42.71]minutes it's going to format it using
[131:46.07]that function function named format
[131:48.71]event description. Of course, we're
[131:50.88]going to need to create this function
[131:52.56]ourselves.
[131:54.56]So, let's go to our lib folder
[131:59.44]here and create a new file named
[132:03.52]formatters.ts.
[132:07.28]This file will include all of our
[132:09.44]formatters. And here what we want to do
[132:11.67]is to create a function which will
[132:13.52]format a duration in minutes into a
[132:16.07]readable string format like this format
[132:18.96]1 hour 30 minutes.
[132:21.92]So we're going to create that function
[132:23.52]format event description which is going
[132:26.15]to take duration in minutes which is
[132:28.48]going to be of type number and here we
[132:31.59]want to get the number of full hours by
[132:34.63]saying const hours equals to math.f
[132:37.36]floor and then we're going to apply the
[132:39.52]math dotf floor function on the duration
[132:42.48]in minutes divided by 60. And here we
[132:46.15]want to get the remaining minutes by
[132:48.15]saying const minutes equal duration in
[132:50.71]minutes modulus 60. And here we want to
[132:55.52]create the minutes string to display 1
[132:57.59]minute or 10 minutes. So if the minutes
[133:00.71]is bigger than one we're going to
[133:03.04]display mins. Otherwise we're going to
[133:05.44]display min. And we're going to do the
[133:08.15]same for hours string. And if there are
[133:12.23]no full hours, just return the minutes
[133:16.23]string. And if there are no extra
[133:18.88]minutes, just return the hours string.
[133:22.07]And here, finally, if we have hours and
[133:24.56]minutes, we're going to return both
[133:26.63]hours and minutes in a string like that.
[133:29.36]Hours string and then minutes string. So
[133:33.28]here we can specify that this function
[133:37.04]is going to return a string. Okay, nice.
[133:40.63]This is more type safe. And now let's
[133:45.11]here in the event card import that
[133:47.67]function.
[133:49.28]And then here in the in the event card,
[133:51.59]we're going to show the event
[133:52.88]description if it's available. So we're
[133:55.36]going to say if it's not null, render
[133:57.76]that card content displaying the
[134:00.32]description. And then we're going to
[134:02.71]display the card footer with copy and
[134:05.67]edit buttons. So let's import the footer
[134:09.52]here. And here we're going to need to
[134:11.67]create the copy event button and render
[134:13.84]it if only that event is active. Because
[134:17.44]if it's not active, we're not going to
[134:19.44]need to display a copy event button as
[134:22.88]the user is not going to need that copy
[134:25.28]event button to copy the link and give
[134:27.44]it to other users. of course until he
[134:30.71]makes that event active again. And here
[134:34.32]the edit button which is going to take
[134:38.56]the user to events edit page. We're
[134:42.56]going to create that later but for now
[134:44.40]let's create that component the copy
[134:46.56]event button.
[134:49.11]So copy that and let's go to components
[134:52.71]create a new file. Name it copy event
[134:55.67]button.tsx.
[134:58.48]And now let's create that component.
[135:01.28]First of all, we're going to make it a
[135:02.96]client component. And then we're going
[135:05.28]to say export function copy event
[135:08.07]button. And this component is going to
[135:11.36]take all of these props. And here we are
[135:14.96]saying take any other button props like
[135:17.28]disabled, type etc.
[135:19.92]And these props is going to be of type
[135:22.23]copy event button props. Now let's
[135:25.36]create that type. We're going to say
[135:27.44]interface copy event button props which
[135:31.04]is going to inherit all native button
[135:34.15]props. This is why we are saying omit
[135:36.56]react do comment props button here
[135:40.71]except
[135:42.48]the children and on click because we
[135:45.04]want full control over this component.
[135:48.32]We don't want any other developer or
[135:50.80]even me. I don't want myself in the
[135:53.28]future messing up with the on click or
[135:55.59]the children of this component because
[135:58.88]this component on click should only copy
[136:02.00]the event link for the user. And here we
[136:05.44]want to allow the variant and size props
[136:07.59]from the chat cm button. So we're going
[136:10.23]to say variant props also extend. Here
[136:13.11]we are extending the the button and also
[136:16.80]the variant props which is of type
[136:19.84]button variants coming from UI button
[136:22.71]which is shad CN button. So in a
[136:26.00]nutshell that type or that interface is
[136:29.59]going to inherit everything from the
[136:32.31]HTML button except for children and on
[136:36.39]click. It's not going to inherit those
[136:39.28]two props. the variant props. This is
[136:42.63]coming from class variance authority
[136:46.16]which is going to be of type button
[136:48.71]variants. And if you don't know what
[136:51.20]variant props is, let's go here to the u
[136:55.84]the chaten p button you can see that
[136:59.84]they have used that variant props here
[137:03.20]from class variant variance authority
[137:06.47]here in this file. And here actually
[137:09.67]what they did when they defined the
[137:11.84]button component they have used these
[137:14.96]variant props type of button variants
[137:18.88]that they created here. So in short this
[137:22.71]variant props is a TypeScript utility
[137:25.28]used to type props for variants like
[137:27.84]size, color, style etc. So here as we
[137:31.92]were saying that interface is going to
[137:34.24]extend the button except for the
[137:36.88]children and on click and also it's
[137:39.43]going to extend the variant props type
[137:41.76]of button variance from the from the sh
[137:45.51]UI button and also it's going to take
[137:48.63]from us the event ID of type string and
[137:51.84]the clerk user ID of type string and
[137:55.84]then here we're going to return a button
[137:59.28]on click we're going to handle copy.
[138:01.12]We're going to define this function
[138:02.63]right now
[138:04.88]and it's going to have these class
[138:07.04]names.
[138:08.55]And here we're getting an a copy icon
[138:10.96]from side react.
[138:13.43]And here this is the text label that
[138:15.59]changes with copy state. Remember when
[138:18.63]the user clicks on the copy, we display
[138:22.08]the text copied. Then after a while, we
[138:25.76]revert back to the word copy.
[138:30.63]So we're going to do all of that using
[138:32.88]this function. Also, we're going to
[138:34.63]define it in a minute.
[138:37.51]So let's first define the get copy label
[138:40.96]function.
[138:42.55]It's going to take a state of type copy
[138:45.12]state.
[138:46.88]Let's create that state. We're going to
[138:49.20]say type copy state equals to idle,
[138:52.24]copied or error. Those are the only
[138:56.31]possible visual states for the copy
[138:58.80]action.
[139:00.47]And then here we're going to create
[139:02.16]state using state coming from react
[139:05.59]equals to copy state which is going to
[139:08.71]be initialized to idle.
[139:11.76]And let's actually get this out of the
[139:14.47]component.
[139:16.16]Let's put it here. And let's put that
[139:20.00]comment here.
[139:22.88]Okay.
[139:24.47]And also we should get this function out
[139:29.12]of the components.
[139:32.08]Yeah, here. Okay, nice.
[139:36.71]So here simply it's going to render the
[139:39.04]copy state based on the return of this
[139:42.31]function. And this function is going to
[139:44.80]take state of type copy state and switch
[139:47.84]on the state. In the case of copied
[139:50.96]state, it's going to return copied. Case
[139:53.12]error, return error. Case idle, it's not
[139:56.00]going to return anything. And by
[139:58.16]default, it's going to render that word
[140:00.39]copy link. Okay, very nice.
[140:05.35]And then here, let's define this handle
[140:07.92]copy function which is going to get the
[140:10.72]URL using the location here. Of course,
[140:14.88]the URL includes the book route because
[140:18.24]when you give uh the link of the event
[140:20.31]to anyone, you want them to book that
[140:23.52]event with you. So, this is going to be
[140:26.16]the URL, the location. Forward
[140:29.12]slashbook/clerk
[140:30.96]user ID, which is the user ID forward
[140:33.28]slashevent
[140:34.88]ID. And here we're using a JavaScript
[140:37.35]method navigator.clipipboard clipboard
[140:40.16]write text the URL which is basically
[140:42.96]going to try to copy the URL to the
[140:46.00]user's clipboard and then we're going to
[140:48.64]say dot then set copy state to copied
[140:53.20]and of course when the copy state
[140:56.24]changes to copied we are rendering it
[140:59.12]here so it's going to type copied here
[141:03.52]and then we're going to give a toast to
[141:06.16]the user that toast is coming from
[141:08.64]jetsen. We're going to take a look at it
[141:11.43]in a minute and then we're going to
[141:13.43]reset after two seconds to the idle
[141:17.68]state. We're going to get back to the
[141:19.76]idle state. Remember here we said that
[141:23.52]uh in the case of idle don't return
[141:26.24]anything. So it's going to return the
[141:29.84]default state which is copy link. So in
[141:32.47]that case it's going to change the view
[141:34.16]here from copied to copy link. And here
[141:38.08]we're going to say dot catch. So in case
[141:40.72]of any failures here, show error state
[141:44.00]by setting the copy state to error. Of
[141:46.47]course, it's going to show the error
[141:47.76]state in that case. And also reset after
[141:51.28]2 seconds to idle. Now let's get that
[141:54.80]toast. If we go to chaten here and
[141:57.52]search for toast,
[142:00.31]this is the toast that I'm talking
[142:02.31]about. But actually for a while now that
[142:06.00]toast is not working. If you use this
[142:09.43]command add toast is not it's not going
[142:11.35]to work for you. So instead we're going
[142:14.16]to use something called suner
[142:18.88]which basically do the same here show
[142:21.28]toast.
[142:24.08]So in order to install it we're going to
[142:25.92]copy that command
[142:28.16]and then add toaster to the global
[142:31.68]layout file.
[142:33.52]So let's go to our terminal
[142:36.72]and add this command
[142:40.16]use force.
[142:42.00]And now let's copy that. And now let's
[142:45.12]go to our global layout. And here below
[142:50.08]children, we're going to render this
[142:53.28]toaster coming from sun. Save.
[142:57.68]And let's go back here and import that
[143:00.96]toast also from suner. Now click save.
[143:05.52]And let's go back here to the event
[143:08.16]board.
[143:10.08]And here we are rendering the copy event
[143:13.12]button giving it a variant of outline.
[143:16.24]The event ID equals to ID and clerk user
[143:18.96]ID equals to clerk user ID. Of course
[143:22.80]here if you remember that component
[143:25.35]takes all of that event ID, clerk user
[143:27.84]ID and variant
[143:31.12]it's also taking class name and size and
[143:34.56]we are defining those here and it's
[143:38.31]going to take the rest of the props like
[143:41.35]all other button props.
[143:44.88]So I think we're good to go here. This
[143:48.24]is our event card. The only thing left
[143:51.35]here is to go back here to the events
[143:54.72]page and import the event card.
[143:59.84]Of course, the event card here is going
[144:01.84]to take a key equals to event do ID and
[144:05.04]it's going to take all the event a copy
[144:07.68]from the event. This is the spread
[144:10.31]operator which is going to take a copy
[144:12.08]from the event. And here it's going to
[144:15.04]spread all of the event props. Now save
[144:19.12]everything and let's go back to our
[144:22.31]project. And look at that. We have all
[144:25.12]of our event cards here. Of course,
[144:27.76]those are rubbish events, but no
[144:31.43]worries. Going to delete them after
[144:33.84]that. Let's try to copy the link. Link
[144:36.96]copied successfully. Now I can paste
[144:40.00]that link anywhere. Of course, it's
[144:42.47]going to take me to the booking page,
[144:44.80]but we didn't create that page just yet.
[144:47.68]So yeah, that's great. And now let's
[144:50.00]move on to the next step. And now let's
[144:53.35]create the edit events page so that when
[144:57.12]I click on edit on any event, I'm going
[145:00.31]to be redirected to the events page
[145:02.72]where I can edit that event. So let's go
[145:07.28]here to our project.
[145:09.68]Go to events.
[145:12.39]Under events, we're going to create a
[145:15.28]new folder
[145:17.04]inside square brackets like that because
[145:20.47]it's going to be a dynamic route. We're
[145:22.72]going to take the event ID dynamically
[145:26.39]and this is why we have to create it in
[145:28.47]a square brackets like that. Now press
[145:31.35]enter and inside of that folder we're
[145:34.64]going to create another folder named
[145:37.52]edit. So the path will be forward
[145:40.47]slashevents forward slash the event id
[145:44.31]dynamically whatever it is and forward
[145:47.68]slashedit
[145:49.52]and here in edit we're going to create a
[145:52.00]new file page tsx
[145:56.39]and now let's create the page you know
[145:58.47]the drill
[146:00.39]export default asynchronous function
[146:02.64]edit event page which is going to take
[146:05.60]the params since it's going to take the
[146:08.31]ID dynamically. So we're going to need
[146:10.56]to take the params as props and that
[146:13.84]params is going to be of type promise
[146:16.00]which is eventually going to resolve to
[146:18.47]event ID of type string. And by the way
[146:22.24]since NexJS15 was released when you're
[146:25.76]using params in a dynamic page like that
[146:28.47]you have to use it as a promise or as an
[146:32.47]asynchronous function like that. You can
[146:35.12]see here in the documentation they are
[146:37.12]telling you that uh in version 14 and
[146:39.60]earlier params was actually a
[146:42.96]synchronous prop. Before we were just
[146:45.76]taking params in a normal function not a
[146:49.20]synchronous function and destructuring
[146:51.52]whatever you want from that params but
[146:54.16]they are telling you that this behavior
[146:56.64]here will be duplicated in the future.
[146:59.76]Right now in nextJS15 whenever you are
[147:02.24]using params in a dynamic page it has to
[147:05.84]be defined as an asynchronous function
[147:08.39]and take it from a promise like that.
[147:11.28]Okay. So back here to our projects we're
[147:14.96]going to take the event ID as a string
[147:17.68]from the resolved promise of course from
[147:21.43]the params. And here also we're going to
[147:24.56]take the user ID and redirect to sign in
[147:27.52]from O.
[147:30.72]And here if no user ID return a redirect
[147:35.28]to sign in which will redirect the user
[147:38.24]to the login page. And then we're going
[147:40.96]to dstructure the event ID from the
[147:43.68]params. And then we're going to need to
[147:46.31]get the event that the user is going to
[147:48.47]edit. Right? So we're going to use a
[147:50.96]function named get event which is going
[147:53.68]to get the event using the user ID and
[147:56.56]event ID and store that event in a
[147:59.76]conest event. So right now you know the
[148:02.96]drill. We have to define that events
[148:06.16]action.
[148:08.00]So let's go to the events action and
[148:11.68]let's create this function export
[148:14.16]asynchronous function get event which is
[148:16.24]going to take user ID of type string and
[148:19.20]event ID of type string as well and it's
[148:22.47]going to return either a promise which
[148:24.88]is going to resolve to an event row
[148:27.35]remember the type event row that we
[148:30.16]created before
[148:32.08]this one. So here it's going to return a
[148:34.80]promise that's going to either resolve
[148:37.12]to that event row or it's going to
[148:39.68]resolve to undefined. And here we are
[148:42.72]getting the event from the database. Of
[148:45.84]course it's getting it from the event
[148:47.60]table. I think I'm repeating myself here
[148:50.47]where the ID and clerk user ID. Of
[148:53.60]course that ID belongs to the event from
[148:56.00]the event table and the clerk user ID
[148:59.12]belongs to the user also from the event
[149:01.60]table. Then we are comparing the cleric
[149:04.39]user ID with the user ID and the ID with
[149:08.00]the event ID and then it's going to
[149:11.35]return the event if it found one or it's
[149:15.28]going to return undefined. Now click
[149:18.16]save and let's go back here and import
[149:21.92]this function.
[149:23.76]And here we can say if no event
[149:27.92]maybe we can return anything. Let's say
[149:31.52]return H1 element say event
[149:35.76]not found or you can return a not found
[149:39.43]page whatever you want and here we're
[149:42.80]going to return the edit form of course
[149:46.08]card from JCN
[149:49.35]card header card title edit event card
[149:54.24]content which is going to render the
[149:57.35]event form that we created before. And
[150:00.24]here since we are editing that event
[150:02.16]we're going to provide the event to that
[150:04.24]event form. Before when we created the
[150:08.00]create event page we didn't provide any
[150:10.16]event because we actually didn't have
[150:12.72]any event.
[150:14.56]And if you remember when we defined that
[150:17.43]event form we said that the event could
[150:20.72]exist or not. Okay. Now click save and
[150:25.84]let's go back here to our project.
[150:28.00]Reload it.
[150:29.84]And there you go. We have our edit event
[150:32.08]page here. And as you can see, this is
[150:34.96]the event we want to edit. Okay. Right
[150:38.24]now, let's delete
[150:41.12]all of this uh rubbish events.
[150:44.88]Oh, we're not redirected to the events
[150:46.96]page. And yeah, this is because here in
[150:51.20]the delete event uh function or delete
[150:54.00]event action, we did remove the
[150:56.08]redirect. Remember? So here let's go to
[150:58.80]the event for here we said after the
[151:02.24]action
[151:04.08]router to push to the events page but
[151:06.80]here the action was either create event
[151:09.35]or update event we didn't actually do it
[151:13.35]after deleting the event. So let's go
[151:17.20]here after the deletion the deletion of
[151:20.80]the event and say also router
[151:25.28]dopush
[151:26.88]to the events page. And now let's go to
[151:30.80]my events page. And let's try to delete
[151:35.60]all the other events.
[151:39.20]Delete.
[151:43.43]And now I'm redirected to the events
[151:45.43]page. I'm going to go ahead and delete
[151:48.08]all of that.
[151:56.00]All right. Now, I deleted all of the
[151:57.76]events. Let's check our database. And
[152:00.88]you know what? Let's check it in our uh
[152:03.43]Neon dashboard this time. Go to our
[152:06.96]project calendar and then go to tables.
[152:11.52]Okay. Right now the events table is
[152:14.31]empty.
[152:16.00]So let's create a new event. Let's say
[152:19.04]watch
[152:21.43]a football game with me.
[152:26.72]The football game lasts for 90 minutes.
[152:30.24]And here in the description, let's say
[152:32.39]let's watch a football game together.
[152:38.72]Make it as active. Click save.
[152:42.08]Okay, right now we have the event 1 hour
[152:45.60]30 minutes. Let's check our database.
[152:50.16]And we have our event here. Perfect.
[152:56.80]All right, then. Now our next step is to
[152:59.60]create my schedule page. But I noticed
[153:03.28]something here. We forgot to create the
[153:05.84]favicon of our application. So let's
[153:08.80]quickly do that as it's going to give
[153:11.12]some branding to our application.
[153:14.31]So let's go to a website named
[153:16.47]fabiccon.io
[153:18.96]and here choose PNG to ICO.
[153:23.84]While it actually says PNG,
[153:27.28]it can also convert
[153:29.76]an SVG file. And we actually have an SVG
[153:33.52]file for our logo. So let's upload it
[153:35.84]here. Let's go to our project public
[153:39.28]assets
[153:40.88]logo. And right now our PNG is ready. So
[153:45.12]download it. Then save it anywhere on
[153:48.00]your computer. Let's save it on our
[153:50.31]desktop.
[153:52.24]Then open this folder. Then see this
[153:55.76]file fabicon.ico.
[153:58.39]Copy that file. And here let's go to our
[154:01.43]projects.
[154:03.12]Go to app. Right click and reveal in
[154:06.24]file explorer. It's going to take us to
[154:08.64]our project.
[154:10.80]So go to app and paste the faviccom file
[154:14.56]here.
[154:16.24]And that's it. Now if you go back to our
[154:18.80]project, reload, we should see it here.
[154:22.80]And there we go. That's our favicon.
[154:28.56]And now let's create my schedule page.
[154:32.24]So here under private, we're going to
[154:34.39]create a new folder and name it
[154:37.76]schedule.
[154:39.43]And inside of schedule, we're going to
[154:41.76]create a page.tsx
[154:43.92]file. And let me here leave a comment
[154:47.92]for you on what this page does. And now
[154:53.04]let's create the page.
[154:56.08]And here also get the user info. And if
[154:59.35]no user
[155:01.20]return a redirect to sign in. Here we
[155:04.24]can say if no user ID or user ID equal
[155:07.68]to null.
[155:09.68]Both are the same. And here import O.
[155:14.56]And here also let's get the user
[155:16.64]schedule from the database using a
[155:19.52]schedule action named get schedule. So
[155:23.04]let's create that get schedule action.
[155:25.76]We're going to go to actions here.
[155:28.24]server actions and create a new file
[155:31.60]here named schedule.ts
[155:35.43]at the top use server
[155:39.35]and here also let me leave a comment for
[155:41.76]you on what this file
[155:45.60]is going to do exactly.
[155:48.39]So here basically we want to get the
[155:51.12]user schedule and his availabilities. So
[155:54.80]we're going to create two types type
[155:57.43]schedule row which is type of schedule
[156:00.47]table dot infer select. So let's import
[156:04.56]the schedule table. And since we also
[156:07.76]want all the availabilities of the user,
[156:10.80]we're also going to create a type named
[156:13.20]availability row which is going to be
[156:15.68]type of schedule availability
[156:17.60]table.infer select. So let's also import
[156:22.16]that. And then we want to create a type
[156:26.16]that uh merges these two types together.
[156:30.00]Type named full schedule which is going
[156:32.96]to be a merge between the schedule row
[156:34.96]and the availability row. So here let's
[156:38.24]say export type full schedule equals to
[156:42.08]schedule row and an object contains a
[156:46.80]property named availabilities which is
[156:49.28]going to be an array of availability
[156:52.24]row. Okay. And then let's create the get
[156:55.04]schedule action.
[156:57.28]This get schedule will take a user ID of
[157:00.00]type string and return a promise that's
[157:03.60]going to resolve either to a full
[157:06.08]schedule type or null. And then here
[157:10.88]simply we're quering our database for
[157:14.00]the user schedule.
[157:16.64]So we're quering the schedule table
[157:18.80]where the clerk user ID matches the user
[157:22.16]ID that user ID and then here we want to
[157:27.28]include all related availability records
[157:30.64]and this is why we're going to say with
[157:32.88]availabilities equal to true and then
[157:36.31]here simply we're going to return the
[157:38.24]schedule if found we're going to return
[157:40.16]it as fully schedule or null if it
[157:43.20]doesn't exist. And now let's go back
[157:46.16]here. Import this function. And here we
[157:50.39]want to render a card that's going to
[157:53.12]render a schedule for
[157:56.31]here. Import the card components.
[158:00.56]Here we are rendering a card title and
[158:02.56]typing schedule inside of it. And for
[158:05.92]now, let me comment the schedule form.
[158:09.12]Click save. Let's go to the schedule
[158:12.08]page.
[158:13.60]And we should see the card here
[158:15.35]displaying schedule. Now let's work on
[158:18.80]our schedule form.
[158:22.72]So right now in order to create our
[158:25.52]schedule form, we're going to go to
[158:27.60]components forms.
[158:30.80]And here create a new file
[158:34.00]named
[158:36.80]schedule form.tsx.
[158:41.43]It's going to be a client component
[158:44.72]and then we're going to create that
[158:46.72]component schedule form which is going
[158:49.84]to take a schedule of course and that
[158:53.04]schedule is optional. It might be
[158:55.35]undefined
[158:57.04]and this is the type of the schedule. It
[158:59.60]has to have a time zone of type string
[159:03.43]which means that it's going to display a
[159:05.60]time zone or the user's time zone. Also,
[159:09.92]it has to have availabilities
[159:12.56]which is going to be an array of
[159:14.56]availability type which means that we
[159:18.39]have to create that type. Each
[159:20.96]availability should have a start time
[159:23.43]and an end time. Of course, both are
[159:26.96]strings and also we need to know the day
[159:30.72]of the week which is going to be type of
[159:33.68]days of week in order. So let's import
[159:37.84]that
[159:39.60]and here we are using index number
[159:43.35]because we want the day of week to be
[159:45.92]either Sunday Monday and so on because
[159:50.00]if you don't use the number if you don't
[159:53.84]use the number index that means that you
[159:57.60]are referring to the entire array type.
[160:00.24]So the day of week is going to be of
[160:02.88]type days of week in order as an array.
[160:05.60]If we remove this, we are referring to
[160:08.47]the days of week in order as an array.
[160:11.04]And this will mean that day of week is
[160:13.20]going to be of type array. But actually,
[160:15.92]we want the day of week to be either
[160:19.12]Monday, Tuesday as a union. I hope it's
[160:22.88]clear. And here I want to return a form
[160:27.04]that's going to take everything from our
[160:29.68]form. Of course, we're going to define
[160:31.84]that form later. And here I want to
[160:35.28]render three main things. I want to
[160:39.60]display a time zone selection
[160:42.80]and availability form a grid grouped by
[160:46.39]day and a save button.
[160:51.04]And of course I want to render all of
[160:53.43]that inside a form element, normal HTML
[160:58.08]form element.
[161:00.88]And here let's show
[161:03.43]the error message in case of any form
[161:06.88]level errors. So now let's go ahead and
[161:11.04]define our form instance. Let's go up
[161:14.56]here and we're going to say conest form
[161:17.92]equals to use form
[161:20.96]which is going to be of type Z.infer
[161:25.28]type of schedule form schema. We're
[161:28.80]going to define it in a minute. The
[161:31.52]resolver is going to be zod resolver
[161:35.84]with the schedule form schema. And then
[161:39.20]the default values are going to be time
[161:41.35]zone and availabilities. For the time
[161:44.16]zone, we're going to take the schedule
[161:46.16]time zone if it exists. Otherwise, we're
[161:50.24]going to create a new time zone. We're
[161:53.52]going to use a function in JavaScript
[161:56.47]named intel.
[161:58.47]Datetime format
[162:00.72]dotresolve it options dot time zone.
[162:04.56]Okay, this will return the user's time
[162:06.96]zone. And here for the availabilities,
[162:09.35]we're taking the schedule availabilities
[162:11.92]and then sorting it by start time.
[162:16.64]Here we are using a function named time
[162:18.88]to float. We're also going to need to
[162:21.52]define this function. But first, let's
[162:24.96]create our schema, our schedule form
[162:27.84]schema. So, let's go to our schema
[162:31.20]folder.
[162:32.72]And inside of it, let's create a file
[162:35.20]named schedule.ts.
[162:38.31]And then here, we're going to create our
[162:40.08]schedule form schema, which is going to
[162:42.88]be equal to Z.Object.
[162:45.52]And then here we're going to create our
[162:47.84]schema. The time zone must be a string
[162:51.04]minimum one character and the message is
[162:54.31]required. And then here we are
[162:57.20]specifying that the availabilities field
[163:00.31]is an array by saying availabilities
[163:03.28]equals to Z dot array and that array
[163:07.52]will contain objects with specific
[163:11.04]properties. Here equals to Z dot object
[163:16.80]and those availabilities should contain
[163:19.60]day of week which is equal to Z.inum
[163:23.12]enum coming from the days of week in
[163:27.20]order array. So let's import that
[163:31.12]and then the store time has to be a
[163:34.39]string and here this is a regular
[163:37.28]expression pattern to match the time
[163:40.31]format which is has to be like that hour
[163:44.39]colon minutes.
[163:46.72]Those are valid examples
[163:49.35]like this one 09 col 15. But just 9:15
[163:54.31]is an invalid example. The hour must be
[163:58.00]two digits. So just copy and paste that
[164:01.68]regular expression. Don't think about it
[164:03.92]too much. And the end time has also to
[164:06.88]be a string with the same regular
[164:09.76]expression pattern. Now let's close that
[164:13.27]array. And now we want to make sure to
[164:16.24]avoid any overlaps or conflicts.
[164:19.60]So we want to write some code or some
[164:22.08]logic to make sure that the user can't
[164:25.12]submit overlapping or backward time
[164:27.68]ranges like from 2 p.m. to 1 p.m. It's
[164:30.72]not possible, right? And also we want to
[164:33.20]avoid conflicts. So how are we going to
[164:36.08]do all of that? We're going to use a
[164:38.72]function from Zod named super refine.
[164:42.31]And this function is going to add
[164:44.00]additional validation for us. So this
[164:47.04]function is going to take a call back
[164:48.72]function and that call back function is
[164:51.20]going to take the availabilities array
[164:54.64]in which we want to do that additional
[164:57.35]validation on and then it's going to
[164:59.76]take a second argument which is here a
[165:04.72]function that has a method named add
[165:07.43]issue. We're going to use this function
[165:10.16]to display error message
[165:12.80]like these ones
[165:15.12]after we validate the availabilities
[165:17.35]array. So here we are looping on the
[165:20.64]availabilities array taking each
[165:22.64]availability and the index of each
[165:25.35]availability. And then here we want to
[165:27.76]check if we have any overlaps. The first
[165:31.52]step is going to be to make sure we are
[165:33.68]not comparing the same item to itself
[165:36.00]because logically any item will of
[165:39.04]course overlap with itself. And then the
[165:42.39]second step is that we want to check if
[165:45.04]it's the same day of the week. Because
[165:48.00]if this is true, if a dot day of week
[165:51.04]equals to the availability day of week,
[165:54.56]that means that the two availability
[165:56.80]entries being compared are for the same
[166:00.80]day of the week. For example, both are
[166:04.24]on Monday. And this is important because
[166:06.88]we're only concerned with overlapping
[166:08.96]times on the same day. If there are uh
[166:12.64]on different days like Monday and
[166:14.47]Tuesday, we don't care, right? It
[166:17.04]doesn't matter if their times overlap.
[166:20.56]And here simply we are checking if the
[166:22.72]start time of one is before the end time
[166:25.20]of another and checking if the end time
[166:28.16]of one is after the start time of
[166:31.27]another. And we're doing so by saying if
[166:34.24]a start time of course after converting
[166:36.96]the time to float we're saying if a
[166:39.60]start time is lower than the
[166:41.68]availability.
[166:43.68]And at the same time a end time is
[166:46.80]bigger than availability dot start time.
[166:50.80]And here also I left some extra comments
[166:53.92]to explain the sum function. Read them
[166:56.72]if you want. And then after all of that
[166:59.60]after all of these checks if we have
[167:02.00]overlaps we're going to add a validation
[167:04.80]issue by using this function. Remember,
[167:07.60]we're going to say ctx dot add issue
[167:10.96]code custom message availability
[167:13.20]overlaps with another. And then we're
[167:15.60]going to attach the error to the start
[167:17.60]time field. Here in the schedule form,
[167:20.39]we're going to have a field for start
[167:22.31]time. When we complete the form, we want
[167:24.64]to attach that specific error to the
[167:28.31]start time field. That error, of course,
[167:31.04]which says availability overlaps with
[167:33.52]another. And then here to be extra safe,
[167:36.72]we're going to make another check. We're
[167:38.72]going to check if the start time is
[167:41.35]greater than or equal to end time, we're
[167:44.24]going to also add an issue saying end
[167:47.20]time must be after start time. Of
[167:50.56]course, this is pure logic, right? And
[167:53.43]we're going to attach that error to the
[167:55.52]end time field. So, I think now we're
[167:59.68]safe by making all of these checks.
[168:02.80]We're making sure that the user always
[168:05.60]creates a valid time slots for their
[168:08.31]schedule. Right now, let's close this
[168:12.08]super fine. And we're done with the
[168:14.47]schedule form schema. I don't think we
[168:16.64]have anything else to create here. And
[168:19.76]actually, let's go ahead and create this
[168:21.92]function time to float. It's a very
[168:24.56]simple function. We're going to create
[168:26.08]it under
[168:28.00]lib utilities. It's a function that's
[168:31.60]going to take a time of type string and
[168:35.35]returns a number. Okay, of course this
[168:38.08]is the whole idea. It's going to take a
[168:40.08]time of type string and returns a
[168:42.16]number. Here it's going to split the
[168:44.39]time by column here into hours and
[168:48.31]minutes and then convert both to
[168:50.31]numbers. So it's dstructuring the hours
[168:53.52]and minutes from the time.plit split
[168:55.92]function and as we said it's splitting
[168:59.12]it by column and then we're going to say
[169:01.68]dot map number which is going to convert
[169:03.76]both to numbers
[169:06.80]and simply it's going to return hours
[169:09.12]plus minutes divided by 60 which is
[169:12.00]basically going to convert minutes into
[169:14.24]a fraction of an hour and add it to the
[169:16.96]hour and by the way I created this
[169:19.35]function using chatgpt you can create uh
[169:22.47]this type of functions using a chpt So
[169:25.43]right now
[169:27.20]let's just import this function here
[169:33.04]and also
[169:35.68]we are using it here
[169:38.88]and also let's import the schema the
[169:42.56]schedule 4 schema and let's continue
[169:45.52]creating the form
[169:47.68]here let's give it those class names and
[169:51.92]here on submit
[169:54.24]we're going to call and onsubmit
[169:55.84]function. We're going to define it
[169:58.39]later.
[170:00.08]And here for the time zone selection,
[170:03.76]we're going to render a form field that
[170:06.16]has name time zone displaying time zone
[170:09.20]here in the label. I don't think we have
[170:12.39]select yet. Let's see if we have select.
[170:16.00]No, I don't think so. So, let's go to
[170:18.80]chaten. Search for select. Yeah, this
[170:23.04]one. Okay, nice.
[170:25.52]Copy that and let's paste it here in the
[170:29.84]terminal. Use force. Import it.
[170:34.96]Import all of that.
[170:39.92]Here basically we are using a select for
[170:42.72]the user to choose their desired time
[170:45.76]zone. And here we are using a function
[170:48.72]in JavaScript named intel.supported
[170:50.88]supported values of time zone and then
[170:54.24]we are mapping on each time zone and
[170:56.64]rendering a select item which is going
[170:59.27]to render that time zone and then we're
[171:02.24]going to format it here using this
[171:04.39]function. Let's quickly define it. So
[171:07.76]let's go to formatters and create this
[171:10.96]function which is going to get the short
[171:13.35]offset string for a given time zone like
[171:16.47]this one. Also, I created using Chad
[171:19.92]GPT, by the way. Now, let's go back here
[171:24.08]and import it.
[171:26.31]And now the time zone selection is
[171:29.43]finished. And now, let's create the
[171:31.43]availability form grid. And we're going
[171:33.84]to group it by day. Let's go here.
[171:38.72]Paste all of that.
[171:42.16]Here we are mapping on the grouped
[171:43.92]availability fields of each day of week.
[171:48.88]We're going to go up here
[171:51.76]and let's say conest grouped
[171:53.84]availability fields
[171:56.24]equals to object group by and here we
[171:59.52]are basically grouping availability
[172:01.52]fields by day of week. So we are saying
[172:05.04]those are the availabilities for Monday
[172:07.04]and those are the availabilities for
[172:08.80]Tuesday and so on. Okay. But to from
[172:12.47]where are we getting these availability
[172:16.00]fields? We're going to use a function
[172:19.60]named use field array. I think this is
[172:23.84]coming from React hook form. Yeah, it's
[172:27.04]using the form control. So let's put
[172:32.08]the form here.
[172:34.39]Okay. So this is our form. So simply
[172:39.12]this function is going to take the
[172:41.84]availabilities field.
[172:44.64]We have a a field in our form named
[172:47.20]availabilities. It's going to take it
[172:48.96]and it's going to give us those methods
[172:51.84]append and remove in order to add items
[172:54.96]or remove items. We're going to rename
[172:58.00]the append to add availability and
[173:00.16]remove to remove availability.
[173:03.35]And also it's going to give us its
[173:05.20]fields in which we are going to name it
[173:08.24]availability fields. Okay. So here we
[173:12.39]are when we are grouping the
[173:14.16]availability fields we are calling the
[173:16.80]object.group by on those availability
[173:20.80]fields and then we are grouping them as
[173:23.43]we said by day of week. So here we can
[173:26.80]say something like on Monday we have
[173:29.76]availabilities from like 9 to 10 also
[173:34.56]from 12 to 1 p.m. and so on. We're
[173:39.20]grouping availabilities by days. We have
[173:42.24]other availabilities on Tuesday here
[173:45.68]Tuesday
[173:47.52]availabilities
[173:49.43]and so on. You get the idea, right? So
[173:52.47]let's go back here. Let's import
[173:55.35]fragment from React. We are displaying
[173:58.08]those availabilities in a grid like
[174:00.24]that. And we are mapping on the days of
[174:02.80]week to display each day label here. And
[174:06.88]here display a button to add
[174:09.92]availability here on click. As you can
[174:12.64]see we are calling add availability. And
[174:15.20]then we are giving it the day of week
[174:18.31]and start time from 9 end time to 5.
[174:22.16]This is the default initial value and
[174:25.52]displaying a plus icon from louisiside
[174:27.84]react. And here we're going to render
[174:30.31]availability entries like start time
[174:33.76]here start time input and end time
[174:36.16]input. This is coming from UI input. And
[174:40.56]here we are rendering an X icon to allow
[174:43.43]the user to remove availability. And on
[174:45.92]click we are calling the remove
[174:48.00]availability with the field index. And
[174:52.47]those are uh field level validation
[174:55.20]messages. And finally here let's render
[174:58.47]the save button. It's a simple button as
[175:01.20]you can see which is going to be
[175:03.04]disabled when the form is submitting.
[175:07.12]Let's clean this a little bit.
[175:11.27]So here we have save button.
[175:15.04]here the availability
[175:17.43]form grid and here the time zone
[175:21.20]selection. So the only thing left here
[175:24.39]is to create the onsubmit function.
[175:28.16]Let's remove these. You get the idea,
[175:30.31]right? And let's here define the
[175:33.12]onsubmit function which is going to take
[175:35.68]the values of type schedule form schema
[175:39.20]and then it's going to try to save the
[175:41.92]schedule. This is a schedule action that
[175:44.72]we're going to create right now. If it's
[175:47.68]done, it's going to give the user a
[175:49.60]toast saying schedule saved
[175:52.39]successfully. If there is any error,
[175:55.35]it's going to give a form error
[175:58.24]displaying this error. So let's go to
[176:02.72]schedule actions and let's create the
[176:05.27]save schedule function
[176:08.64]here.
[176:10.56]And this function should save the user's
[176:13.76]schedule and availabilities. So first of
[176:16.80]all it's going to also take unsafe data
[176:20.00]type of schedule form schema and then
[176:24.72]get the user ID from O and then it's
[176:28.56]going to get the success and data from
[176:33.27]safe parts of those unsafe data of
[176:36.72]course based on the schedule form
[176:39.43]schema. If no success or no user ID just
[176:43.35]through an error here let's say no user
[176:46.64]ID and then here we are destructuring or
[176:50.39]unpacking the availabilities
[176:53.27]and the rest of the schedule data from
[176:56.47]the data and then we're going to insert
[176:59.20]or update the user's schedule and then
[177:02.00]return the schedule ID. So we're going
[177:04.00]to say dstructure the id as schedule id
[177:08.47]from this operation. So we're going to
[177:10.88]say away db dot insert to the schedule
[177:15.12]table these values the schedule data to
[177:18.96]that user ID who has a clerk user ID
[177:22.80]equal to user ID and then we want to
[177:26.24]update the schedule if this user already
[177:30.08]exists. If if uh the user has already a
[177:33.92]schedule, we want to update it. And this
[177:36.88]is why we're going to use a function
[177:38.39]named on conflict update. Its target is
[177:41.84]going to be schedule table dot clerk
[177:44.39]user ID.
[177:46.31]And we're going to set it to schedule
[177:48.64]data. And then we're going to return the
[177:51.43]schedule ID to use it in the next step.
[177:54.96]So we're going to return the schedule
[177:57.12]table ID as ID. Of course, this is a
[178:00.80]function returning an object and here of
[178:04.39]course we are distracting the ID from
[178:07.27]the returned data this ID as schedule
[178:11.84]ID. So right now we have the schedule ID
[178:16.64]and then we want to delete any existing
[178:19.35]availabilities for this schedule then
[178:22.56]update those availabilities. Okay, how
[178:25.35]are we going to do that? We're going to
[178:27.27]create some statements using this
[178:30.08]function coming from Drizzle RM. We're
[178:33.52]going to call this statements which is
[178:36.08]going to be of batch item postgress
[178:39.84]meaning that we're going to create many
[178:42.72]SQL statements and we're going to batch
[178:46.00]execute them. So first we're going to
[178:48.16]delete any existing availabilities.
[178:51.43]So we're going to say here in the first
[178:53.92]item of the statements array delete from
[178:57.92]the schedule availability table where
[179:00.88]equal
[179:03.12]schedule availability table dot schedule
[179:05.35]ID equals to schedule ID. Basically this
[179:09.76]will delete any availabilities for this
[179:12.24]schedule. And then we're going to say if
[179:14.39]we actually have availabilities we're
[179:16.72]going to insert them to the schedule
[179:19.35]availability table. So here we deleted
[179:21.60]the old availabilities and we pushed the
[179:25.20]new availabilities. So we're going to
[179:27.43]map on each availability and insert to
[179:30.47]the schedule table do values each
[179:33.68]availability and link it to the schedule
[179:37.20]ID. Link it link that availability to
[179:41.27]the saved schedule. And then finally
[179:43.76]we're going to say await db do batch the
[179:46.80]statements which is going to run all
[179:49.12]statements in a single transaction. And
[179:52.08]here of course we're going to catch any
[179:54.16]errors and then revalidate the path
[179:58.31]schedule. Okay. Of course here we are
[180:00.64]updating the schedule. So we're going to
[180:02.72]revalidate the schedule path. Now let's
[180:06.00]go back here in the schedule form and
[180:08.96]import save schedule action. And here we
[180:12.80]need to import
[180:15.43]Z here from Zod. Click save. And here
[180:20.64]actually we forgot to import the form
[180:24.24]from UI form. And I think we're good to
[180:27.35]go. Now let's check our application. Oh,
[180:31.35]we forgot to import the schedule form. I
[180:34.16]do it all the time. So let's uncomment
[180:37.20]that and import schedule form.
[180:40.64]And I can see TypeScript is complaining
[180:42.88]here. Let's see why. All right. I think
[180:46.31]this is because um the schedule could be
[180:49.20]undefined. So let's see here. Okay.
[180:53.20]Let's make the get schedule only return
[180:56.88]a full schedule.
[181:02.16]So yeah, I think now we're good to go.
[181:05.52]The error disappeared. Now click save.
[181:08.39]Let's go to our application. And there
[181:10.39]we go. This is our schedule. Of course,
[181:14.56]right now it's an empty schedule. It
[181:17.12]doesn't have any availabilities.
[181:20.00]Let's try to add availabilities.
[181:23.84]Mondays from 9 to 5.
[181:28.31]Click save.
[181:31.20]I got here schedule saved successfully.
[181:34.31]Let's check our database.
[181:37.52]So schedule availability table I got one
[181:41.12]availability here from 9 to 5 nice on
[181:43.60]Monday and that availability has a
[181:46.72]relation or belongs to this schedule
[181:50.88]which belongs to that clerk user ID
[181:53.43]which is my ID. So nice.
[181:57.68]Let's check the schedules. This is my
[182:00.96]schedule which has schedule
[182:03.12]availabilities.
[182:04.88]this one
[182:07.04]from 9 to 5 and so on. Okay, everything
[182:10.08]is working as intended. Let's try to add
[182:14.24]another one here. Fridays
[182:18.16]from Okay, we are getting the validation
[182:21.27]errors here. Very nice. Okay, let's say
[182:25.20]from 12
[182:28.31]to 11.
[182:31.92]Okay, this start time obviously is after
[182:34.88]that end time. Okay, nice. We got the
[182:39.35]validation error. End time must be after
[182:42.31]start time. Let's try to say 11 to 11.
[182:47.35]Again, end time must be after start
[182:50.16]time. Okay, let's try to make them kind
[182:53.92]of overlap. So, we're going to say from
[182:55.84]11 to
[182:58.24]15, which is fine. Click save. schedule
[183:01.84]saved successfully. Let's quickly
[183:04.31]refresh here. Okay, nice. Now we have
[183:07.20]two availabilities. This is the one that
[183:10.00]we just added from 11 to 15 on Friday.
[183:13.76]Also belongs to my schedule. So
[183:17.27]everything is working.
[183:20.24]Now let's try to add here
[183:24.88]another one on the same day also from 11
[183:30.00]to
[183:32.72]15.
[183:35.20]As you can see availability overlaps
[183:37.43]with one another. If I say from 11 to
[183:41.84]14,
[183:43.76]it's also going to give me availability
[183:46.24]overlaps with one another. Because here
[183:49.27]we have availability from 11 to 15 and
[183:51.84]here from 11 to 14, it's not going to
[183:54.16]work. Even if I try to say from 11 to
[183:58.24]17, it's not going to work. I have to
[184:00.47]say here from uh like uh 16 to 17, which
[184:04.31]is going to work. Now I can click save
[184:08.39]and it should reflect here. Yeah, very
[184:12.08]nice. Now let's try to delete all of
[184:15.60]them. And if we go here, we shouldn't
[184:18.88]see them reflect right away, right?
[184:22.47]Because we said that uh we only going to
[184:26.00]update these data, the schedule
[184:29.04]availabilities and the schedules, the
[184:32.24]relation between the two of them. when
[184:34.80]we update our schedule. So right now
[184:38.47]after I deleted all of them that was
[184:40.31]just client side I'm going to update my
[184:42.72]schedule just Monday from 9 to 7 or or
[184:46.47]from 9 to 5 sorry and now I'm going to
[184:49.43]reload my database and now it's updated.
[184:53.84]So if you if you remove this it's just
[184:56.72]client side. Remember here in the
[184:59.35]schedule form this remove availability
[185:02.31]is just client side function. It's just
[185:06.24]going to remove it from the client side
[185:08.80]view from the form here. Okay. It's not
[185:12.00]going to do anything with our database.
[185:14.64]We have to add new availabilities here
[185:17.76]like those ones from 9 to 5. Then let's
[185:22.47]make this from 9 to 11.
[185:26.64]And here let's say from
[185:30.64]here 11.
[185:33.27]And let's say here from 13 which is 1
[185:36.88]p.m. to 5. Okay. Click save. Saved
[185:40.47]successfully.
[185:43.12]Now reload.
[185:45.52]And it's reflected and updated here.
[185:49.04]Very nice. And now we're done with the
[185:51.60]schedule feature. So right now we have
[185:54.08]the events and the schedule features.
[185:58.56]So let's move on to the next step.
[186:03.84]All right. Then let's jump into the
[186:06.88]public side of things where users can
[186:10.08]share their profile and booking links so
[186:13.60]others can easily book meetings with
[186:16.39]them. And let's start by creating the
[186:19.68]public book page. I remember here we
[186:24.80]created a public book page. Yeah, this
[186:28.08]one. Let's delete all of that. And
[186:31.43]simply here we're going to create that
[186:33.20]public page. We're going to get the user
[186:36.31]and is loaded or not from a clerk
[186:39.92]function named use user. And this is a
[186:43.35]hook. So we have to say use client and
[186:48.39]if the user is not loaded yet return a
[186:51.04]loading component. We're going to create
[186:52.72]it right now. And if no user at all
[186:56.00]return a redirect to the login page
[186:59.92]and then we want to redirect the user to
[187:02.47]the booking public profile page. This is
[187:06.39]the page where we can show to the public
[187:08.80]to anyone. This is not a private page.
[187:12.08]So let's quickly create that loading
[187:14.16]component. I'm going to copy that. Go to
[187:16.80]components.
[187:18.56]Create a new file loading.tsx.
[187:22.24]And here we're going to create that
[187:23.60]loading component.
[187:25.76]And I got that uh loading indicator from
[187:29.92]a package named React loading
[187:33.20]indicators. Let's install it. We're
[187:36.24]going to say mpm
[187:38.64]install
[187:40.64]react loading indicators.
[187:42.96]And now click save. And by the way, this
[187:46.72]is the react loading indicators that I'm
[187:50.24]talking about.
[187:52.08]Let's take a look at it.
[187:56.47]Those are bunch of loading indicators.
[188:00.39]You can install this package. copy any
[188:03.20]of this code and you're going to get any
[188:06.56]of these indicators.
[188:09.12]Now, let's import
[188:11.52]the loading component.
[188:13.76]And right now, if I go to the public
[188:15.60]profile, I'm going to be redirected to
[188:18.16]that page forward/book forward slash the
[188:21.68]user ID. So, let's create that page
[188:25.04]here. Inside of book, we're going to
[188:27.43]create a new folder
[188:29.84]dynamically
[188:31.76]because we're going to take the clerk
[188:35.27]user
[188:36.80]ID
[188:38.31]dynamically.
[188:40.16]And inside of it, let's create a
[188:42.96]page.tsx.
[188:45.68]And here we're going to create that page
[188:48.39]public profile page which is going to
[188:50.88]take the clerk user ID from the params
[188:53.60]here. And then we want to get the user
[188:57.04]in order to display a public profile
[188:59.84]component that takes the user ID and the
[189:04.08]full name of the user. So here we're
[189:06.72]going to say connest client equals to
[189:08.72]await clerk client and that clerk client
[189:11.43]is coming from clerk next.js server.
[189:15.92]And here we're going to say conest user
[189:17.84]equals to awaitclient dot users.get user
[189:21.43]with the clerk user ID. And if you're
[189:24.39]asking yourself why you are not using
[189:26.80]this function like we did before or this
[189:30.72]function simply because both of these
[189:34.00]functions are used by authenticated
[189:36.72]users. I use these functions to get my
[189:41.12]ID for example or the ID of the person
[189:43.84]the authenticated person using the
[189:46.47]application. But here this is a public
[189:49.04]profile. We just need the clerk user ID
[189:52.64]and then show that user info to the
[189:56.24]public. Okay, we are not showing them to
[189:59.52]the user himself. We are showing the the
[190:02.24]data to the public. So nonauthenticated
[190:05.60]users can see this page and this is why
[190:09.84]we are using blur client and saying user
[190:14.64]equal client dot users to get user and
[190:18.88]then give uh that get user function the
[190:21.52]clerk user ID. Okay. So right now let's
[190:26.64]go ahead and create the public profile
[190:29.60]component.
[190:31.12]Let's go to components.
[190:34.39]Create a new file as usual. public
[190:37.76]profile.tsx.
[190:40.56]It will be a client component. And that
[190:43.76]component is going to take user ID and
[190:47.04]full name as props of type public
[190:49.92]profile props. So let's go ahead and
[190:53.43]create that public profile props. And
[190:57.35]then since we are uh displaying the
[191:01.35]public events for the user because of
[191:04.56]course this is the public profile at
[191:07.84]some point we're going to want to use a
[191:10.56]function named get public events.
[191:14.24]So before doing anything here let's
[191:17.12]create this function. Of course it's a
[191:20.24]server action. So let's go to
[191:24.24]events actions
[191:27.20]and let's here create this function
[191:30.08]which is going to fetch all active
[191:32.56]public events for a specific user and
[191:35.76]this action or this function is going to
[191:38.24]take clerk user ID of type string and
[191:41.92]return a promise that's eventually going
[191:45.12]to resolve to an array of public events
[191:49.76]which is a type that we have to create
[191:52.56]right now. So let's define the public
[191:56.72]event type and here we are removing is
[191:59.92]active from the event true and adding
[192:03.60]another one explicitly here. It's like
[192:07.20]saying the version of this event is
[192:10.00]guaranteed to be active. No maybe no
[192:14.08]false. This is just for type safety.
[192:17.27]Okay. And here simply we are using the
[192:20.31]find many method to get from the event
[192:22.56]table all the events where user ID
[192:25.35]column equal to clerk user ID and the is
[192:28.96]active has to be true. If an event has
[192:32.31]is active equal to false do not return
[192:35.12]it. Okay. And then we're going to sort
[192:37.92]it in ascending order. And then we're
[192:40.80]going to return the events as public
[192:43.84]event or as an array of public events.
[192:47.84]So right now we have normal events and
[192:50.31]we have public events. So let's go back
[192:54.00]here to the public profile and let's
[192:56.72]fetch the public events inside use
[192:59.04]effect like that and only refresh those
[193:02.39]events when the user ID changes. So here
[193:06.08]we're going to need to use use effect
[193:07.76]from React.
[193:10.08]And here get public events from our
[193:12.16]actions. And here when the public events
[193:14.80]arrives, we're going to set
[193:17.76]the events state or public events state
[193:20.56]with those events. But we don't have
[193:23.68]that state just yet. So let's create it.
[193:27.92]We're going to use use state from React
[193:30.72]which is going to take a public event
[193:33.12]type which is the public event that we
[193:35.84]just created.
[193:37.76]And actually that state is going to
[193:39.43]contain array of public events or it
[193:42.39]could be null and initially we're going
[193:44.64]to initialize it to null. So here
[193:47.04]whenever we get the public events we're
[193:49.12]going to set the events state to those
[193:52.08]public events and here simply we're
[193:55.27]going to say while the events equal to
[193:57.76]null just return the loading component.
[194:02.31]So while the events is being fetched or
[194:05.76]the public events is being fetched,
[194:08.08]we're going to show the loading
[194:09.84]component. Otherwise, of course, we're
[194:12.56]going to return our logic in a div like
[194:16.56]that which has these class names. And
[194:20.47]then here, first of all, if this is the
[194:22.72]profile owner, it's not just a public
[194:25.35]person viewing that profile, it's the
[194:27.84]profile owner. We're going to show him
[194:29.84]that info message with I icon coming
[194:32.96]from Louiside React telling him this is
[194:36.08]how people will see your public profile.
[194:38.80]So we're going to need to get the user
[194:40.56]info. We're going to go up here and
[194:43.76]let's say distracture the user from use
[194:47.84]user and that use user is coming from
[194:50.16]clerk nextjs
[194:52.80]and then after that we want to display
[194:55.20]the user's name here his full name and
[194:58.96]also if this is the profile owner we
[195:01.43]want to show them a copy profile uh URL
[195:04.80]button here we're going to get a copy
[195:07.12]icon from louisiside react and here on
[195:09.68]click whenever ever the user clicks on
[195:11.92]that button, we want to execute that
[195:14.08]function. Copy profile URL. So let's go
[195:17.27]ahead and define this function here
[195:21.52]which is also going to use the
[195:23.20]navigator.clipipboard
[195:25.35]to copy the profile URL to the users's
[195:28.96]clipboard.
[195:30.88]And here give him a toast saying profile
[195:33.92]URL copied to clipboard. And that's it.
[195:37.12]Here we are catching errors. Then
[195:39.84]provide a welcome message. This will be
[195:42.08]shown to anyone, not just the profile
[195:44.39]owner. And then we want to show the
[195:46.80]actual public events in a public event
[195:49.84]card like that. So we're going to
[195:52.08]display them in a grid view. And in case
[195:54.96]there are no events, we're going to say
[195:56.88]no events available at the moment.
[195:59.35]Otherwise, we're going to map on the
[196:01.12]events. And for each event, we're going
[196:03.35]to show a public event called component.
[196:07.12]So let's go ahead and define that
[196:09.76]component. So go to components, create a
[196:12.96]new file,
[196:14.64]public event card.tsx.
[196:16.96]And actually that component is going to
[196:19.12]be pretty similar to the event card that
[196:22.00]we created before except that here we're
[196:24.72]not going to show a button to copy the
[196:27.20]link of the event. This is something
[196:30.00]related to the authenticated users only.
[196:33.60]So here we are defining the props which
[196:36.47]is going to take all of these props. And
[196:39.52]here we're going to render a cord that
[196:42.39]has only a select button that will take
[196:45.20]the user here any public user. It's
[196:48.80]going to take them to the booking page
[196:51.52]where they can actually book that event
[196:54.39]with the with the event owner. Okay. Now
[196:58.64]save that component and let's go back
[197:00.72]here and import it. also save it and
[197:04.64]let's go back here and import the public
[197:08.23]profile component.
[197:10.56]Now everything is ready. Save everything
[197:14.31]and let's go back to our application. Go
[197:16.39]to public profile
[197:19.20]loading.
[197:20.88]And now this is my public profile. I
[197:24.64]have only one event here. I can copy the
[197:27.68]profile URL. give it to anyone
[197:31.76]then paste it here. Loading
[197:35.04]and this is my profile here. Right now I
[197:38.39]can select that event which is going to
[197:41.04]take me to the booking page but we
[197:43.20]didn't create it just yet. But here
[197:45.27]let's create a private event. Let's name
[197:48.00]it private.
[197:49.92]No description active false. Save.
[197:56.00]And this is my private event. If I go to
[197:59.52]my public profile, I shouldn't see it.
[198:03.76]Yeah, exactly. So, everything is working
[198:07.43]perfectly.
[198:10.23]All right, we finally reached the most
[198:13.68]exciting part of the project, the one
[198:16.23]I'm sure many of you have been waiting
[198:18.80]for. We're about to integrate Google
[198:21.52]Calendar to our app, Calendar, so people
[198:25.04]can book events with us. And those
[198:27.27]booked events will automatically show up
[198:30.47]in the user's Google calendar. That
[198:33.68]means they can get reminders, set
[198:36.23]alarms, and stay organized without any
[198:39.52]extra effort. And we're going to do all
[198:42.64]of that using the Google APIs. So, first
[198:46.16]of all, head to Google. Go to your
[198:48.00]Google account and then search for
[198:50.31]Google console. Then go to the website
[198:55.60]console.cloud.google.com
[198:57.92]and inside of your Google cloud choose
[199:01.12]select project. Then create a new
[199:03.43]project
[199:05.12]and let's name your app Calendra. Then
[199:07.68]click create and then choose this
[199:11.20]project that you just created calendar.
[199:13.20]Then go to dashboard
[199:15.84]and then here search for APIs and
[199:18.72]services.
[199:20.56]First of all, let's enable the Google
[199:22.96]calendar API.
[199:25.92]So, go here and click on enable APIs and
[199:29.27]services.
[199:31.52]And here, let's search for
[199:34.39]calendar. I typed calendar by mistake,
[199:37.35]but anyways, I got the the Google
[199:39.76]calendar API.
[199:42.88]Go to it and click enable.
[199:47.84]And then let's go to credentials.
[199:50.88]and click here on create credentials.
[199:53.76]Then choose OO client ID.
[199:58.72]Okay, it's required to configure consent
[200:00.96]screen first. So let's do it. Click on
[200:03.60]get started.
[200:05.60]App name
[200:07.35]Calendra.
[200:09.04]Then
[200:10.56]put your email here. Click next. And
[200:13.92]then in audience choose external since
[200:16.31]we want our application to be used by
[200:18.56]anyone. So click external and then
[200:21.76]contact information also put your email
[200:25.92]then click finish
[200:28.23]continue create
[200:34.16]then create o client
[200:37.60]authentication type web application
[200:41.04]let's name it web client one it's okay
[200:43.84]here if you want to add your domain name
[200:45.68]which is localhost for now or later when
[200:48.88]we deploy our application to Verso. You
[200:52.23]can add your domain name here, but it's
[200:54.47]not required. I'm not going to do it
[200:56.31]here. We're going to need to get this
[200:58.31]authorized redirect URIs. And actually,
[201:01.35]we're going to get it from our clerk
[201:03.52]project. So let's go to clerk. Go to
[201:06.80]your dashboard and then go to your
[201:09.43]project calendar. Go to configure
[201:14.16]and then choose SSO connections
[201:17.76]and then choose Google here and click on
[201:20.47]edit Google settings.
[201:23.76]And then we're going to use custom
[201:26.23]credentials.
[201:28.64]See here the authorized redirect URI.
[201:31.52]We're going to copy that.
[201:34.31]Then go back here to Google Cloud and
[201:38.16]add that authorized redirect URI
[201:42.23]and then click on create. Then Google is
[201:45.43]going to give you a client ID and a
[201:47.04]client secret. Copy that client ID. Go
[201:49.43]back to Clerk dashboard. paste the
[201:52.64]client ID here and then also copy the
[201:56.47]client secret
[201:58.88]and paste it here. And now let's put all
[202:03.60]of these credentials in our projects in
[202:07.27]file. Let's go to M file here and let's
[202:12.08]create these three variables Google O
[202:15.35]client ID and client secret and the
[202:18.08]redirect URL. Then let's go ahead and
[202:21.43]copy the Google client ID and just paste
[202:24.64]it here. And then copy the client
[202:27.20]secret. And also paste it here. And then
[202:30.88]copy the authorized
[202:33.04]redirect URI. And then paste it here.
[202:37.68]Now click save. Let's go back to clerk.
[202:40.80]We're going to need to add some scopes
[202:42.80]also.
[202:44.88]So here back in the Google Cloud
[202:48.31]Console,
[202:49.84]save all of that
[202:52.23]and let's go to data access.
[202:55.60]And here choose add or remove scopes.
[202:59.52]Then choose these scopes. User info
[203:02.96]email then user info.profile then open
[203:06.80]ID. And then we're going to need to add
[203:08.88]a scope here. What do we need to add?
[203:11.60]We're going to need to add the Google
[203:13.20]Calendar events scope. So, just go to
[203:16.88]Google and search for Google Calendar
[203:18.64]API scopes. Then choose the first
[203:21.84]result. It's going to redirect you to
[203:24.64]the scopes page here. As you can see, we
[203:27.60]have many, many scopes.
[203:31.04]The only one we're going to use here in
[203:32.80]our project is this one.
[203:35.76]googleis.com/oth
[203:39.43]slcalevents.
[203:42.39]So copy that and let's go back here to
[203:45.35]our Google console
[203:48.31]and paste it and then add to table
[203:52.23]and right now it's added to the table.
[203:55.92]Then after that click on updates
[203:59.27]and then click save.
[204:02.64]And then let's go back to audience. And
[204:05.43]here after we finish our application and
[204:07.76]deploy it to versel to the internet, we
[204:10.47]can publish the app so that it can be
[204:13.20]used by any Google user. But for now,
[204:16.39]we're going to add test users. I'm going
[204:18.16]to put my email, this one. Then click
[204:20.64]save.
[204:22.88]And that's it. Now we can use our
[204:24.88]application from just this email. You
[204:27.76]can put your email as a test user. And
[204:30.31]then after that when you want to publish
[204:32.39]your application to all Google users
[204:35.20]you're going to publish app you're going
[204:36.80]to click on publish app here but you
[204:38.96]should know that uh at this point it's
[204:41.27]going to go through some verification
[204:43.04]process from Google and stuff like that.
[204:45.35]Okay, I think we've done everything
[204:47.68]here, but we didn't add the scope here,
[204:51.04]right? So, let's add it. Let's copy this
[204:54.23]scope and add it here to clerk
[204:58.16]scopes. Click adds. And yeah, we're good
[205:01.27]to go. Also, click update here.
[205:04.39]And that's it. Now, let's go back to our
[205:07.43]project and open the terminal. And let's
[205:10.88]install the Google APIs package. We're
[205:12.96]going to say mpm mpm install
[205:16.39]Google APIs. Press enter.
[205:21.27]And there we go. Google APIs is
[205:23.52]installed.
[205:25.52]Now, let's go to our server directory.
[205:29.68]And inside of server, we're going to
[205:31.43]create a new folder and name it Google.
[205:35.12]And inside of Google, we're going to
[205:36.72]create a file named Google
[205:39.76]Calendar.ts.
[205:41.84]ts
[205:43.52]and let's make this file a server file.
[205:45.68]We're going to say use server which
[205:48.39]means it's only going to run on the
[205:50.23]server and let me also leave a comment
[205:53.68]here for you on what this file
[205:57.04]supposed to do. Okay, perfect.
[206:01.20]And here first of all we're going to
[206:02.80]create a function
[206:05.04]that's going to get oath client from
[206:08.08]Google. So we're going to name it get
[206:10.39]oath client which is going to take a
[206:12.23]clerk user ID of type string and then
[206:15.60]it's going to initialize a client using
[206:18.72]the clerk client and then it's going to
[206:21.43]get the Google access token from clerk
[206:25.27]using the clerk user ID by saying client
[206:28.80]do users do get user access or oath
[206:32.64]access token of Google and then we're
[206:35.12]going to of course provide the clerk
[206:36.64]user ID here and Then we're going to
[206:39.12]dstructure the returned data. If no data
[206:42.23]just through an error otherwise we're
[206:45.43]going to generate an oath client by
[206:48.16]saying new Google. That Google is going
[206:50.64]to come from the Google APIs.
[206:54.00]So let's go up here and import Google
[206:56.16]from Google APIs.
[206:58.56]And then here we're going to get the
[207:00.08]oath client by saying new Google.
[207:03.84]Oo 2. And then we're going to provide
[207:07.35]the client ID, client secret, and the
[207:09.76]redirect URL. And then we're going to
[207:12.56]set the credentials using the obtained
[207:15.84]access token here. And right now we have
[207:19.20]a Google O client. Now we can use this
[207:23.92]function whenever we do any Google API
[207:27.04]operation. Okay. Our next step is to
[207:30.72]create the booking events page. the page
[207:35.12]which will allow users to book events
[207:37.43]with other users.
[207:40.31]So let's go here to clerk user ID folder
[207:43.43]and inside of it let's create another
[207:45.84]dynamic folder dynamic route
[207:49.68]and name it event
[207:52.39]ID
[207:54.31]and inside of it let's create our page
[207:57.35]page.tsx tsx
[208:00.31]and let's create the page. That page is
[208:03.52]going to take params dynamically which
[208:06.23]is a promise that we're going to resolve
[208:08.56]to clerk user ID of type string and
[208:11.68]event ID of type string. And here of
[208:14.80]course we need to dstructure the user ID
[208:17.12]and the event ID. And then of course we
[208:20.08]need to fetch the event that the user is
[208:22.96]going to book. So, we're going to use
[208:25.20]the get event action. And if the event
[208:28.64]doesn't exist, we're going to give the
[208:30.88]user an alert message saying that the
[208:33.20]event doesn't exist anymore. And that
[208:36.23]alert triangle is coming from Louisside
[208:38.96]React. And then we're going to need to
[208:41.43]get the valid times, the users valid
[208:44.64]times. So, we're going to create a start
[208:46.80]date, which is a date range from now
[208:49.43]rounded up to the nearest 15 minutes to
[208:53.12]one year later, one year after that. And
[208:56.31]we're going to use a function named
[208:58.16]round to nearest minutes coming from a
[209:00.96]package named date functions. Let's
[209:03.52]install it. We're going to type mpm
[209:06.16]install
[209:07.76]date-fs,
[209:09.92]which is functions. And now it's
[209:12.31]installed. Let's import this function.
[209:16.64]Okay, it's not recognized. I don't know
[209:18.47]why. So, let's write that imports
[209:22.08]manually. We're going to need all of
[209:24.23]these functions from the date functions
[209:26.88]package.
[209:28.47]This function will take a new date which
[209:31.04]represents now the current time. And
[209:33.92]we're going to say nearest 215 and
[209:36.00]rounding method seal. And the end date
[209:39.76]is going to be end of day function which
[209:43.84]is also coming from date functions
[209:46.00]package. Then we're going to add years
[209:49.76]from the start date and one year ahead.
[209:55.20]And then we're going to generate a valid
[209:57.60]available time slots for the event using
[210:00.88]this function. We're going to create
[210:02.64]this function right now. But let me tell
[210:05.43]you what this logic is doing here. If
[210:08.16]the current time is
[210:10.80]2 p.m. for example,
[210:13.52]then the next few 15inut time slots
[210:16.23]would be from 2 p.m. 2
[210:22.23]p.m. then from 2:15 2 to 2
[210:27.27]p.m. and so on.
[210:29.60]You get the idea, right? So, okay. Right
[210:32.88]now, we're going to need to create this
[210:34.64]function, the get valid times from
[210:36.88]schedule, which will allow us to get all
[210:39.76]the valid times of a user from his
[210:42.16]schedule. So, this function is going to
[210:44.72]be in the schedule actions
[210:48.00]here. Okay. What should this function
[210:51.27]do? We want to filter a list of time
[210:54.00]slots and return only those that match
[210:58.39]the user's availability schedule and
[211:01.27]also don't overlap with existing Google
[211:04.39]calendar events. So in that case we have
[211:07.52]to get in touch with uh his Google
[211:10.00]calendar to know what events exactly do
[211:12.72]they have in their Google calendar.
[211:14.96]Right? So create the function. It's
[211:18.23]going to be an asynchronous function and
[211:20.88]this function is going to take two
[211:23.12]arguments. The first one is all possible
[211:26.31]time slots to check which is going to be
[211:28.72]an array of dates and that argument has
[211:32.16]the name times in order and also we're
[211:35.20]going to take the event the only event
[211:37.52]specific data that we're going to need
[211:39.60]which is the user ID of type string and
[211:42.88]the duration in minutes and of course
[211:45.27]it's going to be of type number and this
[211:48.39]function is going to return a promise
[211:51.43]that eventually going to resolve to an
[211:53.92]array of dates. Of course, we want valid
[211:57.35]times. So, we're going to return array
[211:59.52]of dates. And then let's unpack the data
[212:02.39]from the event. We're going to take the
[212:04.16]clerk user ID. And also, we're going to
[212:06.80]take
[212:08.31]the duration in minutes. And then we're
[212:11.52]going to need to define the start and
[212:13.60]end of the overall range to check.
[212:17.52]So we're going to say start equals to
[212:19.60]times of in order of index zero which is
[212:22.47]the first item and the end is the last
[212:25.68]item at negative1 or at index1.
[212:31.12]And then we're going to say if no start
[212:33.04]or end just return an empty array. There
[212:35.84]are no times to check. And then of
[212:38.16]course we're going to need the user's
[212:39.84]schedule. So we're going to say conest
[212:41.92]schedule equals to await get schedule
[212:44.47]using the user ID. And of course when we
[212:47.52]get that schedule we're going to get it
[212:49.52]with their availabilities.
[212:52.56]Then also if no schedule return an empty
[212:55.12]array. And then we want to group
[212:57.12]availabilities by day of week like we
[212:59.27]did before remember. So we're going to
[213:01.20]say grouped availabilities equals to
[213:03.20]object.group by schedule.
[213:06.88]Take each availability and group it by
[213:10.39]availability dot day of week. And then
[213:14.56]as we said, we want to get all the users
[213:17.52]calendar or Google calendar events. So
[213:21.20]we're going to use this function which
[213:23.12]we're going to create later. That's
[213:25.35]going to fetch all existing Google
[213:27.60]calendar events between the start and
[213:29.84]end times. So simply we're going to give
[213:33.04]it the user ID and an object containing
[213:35.52]the start and end dates. And now before
[213:38.88]we go along with this function, let's
[213:40.96]define this function which is going to
[213:43.04]get the Google calendar events for the
[213:45.04]user. We're going to create it in our
[213:46.96]Google calendar file here. And as we
[213:50.16]said, that function should get uh
[213:52.64]calendar events for a user between a
[213:55.20]range of given dates.
[213:58.08]And this function will take a cleric
[213:59.84]user ID of type string and an object
[214:02.39]containing start and end of type dates.
[214:05.84]And this function will return a promise
[214:08.00]which will resolve to an array of
[214:09.92]objects containing start and end dates.
[214:13.12]And here we're going to make a try catch
[214:16.23]blocks.
[214:18.56]And whenever any error happens, catch it
[214:21.12]this way. And here in the try block,
[214:24.00]what do you think the first step that
[214:26.47]we're going to need to do? Remember when
[214:28.96]we said that whenever we're going to do
[214:31.20]a Google API process, we're going to use
[214:33.84]this function to get the oath client.
[214:37.43]This is exactly what we're going to do
[214:39.43]here.
[214:40.96]We're going to get the oath client using
[214:44.47]the clerk user ID. And if it doesn't
[214:47.60]exist,
[214:49.12]just through this error. And then we're
[214:52.23]going to fetch the Google calendar
[214:54.64]events using this code. We're going to
[214:57.60]say connest events or or you can call it
[215:00.08]Google calendar events whatever await
[215:02.80]Google doc version 3 doe events.list
[215:06.47]lists and then we're going to give it
[215:08.08]all these data calendar ID primary event
[215:12.56]types default which means only fetch
[215:15.76]regular nonsp special events single
[215:18.96]events true and then we're going to give
[215:21.35]it the start of the time range time min
[215:25.12]which is start to string and time max is
[215:30.47]the end of the time range and here we
[215:33.60]are limiting the number of returned
[215:35.43]events
[215:36.64]to 25,500
[215:39.76]and the oath equals to oath client.
[215:43.76]Right now we should have the Google
[215:46.00]calendar events. So what should we do
[215:48.56]with those events? Simply we're going to
[215:51.12]process and format those events. So here
[215:54.72]we're going to return those formatted
[215:57.12]events. How are we formatting it? We're
[216:00.00]going to loop on the event data do items
[216:02.39]and map on each event. And if event dot
[216:06.31]start meaning that we are handling all
[216:08.80]day events no specific time just a date
[216:12.08]a whole day or a whole date if the event
[216:16.00]has start date and end dot date and of
[216:20.56]course it's optional because it might
[216:22.31]not have it. We're going to return a
[216:24.39]start and an end which is going to be
[216:26.96]the return of start of day coming from
[216:29.60]date functions which is going to be new
[216:32.23]date event.st start date which is going
[216:34.80]to set the time to 0 0 as you can see.
[216:37.60]This is of course the beginning of any
[216:39.76]day. We said here that we want all day
[216:42.80]events remember. So we need to get the
[216:46.08]start of the day which is 0 0 0 and the
[216:49.35]end of the day or the end time of the
[216:52.23]day which is 2359 or 23 is 11 actually.
[216:57.20]So this is the last minute of the day.
[216:59.60]This is the first minute of any day and
[217:02.88]this is the last minute of any day. So
[217:05.92]here we're going to call end of day from
[217:08.00]date functions. And in case we have
[217:12.00]timed events with exact start and end
[217:14.56]date times, we're going to say if event
[217:17.35]start date time. Okay, here we we said
[217:20.47]dot date, but here we're saying date
[217:23.52]time. And also if we have event end dot
[217:28.00]date time we're going to also return the
[217:30.80]start and end times the start is going
[217:34.31]to be new date of event dot start date
[217:37.35]time and here we are calling the new
[217:39.68]date to convert it to a JavaScript date
[217:42.31]object. And of course we're going to do
[217:44.56]the same for the end time. And whenever
[217:47.92]the map function find a date that
[217:51.04]doesn't have time data, it's going to
[217:53.35]return undefined. Okay. And then we're
[217:57.27]going to filter the results. Okay. After
[218:01.76]mapping, we're going to filter the
[218:03.52]results. Of course, we are filtering the
[218:06.56]undefined dates or undefined data. So
[218:10.31]basically here, we are taking each date
[218:12.64]and we're going to filter out any date
[218:15.04]that is undefined. And that's it. This
[218:17.92]is our Google calendar uh or get
[218:20.72]calendar event times. Now let's go back
[218:23.20]here to the schedule actions and import
[218:27.20]this function. Now we have our event
[218:31.12]times. Okay, what are we going to do
[218:33.12]with it? We want to filter those event
[218:36.39]times and return only valid time slots
[218:39.92]based on the user availability and also
[218:43.27]based on conflicts to make sure we don't
[218:45.35]have any conflicts. So, we're going to
[218:48.00]need to filter those times in order. And
[218:52.72]since we are filtering something, we
[218:55.12]usually use the filter function and
[218:59.20]we're going to return the result. Okay.
[219:03.04]Okay. What are we going to do inside of
[219:04.96]this filter function? We're going to
[219:06.96]take each interval date
[219:10.72]and then we're going to get the
[219:11.92]availabilities of the user
[219:14.88]using a function named get
[219:16.72]availabilities.
[219:18.39]Let's quickly define this function here
[219:21.43]and that get availabilities is going to
[219:23.35]take grouped availabilities and then
[219:26.16]here we are saying partial and then
[219:28.72]record. Let's explain each one of them.
[219:31.35]First let's talk about the record. The
[219:33.84]record is something in Typescript or a
[219:36.96]utility that creates a type where this
[219:39.84]is the key. Think of it as as an object.
[219:43.35]Okay. This is going to be the key of
[219:46.23]each item and this is the value. So the
[219:49.27]key is going to be any day of the week.
[219:52.39]It can be Monday, Sunday, Tuesday and so
[219:55.35]on. And here the value is going to be
[219:58.23]arrays of availability data. And each
[220:01.68]item in in that array represents an an
[220:04.64]availability. And this is why it's
[220:06.47]inferred here from the schedule
[220:08.80]availability table. And the whole thing
[220:11.84]is wrapped in partial meaning that not
[220:15.52]all days of the week have to be present
[220:18.72]in the grouped availabilities.
[220:21.52]Some days may be missing entirely
[220:24.31]because of course the user could be not
[220:26.64]available in some days, right? He could
[220:29.04]only have availabilities on Monday and
[220:31.76]Tuesday and so on. So basically here it
[220:35.04]expects a grouped availabilities in that
[220:37.68]way. an object that has keys like Monday
[220:42.00]and that Monday should have value like
[220:44.88]an array and that array
[220:48.31]can contain
[220:50.88]many availability objects like here
[220:55.43]start or start time or whatever
[220:59.12]nine and end time let's say five
[221:05.43]and here it could have another
[221:08.08]availability like here let's say from 9
[221:11.12]to two and here from two to five and so
[221:16.88]on and it can have another availability
[221:20.08]array
[221:21.92]for let's say Wednesday here this could
[221:26.39]be from 11 to 2 and so on you get the
[221:30.00]idea and of course Thursdays might not
[221:33.60]be there at all right Fridays also
[221:36.88]couldn't be there and this is why we are
[221:39.20]saying partial here. Okay, I hope this
[221:44.08]is clear. Now let's get back to the get
[221:47.04]availabilities here. The second argument
[221:50.08]is going to be a date of type date and
[221:52.96]the third argument is going to be a time
[221:55.04]zone of type string and then it's going
[221:57.52]to return array of objects containing
[222:00.39]start and end dates. And then here
[222:03.43]simply we're going to determine the day
[222:04.96]of the week based on this data the given
[222:08.47]data and we're going to use all of these
[222:11.27]functions from date functions.
[222:15.84]Going to go ahead and import all of
[222:17.35]them.
[222:19.43]If the day of the week is not determined
[222:21.43]return an empty array and then get the
[222:24.00]availabilities for the determined day.
[222:27.20]So we're going to say day availabilities
[222:29.76]equals to grouped availabilities of
[222:31.68]index day of week. And if it doesn't
[222:34.31]exist, if there are no availabilities,
[222:36.39]also return an empty array. And then as
[222:39.35]we said, we want to return array of
[222:41.60]objects containing start and end dates.
[222:44.64]So we're going to need to map on each
[222:46.47]availability
[222:48.00]and map that availability to a start and
[222:51.68]end date objects or object adjusted to
[222:55.27]the user's time zone. Okay, how are we
[222:57.68]going to do it? We're going to map on
[222:59.84]the day availabilities and take the
[223:02.39]start time and end time. And we're going
[223:04.72]to parse the start time into hours and
[223:07.60]minutes like that. And we're going to do
[223:09.84]the same for the end time. And then
[223:12.39]we're going to need to create a start
[223:14.08]date object.
[223:16.16]We're going to call the set hours on the
[223:19.60]date and start hour. And then we're
[223:21.52]going to call set minutes
[223:24.08]on the returned value from this set
[223:26.64]hours and our start minute. And then
[223:29.35]we're going to use a function named from
[223:31.92]zoned time. Okay. What does this
[223:34.80]function do? Basically, you give this
[223:37.19]function a time and a time zone and it
[223:40.31]returns back a date object that
[223:42.88]represents that time in that time zone.
[223:53.19]And this is why we're going to use this
[223:55.12]function. And this function is coming
[223:57.35]from a package named date functions
[224:02.64]TZ which is an extension to the date
[224:05.27]functions package. So let's install it
[224:08.96]and then let's go up here
[224:12.56]and import
[224:15.04]this function. And finally here we're
[224:17.76]going to return the start and end
[224:20.47]availability interval. Now let's import
[224:23.19]the days of the week. We forgot to
[224:25.12]import it. So yeah, now we're we're done
[224:27.76]with the get availabilities function. Of
[224:29.84]course here don't forget that we are
[224:32.47]mapping here on the day availabilities.
[224:34.64]We are using the map function and
[224:36.23]returning these data and then we are
[224:39.19]here returning the returned data from
[224:42.31]the map function. Okay,
[224:44.88]this is just a reminder and now let's go
[224:47.43]back to this function. We were returning
[224:49.60]times in order filter and then we are
[224:52.64]looping on each interval date and
[224:54.64]getting the user availabilities. And
[224:57.60]then here we're going to create the
[224:58.96]event interval. Of course, the start
[225:01.68]time is going to be the interval date
[225:04.64]and the end time is going to be add
[225:06.96]minutes and then we're going to add
[225:08.16]duration in minutes to the interval
[225:10.39]date. So right now we have the users
[225:13.35]availabilities from our database. Okay.
[225:16.96]And we have a time range of a potential
[225:19.43]event starting at this interval.
[225:23.04]Right now we want to synchronize this
[225:26.31]with the event times from Google. Okay,
[225:29.04]from the Google calendar. Now we have
[225:31.04]the availabilities from our database. We
[225:33.60]have the event interval and we want to
[225:36.31]synchronize everything with the event
[225:38.47]times coming from Google calendar. So
[225:41.52]we're going to keep only the time slots
[225:43.43]that satisfy two conditions. The first
[225:46.39]one is that this time slot doesn't
[225:49.27]overlap with any existing Google
[225:51.76]calendar events. Right? And the second
[225:55.43]one is the entire proposed event fits
[225:58.16]within at least one availability window
[226:01.04]from the user availabilities here from
[226:03.19]our database.
[226:05.12]As we said, we are synchronizing our
[226:07.52]database our application with the Google
[226:10.16]calendar. So we're going to loop on the
[226:12.47]event times and we're going to return
[226:15.12]the event time that aren't
[226:18.72]overlapping
[226:20.47]with the event interval. So here we're
[226:23.12]going to say return not our intervals
[226:26.00]overlapping and then we're going to give
[226:27.43]it the event time and the event interval
[226:30.00]and this function is coming from date
[226:31.76]functions and then here as we said we
[226:34.16]want also the event to fits within at
[226:37.04]least one availability window. So we're
[226:39.19]going to say availabilities do sum and
[226:41.92]then we're going to loop on each
[226:43.12]availability and return only if the
[226:46.08]event interval dot start is within the
[226:49.68]availability.
[226:51.43]Start is inside availability
[226:54.16]and this is why we're going to use this
[226:56.00]function is within interval also coming
[226:59.12]from date functions and also we're going
[227:02.00]to do the same for the end time. It has
[227:05.43]to be inside availability. So here to
[227:08.72]sum up basically all of this complicated
[227:11.60]code is getting all the possible dates
[227:16.08]or times from now up to one year later.
[227:21.43]Okay, all possible start dates and also
[227:25.19]all possible end dates. And then it's
[227:28.47]giving those two dates to this function.
[227:32.31]Of course, after we do an interval,
[227:35.12]we're going to convert to an interval
[227:36.56]with a step 15. So, this will become
[227:39.76]time intervals from now to one year
[227:42.80]ahead. And also, we're going to give
[227:45.12]this function the event, the event that
[227:47.68]we want to book eventually. And this
[227:49.68]function is going to take those time
[227:51.43]intervals in order and the event. And
[227:54.80]it's going to take the very first start
[227:57.27]time and the end time. Then it's going
[228:00.47]to get the schedule of the user and then
[228:04.08]it's going to group his availabilities
[228:06.23]and then it's going to get all the event
[228:08.08]times from their Google calendar and
[228:10.56]then it's going to get all the
[228:12.23]availabilities from our database for
[228:14.39]that user and simply since right now it
[228:17.43]has all his availabilities from our
[228:19.52]database and all the event times from
[228:22.72]the Google calendar and also all the
[228:25.76]time or or time slots or time intervals
[228:29.19]that it wants to check here. It's going
[228:31.43]to return all time slots that doesn't
[228:34.23]overlap with any existing calendar
[228:36.80]events for that user and also the event
[228:40.00]that fits within at least one
[228:42.08]availability window for that user. Okay.
[228:45.27]Now, click save and let's go back here.
[228:48.72]Import this function.
[228:51.12]And here if no valid times, we want to
[228:53.68]handle this case. So, we're going to say
[228:55.43]if no valid times or the valid
[228:58.31]times.length length equal to zero return
[229:01.04]that component no time slots which is
[229:03.68]going to take the event and the calendar
[229:05.52]user and give him some message. So let's
[229:09.52]quickly define this component no time
[229:13.04]slots.tsx tsx and here that component is
[229:16.39]going to take an event and a calendar
[229:18.16]user those are their types and render a
[229:22.08]card displaying these messages book the
[229:25.60]event name with the calendar user full
[229:28.56]name and so on and here it's saying that
[229:31.35]this user is currently booked up save
[229:34.47]this component and import it here
[229:38.08]and here finally we want to render the
[229:40.31]booking form with the list of valid
[229:43.84]available times. So let's import all of
[229:47.84]cart components. And here we're going to
[229:51.04]need to render this meeting form. Of
[229:54.88]course, that form is going to take the
[229:56.72]valid times, the event ID, and the clerk
[229:59.92]user ID. Here we forgot to get the
[230:02.96]calendar user. So let's go up here and
[230:07.04]get the client from clerk client. and
[230:09.27]then get the calendar user from clerk.
[230:13.60]So yeah, now let's go ahead and define
[230:15.43]this component.
[230:18.80]So now you know the drill. We're going
[230:21.76]to create that component. So go to
[230:24.23]components
[230:25.84]and go to forms, create a new file, name
[230:29.43]it meeting form.tsx.
[230:32.72]It's going to be a client component. And
[230:35.12]here, this is what the component should
[230:37.60]do. And here we're going to create that
[230:40.64]component. It's going to take valid
[230:43.27]times event ID and clerk user ID. As we
[230:46.08]said, the times of course is going to be
[230:48.80]array of dates. The event ID is going to
[230:52.08]be a string and clerk user ID is going
[230:54.72]to be a string. Then here, as usual,
[230:58.00]we're going to create a form instance.
[231:01.43]The usual stuff. Of course, it's going
[231:04.31]to infer its data from the meeting form
[231:06.80]schema. So, let's create that schema.
[231:10.64]We're going to go to
[231:13.19]the schema folder
[231:15.84]and create a new file for
[231:18.72]meetings. And here we're going to create
[231:21.52]a base schema. And then we're going to
[231:24.08]create one schema for the form. And here
[231:27.27]we're going to merge the base schema to
[231:29.60]the meeting form. And we're going to
[231:31.43]create another one named meeting action.
[231:34.08]So later when we create the create
[231:36.23]meeting action the function that will
[231:38.39]allow us to create a meeting we're going
[231:40.64]to merge the meeting schema base to that
[231:44.47]meeting action schema. So basically here
[231:47.27]we're creating a basic schema also the
[231:50.08]usual stuff here it's going to have a
[231:52.08]start time start time of the meeting
[231:56.47]guest email guest name guest notes and a
[232:00.96]time zone and then the meeting form
[232:03.52]schema is going to have a date and it
[232:06.31]must be a valid date and must be today
[232:09.60]or later.
[232:11.43]This is why we are using start of day
[232:14.16]function and we are providing this
[232:16.47]message in case of an error and we are
[232:19.52]merging the base schema to it as we said
[232:22.80]and here the action schema the meeting
[232:26.00]action schema is a different schema and
[232:28.39]also we are merging the base schema to
[232:31.52]it. Okay. So now let's go back here and
[232:34.56]import the meeting form schema. And here
[232:37.84]we are providing the default values for
[232:40.16]the form.
[232:41.84]And now we want to create some state for
[232:44.31]the time zone and date. But we want this
[232:46.96]state to be related to the react hook
[232:49.92]form. And this is why we're going to say
[232:51.84]const time zone equals to form.watch the
[232:55.04]time zone and date equals to form.watch
[232:58.88]the date. Here in the schema, remember
[233:02.16]we have time zone
[233:05.27]and date. So, we want to watch them.
[233:08.72]We're going to create something similar
[233:11.12]to the React state, but it's more of a
[233:14.96]React hook form state. Okay. And then
[233:17.84]whenever the user chooses their time
[233:20.80]zone, let's say someone from the United
[233:23.04]States chose the the United States time
[233:26.16]zone, we want to convert to the United
[233:28.88]States time zone. So here we're going to
[233:31.35]use use memo. So the conversion only
[233:34.31]runs when valid times or time zone
[233:37.12]changes. Of course, we can use also use
[233:39.68]effect, but here we are using use memo
[233:41.76]because it's better with caching and
[233:43.52]stuff. So we're going to import it from
[233:45.43]React. And here this is coming from date
[233:49.27]functions. And here inside of this
[233:51.76]function we are mapping on the valid
[233:53.52]times these valid times. And we are
[233:56.88]taking each date and converting it to
[234:00.00]the user's time zone. And as we said
[234:02.80]we're going to execute that operation or
[234:05.12]we're going to calculate this whenever
[234:08.47]the valid times or time zone changes.
[234:11.19]And we are using use memo for caching.
[234:14.80]And then let's create the onsubmit
[234:16.88]function which is going to also take
[234:18.96]values. You know the drill. And here
[234:21.84]it's going to execute the create meeting
[234:25.04]action. So let's create that action. So
[234:28.47]let's go to actions. I don't think we
[234:32.08]created the meeting action before. Yeah.
[234:34.96]So let's create a new file here in in
[234:37.68]actions called meeting.ts.
[234:41.04]or let's name it meetings. And here
[234:43.68]we're going to create the create meeting
[234:45.60]action. This action is going to take
[234:48.08]unsafe data inferred from the meeting
[234:52.16]action schema. Remember when we created
[234:54.96]here a meeting form schema and a meeting
[234:57.35]action schema and we merged both of them
[235:00.56]with the meeting schema base and here we
[235:04.64]are initializing the the path. I think
[235:07.60]we are using redirect here.
[235:10.72]Yeah. Okay. We're going to change that.
[235:13.19]We know already that the redirect has a
[235:15.19]bug or something like that. So, we're
[235:17.68]going to do that later. But right now,
[235:19.68]we are getting the data from safe
[235:22.16]parsing the unsafe data and so on. And
[235:25.52]here we are getting the event from our
[235:28.96]database. The usual stuff is active has
[235:32.31]to be true. Clerk user ID has to be
[235:35.43]equal to data. Clerk user ID. and the id
[235:39.12]has to be equal to data.event
[235:41.76]id and all of these conditions have to
[235:45.12]be true all together. This is why we are
[235:48.47]using and if no event through an error
[235:52.64]and here we are converting the start
[235:54.72]time from the users time zone to
[236:01.35]and then we're going to check if the
[236:02.88]selected time is valid for the events
[236:05.60]availability. So we're going to say
[236:07.68]const valid times equals to get valid
[236:10.47]times from schedule using the time zone
[236:14.47]this time zone in the event if no valid
[236:17.92]time through an error. And then we're
[236:20.72]going to use a function named create
[236:24.00]calendar event to actually create the
[236:27.43]Google calendar event with all the
[236:30.64]details. So let's create this function.
[236:34.23]Let's go to the Google calendar file.
[236:37.92]This function since it's going to book
[236:40.00]an event on the Google calendar, it's
[236:42.23]going to have to take all of these data.
[236:44.39]Lur user ID, guest name, email, start
[236:47.12]time, guest notes, duration in minutes,
[236:50.00]and the event name. And here we are
[236:52.72]returning a calendar event, a Google
[236:55.84]calendar event. This is a specific type
[236:58.39]coming from Google APIs called calendar
[237:01.52]version 3. schema event. Okay, here we
[237:04.96]are getting the oath client, getting the
[237:07.68]user from clerk, get then getting his
[237:11.04]primary email if no primary email
[237:13.76]through an error and then we're going to
[237:16.16]insert in the Google calendar events
[237:19.92]by using this code google.cal version 3
[237:23.35]all of these data. Okay, here import the
[237:27.12]app minutes when calculating the end
[237:29.60]date time. And finally, we're going to
[237:32.00]return the calendar event data. And
[237:35.27]that's it. Now, let's import this
[237:38.23]function here.
[237:40.23]And here, let's remove the finally
[237:42.80]block. And I'm going to copy or remove
[237:46.00]the path variable from here by cutting
[237:48.16]it. do that. I want to say router dot
[237:53.19]push
[237:54.88]to the path.
[237:57.35]No, not this router.
[238:01.92]Remove this.
[238:04.23]So here we have to say conest router
[238:07.92]equals to use router coming from next
[238:13.27]navigation. And here of course we're
[238:16.23]going to have to say something like
[238:18.56]connest let's say meeting data equals to
[238:23.60]await meeting
[238:26.47]and here we're going to say meeting data
[238:29.12]also here meeting data
[238:33.84]and here as well here meeting data and
[238:38.72]here meeting data also.
[238:43.43]So right now we should return the
[238:46.00]meeting data from the create meeting
[238:48.31]right. So let's go here. After creating
[238:52.88]the calendar event, we can say return
[238:56.16]something like
[238:58.31]what do we want to return?
[239:01.19]An object containing the data dot
[239:05.60]clerk user ID or here we're going to say
[239:09.27]return clerk user ID from
[239:13.12]the data dot clerk user ID. And here we
[239:18.23]have the event ID.
[239:20.88]So here event ID
[239:24.16]from data doevent ID. And finally, we're
[239:28.88]going to need the start time. So we're
[239:32.72]going to return start time from data dot
[239:36.00]start time. So this is going to be
[239:39.68]returned from the create meeting. Now
[239:41.84]let's import it. And yeah, we're good to
[239:45.35]go. Now let's continue. After the
[239:48.31]onsubmit function here, we're going to
[239:51.12]return our actual form, typical form.
[239:55.76]Nothing
[239:57.43]different here. Let's import it. And
[240:01.84]then this is the time zone selection
[240:04.88]field.
[240:06.39]I think we've already done something
[240:09.04]like that before. So yeah, this is the
[240:12.23]time zone selection field. This is the
[240:15.19]error area and this is the date picker
[240:19.19]field and we're going to get that date
[240:21.84]picker from Shhatsan. If we go to
[240:24.31]Shhatzen and type date picker,
[240:28.16]he can find something like that. This is
[240:30.72]what we want in our application. And in
[240:32.96]order to install it, we're going to need
[240:34.96]component named pop over. And we're also
[240:38.56]going to need calendar. So, we're going
[240:40.96]to need to install both of them. So,
[240:44.47]let's install the pop over. Copy that
[240:49.84]and paste it here.
[240:52.96]Use force. And also, let's install
[240:56.39]calendar.
[240:58.39]And while it's installing,
[241:00.80]let's see what's going on here.
[241:03.52]Let's go to the date picker
[241:07.19]here. In order to have a date picker
[241:09.04]like that, we're going to need to create
[241:11.76]a mix between a popover and a calendar
[241:14.72]like that. And this is exactly what we
[241:17.92]did here in our code inside of this form
[241:21.27]field, the date picker. We put a popover
[241:24.64]that includes a calendar here. So we're
[241:28.39]going to import the popover from UI
[241:30.72]popover
[241:32.31]and here it's trigger and here button of
[241:36.56]course
[241:38.31]and here the CN function and here if
[241:41.76]there is a date we want to format it
[241:44.31]otherwise we're going to type pick a
[241:45.92]date. So if the user didn't pick a date
[241:48.39]yet we're going to say to them pick a
[241:50.64]date otherwise if he picks a date we're
[241:53.68]going to format that date and display it
[241:56.23]to them. So, let's go to formatters.
[241:59.60]I'm going to go ahead and create the
[242:01.52]rest of our formatters. This is a
[242:04.16]formatter to display the only time like
[242:06.88]9:45 a.m. And this function will format
[242:10.47]time string into a short style time
[242:12.80]string. This will do the same for dates
[242:15.92]in order to display the date the date
[242:18.08]like that. And this formats dates.
[242:22.88]And this formats both dates and time. If
[242:26.47]you want to display a date and a time
[242:29.84]like that in that way, we're going to
[242:31.68]use this function which uses that
[242:34.64]formatter. Okay, save it. And let's go
[242:38.47]back here and import this from our
[242:41.43]formatters. And this calendar icon
[242:44.31]coming from Louiside Reacts. This is
[242:47.68]coming from popover. And then the
[242:50.08]calendar component is coming from.
[242:54.64]And here we want to only allow setting
[242:57.60]dates that have available time slots.
[243:01.76]Let me explain that code to you. Here we
[243:04.80]are using the sum function on the valid
[243:08.23]times in time zone. And here we are
[243:11.04]taking each date of the calendar. If we
[243:14.96]take a look here at the chaten calendar
[243:17.84]component, you can see that here in the
[243:21.12]disabled prop, they provide you with a
[243:24.88]date instance which is going to
[243:27.19]represent each date here. Okay, this is
[243:31.19]the calendar component and inside of the
[243:33.84]disabled property, you can take each one
[243:37.27]of these dates. So here we are taking
[243:41.04]each date and we want to make this
[243:44.31]disabled only if the date doesn't have
[243:47.43]any available time slots. So we are
[243:50.80]using the sum function and taking each
[243:53.84]time from the time slots and checking is
[243:57.60]it the same day as this date. If at
[244:01.12]least one time from these valid times is
[244:05.84]in the same day as this date, the sum
[244:09.27]function is going to return true. This
[244:11.43]is how the sum function works. So if it
[244:14.72]returns true, then this whole statement
[244:17.84]will be false because we are saying not
[244:20.96]here. See? So when this is false, this
[244:24.39]is not going to be disabled. Okay? And
[244:28.00]exactly the opposite will happen if this
[244:30.64]returns false. Meaning that if we used
[244:33.60]the sum function and compared each time
[244:36.56]with that date and none of the dates is
[244:41.43]on the same day as any of the times of
[244:45.27]these valid times, this is going to
[244:48.00]return false.
[244:50.39]So when we reverse it here using that uh
[244:53.84]exclamation mark which is the not
[244:56.08]operator in JavaScript this whole
[244:59.19]statement will return true and this
[245:01.68]means that the disabled is going to be
[245:04.08]true. So at the end that date will be
[245:07.84]disabled. So here basically we're only
[245:10.72]enabling the dates that have valid time
[245:13.92]slots. Okay. And now here we have the
[245:17.35]time selection fields. Of course, if
[245:20.64]there is no date or time zone, we're
[245:22.56]going to disable it and changing it on
[245:26.00]change. Default value is the field value
[245:29.68]and so on. And here we want to show time
[245:32.31]options only for the selected day. So
[245:34.88]we're going to apply the filter method
[245:36.72]on the valid times. Check also if the
[245:40.88]time is same day as the date. And then
[245:45.12]filter means that we're going to return
[245:48.31]all the times for the selected date or
[245:51.43]the selected day. And then we're going
[245:52.96]to map on each item and show a select
[245:56.39]item component.
[245:58.64]Its value is going to be the time to ISO
[246:01.68]string. And here the guest name input.
[246:05.04]Here the guest email. And here optional
[246:07.84]notes text area. And here the cancel and
[246:12.56]submit buttons. If the user cancels,
[246:16.08]we're going to redirect them to the
[246:17.76]public profile page. And here we're
[246:20.16]going to show the book event button
[246:23.27]which is going to create the meeting.
[246:26.08]And here finally we want to say
[246:29.84]while the form is submitting
[246:32.80]return a component named booking. So
[246:37.35]let's define it here in components
[246:40.88]booking.tsx.
[246:43.52]It's a very simple component that going
[246:46.64]to show that indicator from react
[246:48.64]loading indicators.
[246:51.35]So let's save and here import it.
[246:56.00]And now let's save everything. And let's
[246:58.96]import the meeting form. And now let's
[247:02.08]test everything. Now let's go to my
[247:04.96]public profile and select an event.
[247:08.08]Failed to get oath client.
[247:11.19]All right, I might know what's going on
[247:12.96]here. I have to sign out first
[247:16.47]and then I want to grant access one more
[247:19.76]time to my Google calendar. So, I'm
[247:23.27]going to remove
[247:25.27]myself from the clerk project and I'm
[247:28.47]going to go back here
[247:30.96]and sign in
[247:34.16]one more time.
[247:36.31]As you can see, right now Google is
[247:39.60]involved in my app. Before I used to
[247:42.23]sign in, no problem, right? But right
[247:45.68]now, Google is involved.
[247:48.47]It's It's giving me like a warning or
[247:51.04]something like that. It's telling me
[247:52.39]Google hasn't verified this application.
[247:55.52]So I can choose back to safety. But in
[247:58.72]my case, I'm going to continue because I
[248:00.80]trust my application. It's going to ask
[248:03.04]me, do you want to give access to this
[248:05.19]application, which is mine by the way.
[248:07.43]I'm going to continue.
[248:09.92]It's going to tell me that application
[248:12.08]uses my Google calendar. Okay, it view
[248:15.43]and edit events on all of my calendar
[248:18.80]events. So I'm going to check it.
[248:22.23]and click continue.
[248:27.27]Verify your human. Okay.
[248:30.47]So, right now there are no events
[248:32.08]because as you already saw I removed my
[248:35.12]uh my account from clerk. So, right now
[248:38.39]I have a new ID. So, let's start from
[248:41.19]scratch.
[248:42.72]Let's call the event programming fluency
[248:45.43]talks.
[248:47.27]Duration 30 minutes.
[248:50.39]Let's
[248:52.23]talk about programming.
[248:56.16]This is the description. Click save.
[249:00.16]Okay, I'm going to copy the link for
[249:02.72]that event.
[249:05.12]And then paste it here in an incognito
[249:07.52]window. And there you go. I have the
[249:10.72]booking page. But of course, it's
[249:13.35]telling me that I'm currently booked up
[249:15.68]because I haven't specified any
[249:17.84]schedule. Let's choose anything.
[249:20.64]Wednesday from 9 to 5. Save. So now if I
[249:24.72]go back here and reload, I should get
[249:27.92]the meeting form.
[249:30.56]And right now the error disappeared. And
[249:33.27]this is our meeting form. Let's try to
[249:37.52]choose a date. Okay, I'm only available
[249:40.16]on Wednesdays. Let's choose this one.
[249:46.56]Meeting time. Let's choose anytime.
[249:50.08]Okay. Let's go to temp temp mail. And
[249:54.72]here let's type anything. Let's say Elon
[249:58.64]Musk. Then copy the email. Paste it
[250:01.76]here. Then here let's type anything.
[250:04.88]Let's say let's
[250:08.47]talk about
[250:11.19]programming.
[250:13.27]And now let's click here on book events.
[250:17.35]Okay,
[250:18.96]so far so good
[250:22.47]and apparently everything is working and
[250:25.12]I was redirected to the success page
[250:28.31]here in which we have to create right
[250:31.43]now.
[250:33.04]Let's go to event ID here. And inside of
[250:37.12]it, we're going to create a new page
[250:39.68]named success.
[250:42.56]And inside of it, we're going to create
[250:45.68]a new file page.tsx.
[250:49.84]And this page is actually very simple.
[250:53.84]It's going to take the params and the
[250:56.16]search params. Search params is anything
[250:59.84]coming after question mark. So basically
[251:02.64]they are the query parameters and here
[251:05.60]it's going to get the event data
[251:08.80]through an error if there is no event
[251:11.43]then get the calendar user the start
[251:14.72]time date
[251:17.60]and then here it's going to say
[251:19.68]successfully booked the event name with
[251:22.56]calendar user full name
[251:26.08]and here you should receive an email and
[251:28.31]so on.
[251:30.47]Save everything. Let's reload this page.
[251:34.23]Oh, I have a typo here.
[251:36.96]This should be page, not pages.
[251:41.12]Now, let's reload again. And there you
[251:43.84]go. I get my success page here. And
[251:47.52]let's see if I get an email here. Okay,
[251:50.80]nice. I can accept the invitation. Then
[251:54.96]let's go to the Google calendar on day
[251:57.84]21. Yeah, I am Musk with me here. So,
[252:03.19]everything is working. This is my
[252:06.08]meeting with El Musk. Let's try it one
[252:08.88]more time from scratch. I'm going to go
[252:10.56]to public profile loading.
[252:14.47]Copy profile URL. Then let's go here.
[252:19.04]Paste it.
[252:24.23]Select the event. There you go. This is
[252:27.76]the meeting form. Pick a date.
[252:31.92]Let's choose
[252:33.92]28.
[252:37.52]Select a meeting.
[252:40.64]Pick the date again.
[252:42.96]Let's type any name. I don't know. Let's
[252:46.31]say Ross
[252:48.08]Galler from friends.
[252:50.96]Copy that email. Paste it. Sorry. Paste
[252:55.04]it here.
[252:57.19]And here let's say
[253:00.31]let's talk
[253:03.68]and book event. Okay, it's booking
[253:09.19]and I was redirected to the success
[253:12.80]page. Now let's go back to the email
[253:16.88]list here. Yeah, back to list. And this
[253:20.56]is the confirmation
[253:22.88]to Roskiller.
[253:25.60]I'm going to click yes.
[253:28.72]Let's go to my Google calendar.
[253:32.39]Choose 28.
[253:34.80]And yeah, that's my event. Ros Geller
[253:38.15]with me. Very nice. And now we're
[253:41.60]actually done. The only thing left is to
[253:44.72]deploy our app to the internet.
[253:49.52]All right, it's finally time to take our
[253:52.96]app live. We've built everything, tested
[253:56.56]the features, and now we're ready to
[253:58.88]share it with the world. Deploying it to
[254:01.52]the internet means anyone anywhere can
[254:04.23]access what we've created. It's a big
[254:06.96]milestone and an exciting moment. So,
[254:10.23]let's get it online and show everyone
[254:12.47]what we've been working on. First of
[254:15.27]all, let's go to your GitHub account and
[254:19.43]create a new repository.
[254:22.15]We're going to name it Calendarra
[254:26.15]and I'm going to make it private for
[254:27.84]now, but after I finish recording, I'm
[254:30.88]going to change it back to public. Okay.
[254:33.27]Now, click on create repository
[254:36.31]and then you're going to be redirected
[254:38.47]to this page. Copy all of these
[254:40.56]commands.
[254:42.08]And then let's go back to our project.
[254:44.15]Close everything. Open the terminal and
[254:47.60]paste all of these commands here. Now
[254:51.68]I'm going to open the readme file here.
[254:54.80]I'm going to change that content. You
[254:57.52]don't have to do that. It's just some
[255:00.23]description of uh this course. I'm going
[255:03.19]to save. Then let's type get add all.
[255:08.08]Then get commit message. And then let's
[255:12.64]type a message saying finishing
[255:17.76]the project.
[255:20.31]and
[255:21.92]deploying it
[255:25.60]and then let's say get push. Now if we
[255:29.12]go back to our GitHub repository and
[255:32.23]reload, you can see our project here.
[255:36.31]Now I want to add
[255:38.88]a.ample
[255:40.39]file. I want to leave it to you just uh
[255:43.52]to remind you of the environment
[255:45.27]variables you're going to need in this
[255:47.19]project. So I'm going to create a new
[255:49.04]file here. name it im.example.
[255:53.35]And here in the dot ignore, I'm just
[255:55.92]going to ignore the M file, not
[255:58.15]everything after imp. And this is why I
[256:01.04]removed the star. And then I'm going to
[256:03.60]copy everything from my M file, paste it
[256:06.64]here, and I'm going to remove the keys.
[256:11.04]So yeah, those are the environment
[256:13.43]variables. Let's open the terminal again
[256:15.92]and type get add all get commit. Let's
[256:21.35]say
[256:24.15]adding
[256:27.52]dot example file
[256:31.35]then get push.
[256:34.64]Now let's go back here and reload.
[256:38.80]And this is the file.ample.
[256:42.00]example.
[256:44.56]Very nice.
[256:46.39]Now, this is the final source code for
[256:48.72]our project. I'm going to leave that
[256:50.56]link for you in the description of this
[256:52.88]course. Okay. Now, let's deploy it to
[256:55.76]the internet. We're going to go to a
[256:57.92]website named Versell. Okay. In Versel,
[257:00.80]you can deploy all of your Nex.js
[257:03.27]projects. So, first of all,
[257:07.52]connect your Versell account with your
[257:09.76]GitHub account. Okay, it's a very simple
[257:12.23]process. Just log into your Versel
[257:14.15]account and connect your GitHub account
[257:16.31]with your Versell account and then go
[257:19.76]here and import a project. This is all
[257:22.80]of our projects. You might want to give
[257:25.27]Versel permission first to import repos
[257:28.08]from your GitHub account, but I already
[257:30.39]did that. So here I'm going to import
[257:33.35]Calendra.
[257:35.92]And here, of course, leave this as it
[257:38.08]is. And also leave this as it is. And
[257:41.68]here in the install command, I'm going
[257:44.64]to change it to mpm install
[257:50.23]d-force
[257:52.15]because of course of the react 19 issues
[257:56.15]and uh and so on. And here we have to
[257:58.47]add our environment variables. So let's
[258:01.19]go ahead to our M file. Copy everything
[258:05.84]from here. And let's just paste it here
[258:10.00]and click on deploy. Okay, now it's
[258:13.19]building and deploying. It's going to
[258:14.72]take some time. This is normal. Okay, we
[258:18.23]have a typo here.
[258:20.64]This should be mpm install-force.
[258:26.23]And here are the environment variables.
[258:29.43]deploy and now congratulations our
[258:32.88]application is deployed to the internet.
[258:36.96]Now go to your dashboard
[258:39.60]and this is the link for our
[258:41.60]application. You can copy that link give
[258:45.04]it to anyone in the world and they can
[258:47.92]use your application. And now I can
[258:50.47]really tell you congratulations
[258:53.68]you've just built and deployed an
[258:56.08]awesome app. No, seriously, give
[258:59.52]yourself a pat on the back. Not only did
[259:02.47]you put in the work, but now you've got
[259:05.35]a polished live project that you can
[259:08.08]proudly show off to potential employers,
[259:11.27]freelance clients, or even just your
[259:13.92]friends and family. This is a real
[259:17.27]achievement and a solid addition to your
[259:19.84]portfolio. Keep going. This is how great
[259:22.80]developer careers are built. Thank you
[259:25.76]so much for taking this course and I
[259:28.80]hope you have a great day and life. See
[259:31.92]you later. Have a great day and bye-bye.
[259:41.43][Music]